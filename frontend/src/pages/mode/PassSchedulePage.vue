<template>
  <div class="pass-schedule-mode">
    <!-- 1Ìñâ: Offset Controls - EphemerisDesignationPageÏôÄ ÎèôÏùºÌïú Íµ¨Ï°∞ -->
    <div class="row q-col-gutter-md q-mb-sm offset-control-row">
      <div class="col-12">
        <q-card flat bordered class="control-card">
          <q-card-section class="compact-control purple-1">
            <!-- Î™®Îì† Í∞ÑÍ≤©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï°∞Ï†ïÎêòÎäî Î∞òÏùëÌòï Î†àÏù¥ÏïÑÏõÉ -->
            <div class="flexible-offset-layout">
              <!-- Azimuth Offset -->
              <div class="offset-group">
                <div class="row q-gutter-xs align-center">
                  <div class="col-auto position-offset-label">
                    <div class="text-subtitle2 text-weight-bold text-primary text-center">
                      Azimuth<br>Offset
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="inputs[0]" @input="(val: string) => onInputChange(0, val)" dense outlined
                      type="number" step="0.01" label="Azimuth" class="offset-input" />
                  </div>
                  <div class="col-auto">
                    <div class="vertical-button-group">
                      <div class="vertical-buttons">
                        <q-btn icon="add" size="sm" color="primary" dense flat @click="increment(0)" />
                        <q-btn icon="remove" size="sm" color="primary" dense flat @click="decrement(0)" />
                      </div>
                      <q-btn icon="refresh" size="sm" color="grey-7" dense flat @click="reset(0)" />
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="outputs[0]" dense outlined readonly label="Output"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                </div>
              </div>

              <!-- Elevation Offset -->
              <div class="offset-group">
                <div class="row q-gutter-xs align-center">
                  <div class="col-auto position-offset-label">
                    <div class="text-subtitle2 text-weight-bold text-primary text-center">
                      Elevation<br>Offset
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="inputs[1]" @input="(val: string) => onInputChange(1, val)" dense outlined
                      type="number" step="0.01" label="Elevation"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                  <div class="col-auto">
                    <div class="vertical-button-group">
                      <div class="vertical-buttons">
                        <q-btn icon="add" size="sm" color="primary" dense flat @click="increment(1)" />
                        <q-btn icon="remove" size="sm" color="primary" dense flat @click="decrement(1)" />
                      </div>
                      <q-btn icon="refresh" size="sm" color="grey-7" dense flat @click="reset(1)" />
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="outputs[1]" dense outlined readonly label="Output"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                </div>
              </div>

              <!-- Tilt Offset -->
              <div class="offset-group">
                <div class="row q-gutter-xs align-center">
                  <div class="col-auto position-offset-label">
                    <div class="text-subtitle2 text-weight-bold text-primary text-center">
                      Tilt<br>Offset
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="inputs[2]" @input="(val: string) => onInputChange(2, val)" dense outlined
                      type="number" step="0.01" label="Tilt"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                  <div class="col-auto">
                    <div class="vertical-button-group">
                      <div class="vertical-buttons">
                        <q-btn icon="add" size="sm" color="primary" dense flat @click="increment(2)" />
                        <q-btn icon="remove" size="sm" color="primary" dense flat @click="decrement(2)" />
                      </div>
                      <q-btn icon="refresh" size="sm" color="grey-7" dense flat @click="reset(2)" />
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="outputs[2]" dense outlined readonly label="Output"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                </div>
              </div>

              <!-- Time Offset + Cal Time -->
              <div class="offset-group">
                <div class="row q-gutter-xs align-center">
                  <div class="col-auto position-offset-label">
                    <div class="text-subtitle2 text-weight-bold text-primary text-center">
                      Time<br>Offset
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="inputs[3]" @input="(val: string) => onInputChange(3, val)" dense outlined
                      type="number" step="0.01" label="Time"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                  <div class="col-auto">
                    <div class="vertical-button-group">
                      <div class="vertical-buttons">
                        <q-btn icon="add" size="sm" color="primary" dense flat @click="increment(3)" />
                        <q-btn icon="remove" size="sm" color="primary" dense flat @click="decrement(3)" />
                      </div>
                      <q-btn icon="refresh" size="sm" color="grey-7" dense flat @click="reset(3)" />
                    </div>
                  </div>
                  <div class="col-auto">
                    <q-input v-model="outputs[3]" dense outlined readonly label="Result"
                      style="width: 110px !important; min-width: 110px !important; max-width: 110px !important;" />
                  </div>
                  <div class="col-auto cal-time-field">
                    <q-input v-model="formattedCalTime" dense outlined readonly label="Cal Time"
                      style="min-width: 190px !important; max-width: 220px !important;" />
                  </div>
                </div>
              </div>
            </div>
          </q-card-section>
        </q-card>
      </div>
    </div>
    <!-- 2Ìñâ: Main Content -->
    <div class="row q-col-gutter-md main-content-row"
      style="display: flex; flex-wrap: nowrap; align-items: stretch; margin-bottom: 0 !important; padding-bottom: 0 !important;">
      <!-- 1Î≤à ÏòÅÏó≠: Ï∞®Ìä∏Í∞Ä Îì§Ïñ¥Í∞à ÎÑ§Î™®ÎÇú Ïπ∏ - Î∞òÏùëÌòï ÌÅ¨Í∏∞ Ï°∞Ï†ï -->
      <div class="col-12 col-md-3 position-view-col">
        <q-card class="control-section position-view-card"
          style="min-height: 360px !important; height: 100% !important; display: flex !important; flex-direction: column !important;">
          <q-card-section class="position-view-section"
            style="min-height: 360px !important; height: 100% !important; flex: 1 !important; display: flex !important; flex-direction: column !important; padding-top: 16px !important; padding-bottom: 0px !important;">
            <div class="text-subtitle1 text-weight-bold text-primary position-view-title">Position View</div>
            <div class="chart-area" ref="chartRef"
              style="min-height: 340px !important; height: 100% !important; flex: 1 !important; padding-top: 0 !important; padding-bottom: 0 !important; margin-bottom: 0 !important;">
            </div>
          </q-card-section>
        </q-card>
      </div>

      <!-- 2Î≤à ÏòÅÏó≠: Schedule Information -->
      <div class="col-12 col-md-3">
        <q-card class="control-section">
          <q-card-section>
            <div class="text-subtitle1 text-weight-bold text-primary q-mb-xs">Schedule Information</div>
            <div class="schedule-form">
              <div class="form-row">
                <!-- ÏûêÎèô/ÏàòÎèô ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ Ï†ïÎ≥¥ ÌëúÏãú -->
                <div v-if="displaySchedule" class="schedule-info q-mt-xs">
                  <div class="info-row">
                    <span class="info-label">Ïä§ÏºÄÏ§Ñ ID / ÏÉÅÌÉú:</span>
                    <div class="info-value-with-badge">
                      <span class="info-value">{{ displaySchedule.no }}</span>
                      <q-badge v-if="currentScheduleStatus" :color="currentScheduleStatus.color"
                        :label="currentScheduleStatus.label" class="q-ml-sm" />
                      <q-badge v-if="displaySchedule.isKeyhole || displaySchedule.IsKeyhole" color="red" label="KEYHOLE"
                        class="q-ml-sm" />
                    </div>
                  </div>
                  <!--     <div class="info-row">
                      <span class="info-label">Index:</span>
                      <span class="info-value">{{ displaySchedule.index }}</span>
                    </div> -->
                  <div class="info-row">
                    <span class="info-label">ÏúÑÏÑ± Ïù¥Î¶Ñ:</span>
                    <span class="info-value">{{ displaySchedule.satelliteName }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">ÏãúÏûë ÏãúÍ∞Ñ:</span>
                    <span class="info-value">{{ formatToLocalTime(displaySchedule.startTime) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">Ï¢ÖÎ£å ÏãúÍ∞Ñ:</span>
                    <span class="info-value">{{ formatToLocalTime(displaySchedule.endTime) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">ÏßÄÏÜç ÏãúÍ∞Ñ:</span>
                    <span class="info-value">{{ formatDuration(displaySchedule.duration) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">ÏãúÏûë Î∞©ÏúÑÍ∞Å:</span>
                    <span class="info-value">{{ displaySchedule.startAzimuthAngle.toFixed(2) }}¬∞</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">ÏµúÎåÄ Í≥†ÎèÑÍ∞Å:</span>
                    <span class="info-value">{{ displaySchedule.maxElevation?.toFixed(2) }}¬∞</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">ÎÇ®ÏùÄ ÏãúÍ∞Ñ:</span>
                    <span class="info-value" :class="{
                      'text-negative': timeRemaining < 0,
                      'text-positive': timeRemaining > 0,
                      'text-grey': timeRemaining === 0,
                    }">
                      {{ formatTimeRemaining(timeRemaining) }}
                    </span>
                  </div>

                </div>
                <!-- Ïä§ÏºÄÏ§ÑÏù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ -->
                <div v-else class="no-schedule-selected">
                  <div class="text-grey-5">Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§</div>
                </div>
              </div>
            </div>
          </q-card-section>
        </q-card>
      </div>

      <!-- 3Î≤à ÏòÅÏó≠: Schedule Control -->
      <div class="col-12 col-md-6 schedule-control-col">
        <q-card class="control-section">
          <q-card-section class="schedule-control-section">
            <!-- ‚úÖ Schedule Control Ìó§Îçî -->
            <div class="schedule-header">
              <div class="text-subtitle1 text-weight-bold text-primary schedule-header-title">Schedule Control</div>
              <div class="schedule-header-right">
                <!-- ÌòÑÏû¨/Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏÉÅÌÉú ÌëúÏãú -->
                <div v-if="currentDisplaySchedule" class="current-schedule-display">
                  <q-icon :name="currentDisplaySchedule.type === 'current' ? 'play_arrow' : 'schedule'"
                    :color="currentDisplaySchedule.type === 'current' ? 'positive' : 'primary'" size="sm" />
                  <span class="text-body2 q-ml-xs">
                    {{ currentDisplaySchedule.label }}: MstId {{ currentDisplaySchedule.mstId }}
                  </span>
                  <q-badge :color="currentDisplaySchedule.type === 'current' ? 'positive' : 'primary'"
                    :label="currentDisplaySchedule.type === 'current' ? 'Ï∂îÏ†ÅÏ§ë' : 'ÎåÄÍ∏∞Ï§ë'" class="q-ml-sm" />
                </div>
                <!-- Îì±Î°ùÎêú Ïä§ÏºÄÏ§Ñ Ï†ïÎ≥¥ -->
                <div class="registered-schedule-info">
                  <span class="text-body2 text-primary">Îì±Î°ùÎêú Ïä§ÏºÄÏ§Ñ</span>
                  <span class="text-caption text-grey-5 q-ml-xs">{{ scheduleData.length }}Í∞ú</span>
                </div>
              </div>
            </div>
            <!--
              <div class="debug-panel q-mb-md" v-if="true">
                <q-card flat bordered>
                  <q-card-section class="q-py-sm">
                    <div class="text-caption">
                      <strong>ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥:</strong>
                      Current: {{ icdStore.currentTrackingMstId }} |
                      Next: {{ icdStore.nextTrackingMstId }} |
                      Ïä§ÏºÄÏ§Ñ Ïàò: {{ sortedScheduleList.length }}
                    </div>
                    <div class="text-caption q-mt-xs">
                      Ïù∏Îç±Ïä§Îì§: {{sortedScheduleList.map(s => s.index).join(', ')}}
                    </div>
                    <div class="text-caption q-mt-xs">
                      <strong>Next=14 Îß§Ïπ≠:</strong>
                      {{ icdStore.nextTrackingMstId === 14 ? '‚úÖ' : '‚ùå' }} |
                      <strong>ÌÖåÏù¥Î∏î ÌÇ§:</strong> {{
                       }}
                    </div>
                  </q-card-section>
                </q-card>
              </div>
 -->
            <!-- ‚úÖ Ïä§ÏºÄÏ§Ñ ÌÖåÏù¥Î∏î - Ï≤¥ÌÅ¨Î∞ïÏä§ Ï†úÍ±∞, ÎÜíÏù¥ Í≥†Ï†ï (Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÌëúÏãú, ÌôîÎ©¥ÏóêÎäî Ï†ïÌôïÌûà 3Í∞ú ÌñâÎßå Î≥¥Ïù¥ÎèÑÎ°ù) -->
            <q-table flat bordered :row-class="getRowClass" :row-style="getRowStyleDirect" :rows="sortedScheduleList"
              :columns="scheduleColumns" row-key="no" :pagination="{ rowsPerPage: 0 }" hide-pagination
              :loading="loading && sortedScheduleList.length === 0" @row-click="onRowClick"
              class="schedule-table q-mt-sm" style="height: 210px; max-height: 210px;" :no-data-label="'Îì±Î°ùÎêú Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§'"
              :virtual-scroll="false">
              <template v-slot:loading>
                <q-inner-loading showing color="primary">
                  <q-spinner size="50px" color="primary" />
                </q-inner-loading>
              </template>
              <!-- Keyhole Î∞∞ÏßÄ Ïª¨Îüº -->
              <template v-slot:body-cell-keyhole="props">
                <q-td :props="props">
                  <q-badge v-if="props.row.isKeyhole || props.row.IsKeyhole" color="red" label="KEYHOLE" />
                </q-td>
              </template>
              <!-- ÏúÑÏÑ± Ï†ïÎ≥¥ Ïª¨Îüº ÌÖúÌîåÎ¶ø -->
              <template v-slot:body-cell-satelliteInfo="props">
                <q-td :props="props" class="satellite-info-cell">
                  <div class="satellite-container">
                    <div class="satellite-id">{{ props.row.satelliteId || '-' }}</div>
                    <div class="satellite-name">{{ props.row.satelliteName }}</div>
                  </div>
                </q-td>
              </template>

              <!-- ÏãúÍ∞Ñ Î≤îÏúÑ Ïª¨Îüº ÌÖúÌîåÎ¶ø - formatDateTime Ìï®Ïàò ÏÇ¨Ïö© -->
              <template v-slot:body-cell-timeRange="props">
                <q-td :props="props" class="time-range-cell">
                  <div class="time-container">


                    <div class="start-time">{{ formatDateTime(props.row.startTime) }}</div>
                    <div class="end-time">{{ formatDateTime(props.row.endTime) }}</div>
                  </div>
                </q-td>
              </template>

              <!-- Azimuth Î≤îÏúÑ Ïª¨Îüº ÌÖúÌîåÎ¶ø -->
              <template v-slot:body-cell-azimuthRange="props">
                <q-td :props="props" class="azimuth-range-cell">
                  <div class="azimuth-container">
                    <div class="start-az">{{ formatAngle(props.row.startAzimuthAngle) }}</div>
                    <div class="end-az">{{ formatAngle(props.row.endAzimuthAngle) }}</div>
                  </div>
                </q-td>
              </template>

              <!-- Elevation Ï†ïÎ≥¥ Ïª¨Îüº ÌÖúÌîåÎ¶ø -->
              <template v-slot:body-cell-elevationInfo="props">
                <q-td :props="props" class="elevation-info-cell">
                  <div class="elevation-container">
                    <div class="max-elevation">{{ formatAngle(props.row.maxElevation) }}</div>
                    <div class="train">{{ formatAngle(0) }}</div>
                  </div>
                </q-td>
              </template>
            </q-table>
            <!-- Î≤ÑÌäº Í∑∏Î£π ÏÑπÏÖò -->
            <div class="button-group">
              <div class="button-row">
                <q-btn color="info" label="TLE Upload" icon="upload_file" @click="handleTLEUpload"
                  class="q-mr-sm upload-btn" size="sm" />

                <q-btn color="primary" label="Select Schedule" icon="playlist_add_check" @click="selectScheduleData"
                  class="upload-btn" size="sm">
                  <q-tooltip>Ïä§ÏºÄÏ§Ñ Î™©Î°ùÏùÑ Î∂àÎü¨ÏôÄÏÑú ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§</q-tooltip>
                </q-btn>
              </div>

              <div class="control-button-row">
                <q-btn color="positive" icon="play_arrow" label="Start" @click="handleStartCommand" class="control-btn"
                  size="sm" />
                <q-btn color="negative" icon="stop" label="Stop" @click="handleStopCommand" class="control-btn"
                  size="sm" />
                <q-btn color="warning" icon="home" label="Stow" @click="handleStowCommand" class="control-btn"
                  size="sm" />
              </div>
            </div>
          </q-card-section>
        </q-card>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// ‚úÖ keep-aliveÏùò includeÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïª¥Ìè¨ÎÑåÌä∏ Ïù¥Î¶Ñ Ï†ïÏùò
defineOptions({
  name: 'PassSchedulePage'
})

import { ref, onMounted, onUnmounted, computed, watch, onActivated, onDeactivated, nextTick } from 'vue'
import { useQuasar } from 'quasar'
import { usePassScheduleModeStore, type ScheduleItem } from '@/stores'
import { useICDStore } from '../../stores/icd/icdStore'
import * as echarts from 'echarts'
import type { ECharts } from 'echarts'
import type { QTableProps } from 'quasar'
import { openModal } from '../../utils/windowUtils'
import { formatToLocalTime, formatTimeRemaining, getCalTimeTimestamp } from '../../utils/times'

const $q = useQuasar()
const passScheduleStore = usePassScheduleModeStore()
const icdStore = useICDStore()
// Ï∞®Ìä∏ Í¥ÄÎ†® Î≥ÄÏàò
const chartRef = ref<HTMLElement | null>(null)
let updateTimer: number | null = null

// ECharts Îß§Í∞úÎ≥ÄÏàò ÌÉÄÏûÖ Ï†ïÏùò
interface EChartsScatterParam {
  value: [number, number]
  dataIndex: number
  seriesIndex: number
  seriesName: string
  name: string
  color: string
  borderColor: string
  dimensionNames: string[]
  encode: Record<string, number[]>
  marker: string
  data: [number, number]
  dimensionIndex: number
}

// PassSchedule Ï†ÑÏö© Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ÏôÄ ÏÉÅÌÉú
const currentPosition = ref({ azimuth: 0, elevation: 0 })
let passChart: ECharts | null = null

// üÜï Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî ÏÉÅÌÉú Ï∂îÏ†Å
const isChartInitialized = ref(false)

// ‚úÖ Ï∞®Ìä∏ Î¶¨ÏÇ¨Ïù¥Ï¶à Ìï∏Îì§Îü¨Î•º Ïô∏Î∂Ä Î≥ÄÏàòÎ°ú Ï†ÄÏû• (onUnmountedÏóêÏÑú Ï†úÍ±∞ÌïòÍ∏∞ ÏúÑÌï¥)
let chartResizeHandler: (() => void) | null = null

// üÜï PassSchedule Ï†ÑÏö© Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌíÄ (EphemerisDesignationPageÏôÄ ÎèôÏùºÌïú ÏµúÏ†ÅÌôî)
class PassChartUpdatePool {
  private positionData: [number, number][] = [[0, 0]]
  private trackingData: [number, number][] = []
  private predictedData: [number, number][] = []
  private updateOption: {
    series: Array<{ data?: [number, number][] }>
  }

  constructor() {
    this.updateOption = {
      series: [
        { data: this.positionData }, // ÌòÑÏû¨ ÏúÑÏπò
        { data: this.trackingData }, // Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å Í≤ΩÎ°ú
        { data: this.predictedData }, // ÏòàÏ∏° Í≤ΩÎ°ú
      ],
    }
  }

  // ‚úÖ updateOptionÏóê ÎåÄÌïú public getter Î©îÏÑúÎìú Ï∂îÍ∞Ä
  getUpdateOption() {
    return this.updateOption
  }

  updatePosition(elevation: number, azimuth: number) {
    // Î∞∞Ïó¥ Ï°¥Ïû¨ ÌôïÏù∏
    if (this.positionData.length > 0 && this.positionData[0]) {
      this.positionData[0][0] = elevation
      this.positionData[0][1] = azimuth
    } else {
      this.positionData = [[elevation, azimuth]]
      // ÏãúÎ¶¨Ï¶à Îç∞Ïù¥ÌÑ∞ Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏
      if (this.updateOption.series[0]) {
        this.updateOption.series[0].data = this.positionData
      }
    }
    return this.updateOption
  }

  updateTrackingPath(newPath: [number, number][]) {
    // ‚úÖ ÏïàÏ†ÑÌïú Î∞∞Ïó¥ ÏóÖÎç∞Ïù¥Ìä∏ - Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ Ï†úÍ±∞
    this.trackingData.length = 0
    if (Array.isArray(newPath) && newPath.length > 0) {
      this.trackingData.push(...newPath)
    }
    // ‚úÖ ÏãúÎ¶¨Ï¶à Îç∞Ïù¥ÌÑ∞ Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏ (series[1]Ïóê ÏÑ§Ï†ï)
    if (this.updateOption.series[1]) {
      this.updateOption.series[1].data = this.trackingData
    }
    return this.updateOption
  }

  updatePredictedPath(newPath: [number, number][]) {
    // ‚úÖ ÏïàÏ†ÑÌïú Î∞∞Ïó¥ ÏóÖÎç∞Ïù¥Ìä∏ - Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ Ï†úÍ±∞
    this.predictedData.length = 0
    if (Array.isArray(newPath) && newPath.length > 0) {
      this.predictedData.push(...newPath)
    }
    // ‚úÖ ÏãúÎ¶¨Ï¶à Îç∞Ïù¥ÌÑ∞ Ï∞∏Ï°∞ ÏóÖÎç∞Ïù¥Ìä∏ (series[2]Ïóê ÏÑ§Ï†ï)
    if (this.updateOption.series[2]) {
      this.updateOption.series[2].data = this.predictedData
    }
    return this.updateOption
  }
}

// üÜï PassChartUpdatePool Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±
const passChartPool = new PassChartUpdatePool()

// üîß Î™®Îì† computedÎ•º Î®ºÏ†Ä Ï†ïÏùò
// ‚úÖ PassSchedule Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î¶¨Ìå©ÌÜ†ÎßÅ: ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÎßå ÌëúÏãú (selectedScheduleList ÏÇ¨Ïö©)
const scheduleData = computed(() => {
  try {
    // ‚úÖ selectedScheduleList ÏÇ¨Ïö© (ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÎßå ÌëúÏãú)
    const data = passScheduleStore.selectedScheduleList || []
    console.log('üîç PassSchedulePage scheduleData (ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ):', data.length, 'Í∞ú')
    // ‚úÖ ÎîîÎ≤ÑÍπÖ: Ï≤´ Î≤àÏß∏ Ìï≠Î™©Ïùò mstId ÌôïÏù∏
    if (data.length > 0) {
      console.log('üîç Ï≤´ Î≤àÏß∏ Ìï≠Î™© mstId ÌôïÏù∏:', {
        mstId: data[0].mstId,
        detailId: data[0].detailId,
        no: data[0].no,
        satelliteName: data[0].satelliteName,
        allKeys: Object.keys(data[0])  // ‚úÖ Î™®Îì† ÌÇ§ ÌôïÏù∏
      })
    }
    return data
  } catch (error) {
    console.error('‚ùå scheduleData computed ÏóêÎü¨:', error)
    return []
  }
})

const sortedScheduleList = computed(() => {
  try {
    const schedules = scheduleData.value
    if (!schedules || !Array.isArray(schedules)) {
      return []
    }
    return schedules
      .slice()
      .sort((a, b) => {
        const timeA = new Date(a.startTime).getTime()
        const timeB = new Date(b.startTime).getTime()
        return timeA - timeB
      })
  } catch (error) {
    console.error('‚ùå sortedScheduleList computed ÏóêÎü¨:', error)
    return []
  }
})

// üîß Î∞òÏùëÏÑ± Ìä∏Î¶¨Í±∞
const reactivityTrigger = ref(0)

// ‚úÖ appendDataÎ•º ÏúÑÌïú Ïù¥Ï†Ñ Í≤ΩÎ°ú Í∏∏Ïù¥ Ï∂îÏ†Å (watchÎ≥¥Îã§ Î®ºÏ†Ä ÏÑ†Ïñ∏)
const lastTrackingPathLength = ref(0)
const lastPredictedPathLength = ref(0)

// ‚úÖ ÎîîÎ≤ÑÍπÖ: ÎßàÏßÄÎßâ Î°úÍ∑∏ Ï∂úÎ†• ÏãúÍ∞Ñ (10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•)
const lastDebugLogTime = ref(0)
const DEBUG_LOG_INTERVAL = 10000 // 10Ï¥à

// üÜï Store Í∞í Î≥ÄÍ≤Ω Í∞êÏßÄ
// ‚úÖ Ïä§ÏºÄÏ§Ñ Ï†ÑÌôò Ïãú Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî Î∞è Ïã†Í∑ú Ïä§ÏºÄÏ§Ñ Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú Î°úÏßÅ
watch([() => icdStore.currentTrackingMstId, () => icdStore.currentTrackingDetailId], ([newMstId, newDetailId], [oldMstId, oldDetailId]) => {
  console.log(`üîÑ currentTrackingMstId/detailId Î≥ÄÍ≤Ω Í∞êÏßÄ: ${oldMstId}/${oldDetailId} ‚Üí ${newMstId}/${newDetailId}`)
  reactivityTrigger.value++

  // ‚úÖ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
  void nextTick(() => {
    applyRowColors()
  })

  // Ïä§ÏºÄÏ§ÑÏù¥ Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞ (Ïù¥Ï†Ñ Ïä§ÏºÄÏ§Ñ ÏôÑÎ£å, Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏãúÏûë)
  if (oldMstId !== null && newMstId !== null && oldMstId !== newMstId) {
    console.log(`üîÑ Ïä§ÏºÄÏ§Ñ Ï†ÑÌôò Í∞êÏßÄ: ${oldMstId} ‚Üí ${newMstId}`)

    // ‚úÖ 1. Ïù¥Î°†Ïπò Í≤ΩÎ°úÏôÄ Ïã§Ï†ú Í≤ΩÎ°ú Î™®Îëê Ï¥àÍ∏∞Ìôî
    passScheduleStore.clearTrackingPaths()
    // ‚úÖ 2. Ï∞®Ìä∏ ÌíÄÏùò Í≤ΩÎ°úÎèÑ Ï¥àÍ∏∞Ìôî
    passChartPool.updateTrackingPath([])
    passChartPool.updatePredictedPath([])
    // ‚úÖ 3. Í≤ΩÎ°ú Í∏∏Ïù¥ Ï∂îÏ†Å Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
    lastTrackingPathLength.value = 0
    lastPredictedPathLength.value = 0
    console.log('‚úÖ Ïä§ÏºÄÏ§Ñ Ï†ÑÌôò - Î™®Îì† Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å')

    // ‚úÖ 4. Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú ÏûêÎèô Î°úÎìú
    void nextTick(async () => {
      try {
        // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (detailIdÎäî WebSocketÏóêÏÑú Î∞õÏïÑÏò¨ Ïàò ÏûàÏßÄÎßå, ÏùºÎã® mstIdÎßåÏúºÎ°ú Ï∞æÍ∏∞)
        const newSchedule = sortedScheduleList.value.find(s => Number(s.mstId) === Number(newMstId))
        if (newSchedule) {
          console.log('üöÄ Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú ÏãúÏûë:', newSchedule.satelliteName, newSchedule.mstId, newSchedule.detailId)

          // ‚úÖ mstIdÏôÄ detailId ÏÇ¨Ïö© (satelliteId Î∂àÌïÑÏöî)
          const mstId = newSchedule.mstId
          const detailId = newSchedule.detailId

          if (!mstId || detailId == null) {
            console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
              mstId: newSchedule.mstId,
              detailId: newSchedule.detailId,
              no: newSchedule.no,
              satelliteName: newSchedule.satelliteName
            })
            return
          }

          // ‚úÖ Ïä§ÏºÄÏ§ÑÏùò keyhole Ïó¨Î∂ÄÏóê Îî∞Îùº DataType Í≤∞Ï†ï
          const isKeyhole = newSchedule.isKeyhole || newSchedule.IsKeyhole || false
          const dataType = isKeyhole ? 'keyhole_optimized_final_transformed' : 'final_transformed'

          const success = await passScheduleStore.loadTrackingDetailData(
            mstId,
            detailId,
            dataType
          )

          if (success) {
            console.log('‚úÖ Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú ÏôÑÎ£å')
            // ‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            if (passChart && !passChart.isDisposed()) {
              updateChart()
            }
          } else {
            console.warn('‚ö†Ô∏è Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú Ïã§Ìå®')
          }
        } else {
          console.warn('‚ö†Ô∏è Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:', newMstId)
        }
      } catch (error) {
        console.error('‚ùå Ïã†Í∑ú Ïä§ÏºÄÏ§Ñ Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú Ï§ë Ïò§Î•ò:', error)
      }
    })

  } else if (oldMstId === null && newMstId !== null) {
    // Ï∂îÏ†Å ÏãúÏûë Ïãú Îπà Í≤ΩÎ°úÏóêÏÑú ÏãúÏûë
    console.log('üöÄ Ï∂îÏ†Å ÏãúÏûë - Î™®Îì† Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî (Îπà Í≤ΩÎ°úÏóêÏÑú ÏãúÏûë)')
    passScheduleStore.clearTrackingPaths()
    // ‚úÖ Ï∞®Ìä∏ ÌíÄÏùò Í≤ΩÎ°úÎèÑ Ï¥àÍ∏∞Ìôî
    passChartPool.updateTrackingPath([])
    passChartPool.updatePredictedPath([])
    // ‚úÖ Í≤ΩÎ°ú Í∏∏Ïù¥ Ï∂îÏ†Å Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
    lastTrackingPathLength.value = 0
    lastPredictedPathLength.value = 0

    // ‚úÖ Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú ÏûêÎèô Î°úÎìú
    void nextTick(async () => {
      try {
        // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (detailIdÎäî WebSocketÏóêÏÑú Î∞õÏïÑÏò¨ Ïàò ÏûàÏßÄÎßå, ÏùºÎã® mstIdÎßåÏúºÎ°ú Ï∞æÍ∏∞)
        const newSchedule = sortedScheduleList.value.find(s => Number(s.mstId) === Number(newMstId))
        if (newSchedule) {
          console.log('üöÄ Ï∂îÏ†Å ÏãúÏûë - Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú ÏãúÏûë:', newSchedule.satelliteName, newSchedule.mstId, newSchedule.detailId)

          // ‚úÖ mstIdÏôÄ detailId ÏÇ¨Ïö© (satelliteId Î∂àÌïÑÏöî)
          const mstId = newSchedule.mstId
          const detailId = newSchedule.detailId

          if (!mstId || detailId == null) {
            console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
              mstId: newSchedule.mstId,
              detailId: newSchedule.detailId,
              no: newSchedule.no,
              satelliteName: newSchedule.satelliteName
            })
            return
          }

          // ‚úÖ Ïä§ÏºÄÏ§ÑÏùò keyhole Ïó¨Î∂ÄÏóê Îî∞Îùº DataType Í≤∞Ï†ï
          const isKeyhole = newSchedule.isKeyhole || newSchedule.IsKeyhole || false
          const dataType = isKeyhole ? 'keyhole_optimized_final_transformed' : 'final_transformed'

          const success = await passScheduleStore.loadTrackingDetailData(
            mstId,
            detailId,
            dataType
          )

          if (success) {
            console.log('‚úÖ Ï∂îÏ†Å ÏãúÏûë - Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú ÏôÑÎ£å')
            // ‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            if (passChart && !passChart.isDisposed()) {
              updateChart()
            }
          } else {
            console.warn('‚ö†Ô∏è Ï∂îÏ†Å ÏãúÏûë - Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùò Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú Ïã§Ìå®')
          }
        } else {
          console.warn('‚ö†Ô∏è Ï∂îÏ†Å ÏãúÏûë - Ïã†Í∑ú Ïä§ÏºÄÏ§ÑÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:', newMstId)
        }
      } catch (error) {
        console.error('‚ùå Ï∂îÏ†Å ÏãúÏûë - Ïã†Í∑ú Ïä§ÏºÄÏ§Ñ Ïù¥Î°†Ïπò Í≤ΩÎ°ú Î°úÎìú Ï§ë Ïò§Î•ò:', error)
      }
    })

  } else if (oldMstId !== null && newMstId === null) {
    // ‚úÖ Ï∂îÏ†Å ÏôÑÎ£å Ïãú Í≤ΩÎ°úÎäî Ïú†ÏßÄ (Ï¥àÍ∏∞ÌôîÌïòÏßÄ ÏïäÏùå)
    console.log('üõë Ï∂îÏ†Å ÏôÑÎ£å - Í≤ΩÎ°ú Ïú†ÏßÄ (Ï¥àÍ∏∞ÌôîÌïòÏßÄ ÏïäÏùå)')

    // ‚úÖ Ïù¥Î°†Ïπò Í≤ΩÎ°úÎßå Ï¥àÍ∏∞Ìôî (Ïã§Ï†ú Ïù¥Îèô Í≤ΩÎ°úÎäî Ïú†ÏßÄ)
    passChartPool.updatePredictedPath([])
    lastPredictedPathLength.value = 0

    // ‚úÖ Ïã§Ï†ú Ïù¥Îèô Í≤ΩÎ°úÎäî Ïú†ÏßÄÌïòÎêò Ï∞®Ìä∏Îßå ÏóÖÎç∞Ïù¥Ìä∏
    if (passChart && !passChart.isDisposed()) {
      updateChart()
    }
  }
}, { immediate: true })

watch([() => icdStore.nextTrackingMstId, () => icdStore.nextTrackingDetailId], ([newMstId, newDetailId], [oldMstId, oldDetailId]) => {
  console.log(`üîÑ nextTrackingMstId/detailId Î≥ÄÍ≤Ω Í∞êÏßÄ: ${oldMstId}/${oldDetailId} ‚Üí ${newMstId}/${newDetailId}`)
  reactivityTrigger.value++

  // ‚úÖ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
  void nextTick(() => {
    applyRowColors()
  })

  // ‚úÖ currentTrackingMstIdÍ∞Ä nullÏù¥Í≥† nextTrackingMstIdÍ∞Ä ÏÑ§Ï†ïÎêú Í≤ΩÏö∞ (ÎåÄÍ∏∞ Ï§ë ÏÉÅÌÉú)
  // Îã§Ïùå Ïä§ÏºÄÏ§ÑÏùò ÏòàÏ∏° Í≤ΩÎ°úÎ•º ÎØ∏Î¶¨ Î°úÎìú
  if (icdStore.currentTrackingMstId === null && newMstId !== null && newMstId !== oldMstId) {
    void nextTick(async () => {
      try {
        const nextSchedule = sortedScheduleList.value.find(s => Number(s.mstId) === Number(newMstId))
        if (nextSchedule) {
          console.log('üîÆ ÎåÄÍ∏∞ Ï§ë - Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú ÏãúÏûë:', nextSchedule.satelliteName, nextSchedule.mstId, nextSchedule.detailId)

          const mstId = nextSchedule.mstId
          const detailId = nextSchedule.detailId

          if (!mstId || detailId == null) {
            console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
              mstId: nextSchedule.mstId,
              detailId: nextSchedule.detailId,
              satelliteName: nextSchedule.satelliteName
            })
            return
          }

          // ‚úÖ Ïä§ÏºÄÏ§ÑÏùò keyhole Ïó¨Î∂ÄÏóê Îî∞Îùº DataType Í≤∞Ï†ï
          const isKeyhole = nextSchedule.isKeyhole || nextSchedule.IsKeyhole || false
          const dataType = isKeyhole ? 'keyhole_optimized_final_transformed' : 'final_transformed'

          const success = await passScheduleStore.loadTrackingDetailData(
            mstId,
            detailId,
            dataType
          )

          if (success) {
            console.log('‚úÖ ÎåÄÍ∏∞ Ï§ë - Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú ÏôÑÎ£å')
            // ‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            if (passChart && !passChart.isDisposed()) {
              updateChart()
            }
          } else {
            console.warn('‚ö†Ô∏è ÎåÄÍ∏∞ Ï§ë - Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú Ïã§Ìå®')
          }
        } else {
          console.warn('‚ö†Ô∏è ÎåÄÍ∏∞ Ï§ë - Îã§Ïùå Ïä§ÏºÄÏ§ÑÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå:', newMstId)
        }
      } catch (error) {
        console.error('‚ùå ÎåÄÍ∏∞ Ï§ë - Îã§Ïùå Ïä§ÏºÄÏ§Ñ ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú Ï§ë Ïò§Î•ò:', error)
      }
    })
  }
}, { immediate: true })

const highlightedRows = computed(() => {
  try {
    // Í∞ïÏ†ú Î∞òÏùëÏÑ± Ìä∏Î¶¨Í±∞ (Í∞íÏùÑ ÏùΩÏñ¥ÏÑú ÏùòÏ°¥ÏÑ± ÏÉùÏÑ±)
    void reactivityTrigger.value // ‚úÖ ÏùòÏ°¥ÏÑ± ÏÉùÏÑ±Ïö© (ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏßÄÎßå Î∞òÏùëÏÑ± Ïú†ÏßÄ)

    const current = icdStore.currentTrackingMstId
    const currentDetailId = icdStore.currentTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    const next = icdStore.nextTrackingMstId
    const nextDetailId = icdStore.nextTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä

    // ‚úÖ ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï†úÍ±∞ (computedÎäî ÏàúÏàò Ìï®ÏàòÏó¨Ïïº Ìï®)

    return { current, currentDetailId, next, nextDetailId }
  } catch (error) {
    console.error('‚ùå highlightedRows computed ÏóêÎü¨:', error)
    return { current: null, currentDetailId: null, next: null, nextDetailId: null }
  }
})

const currentDisplaySchedule = computed(() => {
  try {
    if (icdStore.currentTrackingMstId !== null) {
      return {
        mstId: icdStore.currentTrackingMstId,
        type: 'current',
        label: 'ÌòÑÏû¨ Ï∂îÏ†Å Ï§ë'
      }
    }
    if (icdStore.nextTrackingMstId !== null) {
      return {
        mstId: icdStore.nextTrackingMstId,
        type: 'next',
        label: 'Îã§Ïùå ÏòàÏ†ï'
      }
    }
    return null
  } catch (error) {
    console.error('‚ùå currentDisplaySchedule computed ÏóêÎü¨:', error)
    return null
  }
})
/**
 * ÏßÅÏ†ë Ïä§ÌÉÄÏùº Ï†ÅÏö© Ìï®Ïàò
 *
 * PassSchedule Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î¶¨Ìå©ÌÜ†ÎßÅÏóê Îî∞Îùº mstId Í∏∞Ï§Ä Îß§Ïπ≠.
 *
 * @param props Ìñâ Îç∞Ïù¥ÌÑ∞
 * @returns Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùº Í∞ùÏ≤¥
 */
const getRowStyleDirect = (props: { row: ScheduleItem }) => {
  try {
    if (!props || !props.row) {
      return ''
    }
    const schedule = props.row
    // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (Ï†ÑÏó≠ Í≥†Ïú† ID + Ìå®Ïä§ Ïù∏Îç±Ïä§)
    const scheduleMstId = schedule.mstId ?? schedule.no
    const scheduleDetailId = schedule.detailId ?? null
    const { current, currentDetailId, next, nextDetailId } = highlightedRows.value

    console.log(`üé® getRowStyleDirect Ìò∏Ï∂ú: mstId=${scheduleMstId}, detailId=${scheduleDetailId}, current=${current}/${currentDetailId}, next=${next}/${nextDetailId}`)

    if (scheduleMstId !== undefined) {
      // ‚úÖ mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê (detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
      const currentMatch = current !== null &&
        Number(scheduleMstId) === Number(current) &&
        (currentDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(currentDetailId))
      const nextMatch = next !== null &&
        Number(scheduleMstId) === Number(next) &&
        (nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId))

      // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎäî Í≤ΩÏö∞
      if (current !== null) {
        if (currentMatch) {
          console.log('‚úÖ ÌòÑÏû¨ Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÏßÅÏ†ë ÎÖπÏÉâ Ïä§ÌÉÄÏùº Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
          return {
            backgroundColor: '#c8e6c9 !important',
            borderLeft: '4px solid #4caf50 !important',
            color: '#2e7d32 !important',
            fontWeight: '500 !important'
          }
        }
        if (nextMatch) {
          console.log('‚úÖ Îã§Ïùå Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÏßÅÏ†ë ÌååÎûÄÏÉâ Ïä§ÌÉÄÏùº Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
          return {
            backgroundColor: '#e3f2fd !important',
            borderLeft: '4px solid #2196f3 !important',
            color: '#1565c0 !important',
            fontWeight: '500 !important'
          }
        }
      }
      // Îã§Ïùå ÏòàÏ†ï Ïä§ÏºÄÏ§Ñ (ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎì† ÏóÜÎì† ÌååÎûÄÏÉâÏúºÎ°ú ÌëúÏãú)
      if (next !== null && nextMatch) {
        console.log('‚úÖ Îã§Ïùå Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÏßÅÏ†ë ÌååÎûÄÏÉâ Ïä§ÌÉÄÏùº Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
        return {
          backgroundColor: '#e3f2fd !important',
          borderLeft: '4px solid #2196f3 !important',
          color: '#1565c0 !important',
          fontWeight: '500 !important'
        }
      }
    }

    return {}
  } catch (error) {
    console.error('‚ùå getRowStyleDirect ÏóêÎü¨:', error)
    return {}
  }
}

/**
 * Ìñâ Ïä§ÌÉÄÏùº ÌÅ¥ÎûòÏä§ Î∞òÌôò Ìï®Ïàò
 *
 * PassSchedule Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î¶¨Ìå©ÌÜ†ÎßÅÏóê Îî∞Îùº mstId Í∏∞Ï§Ä Îß§Ïπ≠.
 *
 * @param props Ìñâ Îç∞Ïù¥ÌÑ∞
 * @returns CSS ÌÅ¥ÎûòÏä§Î™Ö
 */
const getRowClass = (props: { row: ScheduleItem }) => {
  try {
    if (!props || !props.row) {
      return ''
    }
    const schedule = props.row
    // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (Ï†ÑÏó≠ Í≥†Ïú† ID + Ìå®Ïä§ Ïù∏Îç±Ïä§)
    const scheduleMstId = schedule.mstId ?? schedule.no
    const scheduleDetailId = schedule.detailId ?? null
    const { current, currentDetailId, next, nextDetailId } = highlightedRows.value

    // ‚úÖ ÎîîÎ≤ÑÍπÖ: getRowClass Ìò∏Ï∂ú Î°úÍ∑∏ (10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•)
    const currentTime = Date.now()
    if (currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
      console.log(`üìã getRowClass Ìò∏Ï∂ú: mstId=${scheduleMstId}, detailId=${scheduleDetailId}, current=${current}/${currentDetailId}, next=${next}/${nextDetailId}`)
      lastDebugLogTime.value = currentTime
    }

    // ‚úÖ Ïä§ÏºÄÏ§Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ Î°úÏßÅ - mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê
    if (scheduleMstId !== undefined) {
      // ‚úÖ mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê (detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
      const currentMatch = current !== null &&
        Number(scheduleMstId) === Number(current) &&
        (currentDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(currentDetailId))
      const nextMatch = next !== null &&
        Number(scheduleMstId) === Number(next) &&
        (nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId))

      // ‚úÖ mstId ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ (14ÏôÄ 28 Î™®Îëê, 10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•)
      if ((Number(scheduleMstId) === 14 || Number(scheduleMstId) === 28) &&
          currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
        console.log(`üî• MSTID ${scheduleMstId} ÎîîÎ≤ÑÍπÖ:`, {
          satelliteName: schedule.satelliteName,
          scheduleMstId,
          scheduleDetailId,
          scheduleMstIdNumber: Number(scheduleMstId),
          current,
          currentDetailId,
          currentNumber: Number(current),
          next,
          nextDetailId,
          nextNumber: Number(next),
          currentMatch,
          nextMatch,
          currentIsNull: current === null,
          nextIsNotNull: next !== null,
          nextDetailIdIsNotNull: nextDetailId !== null,
          scheduleDetailIdIsNotNull: scheduleDetailId !== null,
          nextDetailIdNumber: nextDetailId !== null ? Number(nextDetailId) : null,
          scheduleDetailIdNumber: scheduleDetailId !== null ? Number(scheduleDetailId) : null,
          detailIdMatch: nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId)
        })
        lastDebugLogTime.value = currentTime
      }

      // 1. ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎäî Í≤ΩÏö∞
      if (current !== null) {
        if (currentMatch) {
          // ‚úÖ ÎîîÎ≤ÑÍπÖ: 10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•
          if (currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
            console.log('‚úÖ ÌòÑÏû¨ Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÎÖπÏÉâ Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
            lastDebugLogTime.value = currentTime
          }
          return 'highlight-current-schedule'
        }
        if (nextMatch) {
          // ‚úÖ ÎîîÎ≤ÑÍπÖ: 10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•
          if (currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
            console.log('‚úÖ Îã§Ïùå Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÌååÎûÄÏÉâ Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
            lastDebugLogTime.value = currentTime
          }
          return 'highlight-next-schedule'
        }
      }
      // 2. Îã§Ïùå ÏòàÏ†ï Ïä§ÏºÄÏ§Ñ (ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎì† ÏóÜÎì† ÌååÎûÄÏÉâÏúºÎ°ú ÌëúÏãú)
      if (next !== null && nextMatch) {
        // ‚úÖ ÎîîÎ≤ÑÍπÖ: 10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•
        if (currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
          console.log('‚úÖ Îã§Ïùå Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - ÌååÎûÄÏÉâ Ï†ÅÏö©:', scheduleMstId, scheduleDetailId)
          lastDebugLogTime.value = currentTime
        }
        return 'highlight-next-schedule'  // Îã§Ïùå Ïä§ÏºÄÏ§ÑÏùÄ Ìï≠ÏÉÅ ÌååÎûÄÏÉâ
      }

      // ‚úÖ mstId 14 ÎòêÎäî 28Ïù∏Îç∞ Îß§Ïπ≠ÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ ÏõêÏù∏ Î∂ÑÏÑù (10Ï¥àÎãπ 1Í∞úÏî©Îßå Ï∂úÎ†•)
      if ((Number(scheduleMstId) === 14 || Number(scheduleMstId) === 28) &&
          !currentMatch && !nextMatch &&
          currentTime - lastDebugLogTime.value >= DEBUG_LOG_INTERVAL) {
        console.log(`‚ùå MSTID ${scheduleMstId} Îß§Ïπ≠ Ïã§Ìå® ÏõêÏù∏:`, {
          currentÍ∞í: current,
          currentDetailIdÍ∞í: currentDetailId,
          currentÌÉÄÏûÖ: typeof current,
          nextÍ∞í: next,
          nextDetailIdÍ∞í: nextDetailId,
          nextÌÉÄÏûÖ: typeof next,
          scheduleMstIdÍ∞í: scheduleMstId,
          scheduleDetailIdÍ∞í: scheduleDetailId,
          scheduleMstIdÌÉÄÏûÖ: typeof scheduleMstId,
          Ï°∞Í±¥1_currentÍ∞Änull: current === null,
          Ï°∞Í±¥2_nextÍ∞ÄnotNull: next !== null,
          Ï°∞Í±¥3_nextDetailIdÍ∞ÄnotNull: nextDetailId !== null,
          Ï°∞Í±¥4_scheduleDetailIdÍ∞ÄnotNull: scheduleDetailId !== null,
          Ï°∞Í±¥5_mstIdÎß§Ïπ≠: Number(scheduleMstId) === Number(next),
          Ï°∞Í±¥6_detailIdÎß§Ïπ≠: nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId),
          Ï°∞Í±¥3_nextMatch: nextMatch,
          Ï†ÑÏ≤¥Ï°∞Í±¥: current === null && next !== null && nextMatch
        })
        lastDebugLogTime.value = currentTime
      }
    }

    return ''
  } catch (error) {
    console.error('‚ùå getRowClass ÏóêÎü¨:', error)
    return ''
  }
}





// üîß DOM ÏßÅÏ†ë Ï°∞ÏûëÏúºÎ°ú ÏÉâÏÉÅ Ï†ÅÏö©
const applyRowColors = () => {
  try {
    console.log('üé® DOM ÏßÅÏ†ë Ï°∞ÏûëÏúºÎ°ú ÏÉâÏÉÅ Ï†ÅÏö© ÏãúÏûë')

    const current = icdStore.currentTrackingMstId
    const currentDetailId = icdStore.currentTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    const next = icdStore.nextTrackingMstId
    const nextDetailId = icdStore.nextTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä

    console.log('ÌòÑÏû¨ Store ÏÉÅÌÉú:', { current, currentDetailId, next, nextDetailId })

    setTimeout(() => {
      const rows = document.querySelectorAll('.schedule-table tbody tr')
      console.log(`Ï¥ù ${rows.length}Í∞ú Ìñâ Ï≤òÎ¶¨`)

      // ‚úÖ sortedScheduleListÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ï†ïÌôïÌïú Îß§Ïπ≠
      const schedules = sortedScheduleList.value

      rows.forEach((row, rowIndex) => {
        const htmlRow = row as HTMLElement
        const schedule = schedules[rowIndex]

        if (!schedule) return

        // ‚úÖ mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê
        const scheduleMstId = schedule.mstId ?? schedule.no
        const scheduleDetailId = schedule.detailId ?? null

        // ‚úÖ mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê (detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
        const currentMatch = current !== null &&
          Number(scheduleMstId) === Number(current) &&
          (currentDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(currentDetailId))
        const nextMatch = next !== null &&
          Number(scheduleMstId) === Number(next) &&
          (nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId))

        // Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ï†úÍ±∞
        htmlRow.classList.remove('highlight-current-schedule', 'highlight-next-schedule')
        htmlRow.style.removeProperty('background-color')
        htmlRow.style.removeProperty('border-left')

        const cells = row.querySelectorAll('td')
        cells.forEach(cell => {
          const htmlCell = cell as HTMLElement
          htmlCell.style.removeProperty('background-color')
          htmlCell.style.removeProperty('color')
          htmlCell.style.removeProperty('font-weight')
        })

        // ‚úÖ Îß§Ïπ≠ ÌôïÏù∏ Î∞è ÏÉâÏÉÅ Ï†ÅÏö© (mstIdÏôÄ detailId Í∏∞Ï§Ä)
        let shouldHighlight = false
        let bgColor = ''
        let borderColor = ''
        let textColor = ''

        if (current !== null && currentMatch) {
          // ÌòÑÏû¨ Ïä§ÏºÄÏ§Ñ - ÎÖπÏÉâ
          shouldHighlight = true
          bgColor = '#c8e6c9'
          borderColor = '#4caf50'
          textColor = '#2e7d32'
          console.log(`‚úÖ ÌòÑÏû¨ Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - mstId ${scheduleMstId}/detailId ${scheduleDetailId}Î•º ÎÖπÏÉâÏúºÎ°ú Ï†ÅÏö©`)
        } else if (next !== null && nextMatch) {
          // Îã§Ïùå Ïä§ÏºÄÏ§Ñ - ÌååÎûÄÏÉâ (ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÎì† ÏóÜÎì† Ìï≠ÏÉÅ ÌååÎûÄÏÉâ)
          shouldHighlight = true
          bgColor = '#e3f2fd'
          borderColor = '#2196f3'
          textColor = '#1565c0'
          console.log(`‚úÖ Îã§Ïùå Ïä§ÏºÄÏ§Ñ Îß§Ïπ≠ - mstId ${scheduleMstId}/detailId ${scheduleDetailId}Î•º ÌååÎûÄÏÉâÏúºÎ°ú Ï†ÅÏö©`)
        }

        if (shouldHighlight) {
          // Ìñâ Ï†ÑÏ≤¥ Ïä§ÌÉÄÏùº Ï†ÅÏö©
          htmlRow.style.setProperty('background-color', bgColor, 'important')
          htmlRow.style.setProperty('border-left', `4px solid ${borderColor}`, 'important')

          // Î™®Îì† ÏÖÄÏóê Ïä§ÌÉÄÏùº Ï†ÅÏö©
          cells.forEach(cell => {
            const htmlCell = cell as HTMLElement
            htmlCell.style.setProperty('background-color', bgColor, 'important')
            htmlCell.style.setProperty('color', textColor, 'important')
            htmlCell.style.setProperty('font-weight', '500', 'important')
          })
        }
      })

      console.log('‚úÖ DOM ÏßÅÏ†ë Ï°∞Ïûë ÏôÑÎ£å')
    }, 100)

  } catch (error) {
    console.error('‚ùå applyRowColors ÏóêÎü¨:', error)
  }
}
/*
// üîß ÌòÑÏû¨ Store Í∞íÏúºÎ°ú getRowClass ÌÖåÏä§Ìä∏
const testStoreValues = () => {
  try {
    console.log('üß™ DOM ÏßÅÏ†ë Ï°∞Ïûë ÌÖåÏä§Ìä∏ ÏãúÏûë')
    applyRowColors()
  } catch (error) {
    console.error('‚ùå testStoreValues ÏóêÎü¨:', error)
  }
}

// üîß DOM ÌÅ¥ÎûòÏä§ ÌôïÏù∏ Ìï®Ïàò
const checkDOMClasses = () => {
  try {
    console.log('üîç DOM ÌÅ¥ÎûòÏä§ ÌôïÏù∏ ÏãúÏûë')

    setTimeout(() => {
      const rows = document.querySelectorAll('.schedule-table tbody tr')
      console.log(`Ï¥ù ${rows.length}Í∞ú Ìñâ Î∞úÍ≤¨`)

      rows.forEach((row, idx) => {
        const indexCell = row.querySelector('td:nth-child(2)') // index Ïª¨Îüº
        const indexValue = indexCell?.textContent?.trim()
        const rowClasses = row.className
        const hasHighlight = rowClasses.includes('highlight-current') || rowClasses.includes('highlight-next')

        console.log(`Ìñâ ${idx + 1}: index=${indexValue}, classes="${rowClasses}", ÌïòÏù¥ÎùºÏù¥Ìä∏=${hasHighlight}`)

        // index 14Ïù∏ Ìñâ ÌäπÎ≥Ñ ÌôïÏù∏
        if (indexValue === '14') {
          console.log('üéØ INDEX 14 Ìñâ ÏÉÅÏÑ∏ Î∂ÑÏÑù:')
          console.log(`  - DOM ÌÅ¥ÎûòÏä§: "${rowClasses}"`)
          console.log(`  - Î∞∞Í≤ΩÏÉâ: ${getComputedStyle(row).backgroundColor}`)
          console.log(`  - border-left: ${getComputedStyle(row).borderLeft}`)

          // ÏàòÎèôÏúºÎ°ú ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä ÌÖåÏä§Ìä∏
          row.classList.add('highlight-current-schedule')
          console.log(`  - ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä ÌõÑ: "${row.className}"`)
        }
      })
    }, 100)

  } catch (error) {
    console.error('‚ùå checkDOMClasses ÏóêÎü¨:', error)
  }
}



// üîß Ïã§Ï†ú Îß§Ïπ≠ ÌÖåÏä§Ìä∏ Ìï®Ïàò Ï∂îÍ∞Ä
const realMatchTest = () => {
  try {
    console.log('üîç Ïã§Ï†ú Îß§Ïπ≠ ÏÉÅÌô© Î∂ÑÏÑù')

    const scheduleList = sortedScheduleList.value
    const currentMstId = icdStore.currentTrackingMstId
    const nextMstId = icdStore.nextTrackingMstId

    console.log('üìä Store ÏÉÅÌÉú:', { currentMstId, nextMstId })

    if (scheduleList && scheduleList.length > 0) {
      console.log('üìã Î™®Îì† Ïä§ÏºÄÏ§Ñ Î∂ÑÏÑù:')
      scheduleList.forEach((schedule, idx) => {
        const isCurrentMatch = currentMstId !== null &&
          (schedule.index === currentMstId || schedule.no === currentMstId)
        const isNextMatch = nextMstId !== null &&
          (schedule.index === nextMstId || schedule.no === nextMstId)

        console.log(`  ${idx + 1}. ${schedule.satelliteName}`)
        console.log(`     no: ${schedule.no}, index: ${schedule.index}`)
        console.log(`     Current Îß§Ïπ≠: ${isCurrentMatch} (${currentMstId})`)
        console.log(`     Next Îß§Ïπ≠: ${isNextMatch} (${nextMstId})`)

        if (isCurrentMatch || isNextMatch) {
          const cssClass = getRowClass({ row: schedule })
          console.log(`     ‚úÖ Ï†ÅÏö©Îê† CSS ÌÅ¥ÎûòÏä§: ${cssClass || 'ÏóÜÏùå'}`)
        }
        console.log('     ---')
      })
    }
  } catch (error) {
    console.error('‚ùå realMatchTest ÏóêÎü¨:', error)
  }
}
// üîß ÌÖåÏù¥Î∏î Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌïú ÌÇ§
const tableKey = ref(0)
// üîß watchÎì§ÏùÑ Î™®Îì† computed Ï†ïÏùò ÌõÑÏóê Î∞∞Ïπò
// üîß Í∞ïÏ†ú Î¶¨Î†åÎçîÎßÅ Ìï®Ïàò
const forceTableUpdate = () => {
  tableKey.value++
  console.log('üîÑ ÌÖåÏù¥Î∏î Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏:', tableKey.value)
} */

// üîß Store Í∞í Î≥ÄÍ≤Ω Ïãú DOM ÏßÅÏ†ë Ï°∞Ïûë
watch(
  [() => icdStore?.currentTrackingMstId, () => icdStore?.currentTrackingDetailId, () => icdStore?.nextTrackingMstId, () => icdStore?.nextTrackingDetailId],
  (newValues, oldValues) => {
    try {
      console.log('üîÑ Store ÏÉÅÌÉú Î≥ÄÍ≤Ω Í∞êÏßÄ:', {
        Ïù¥Ï†ÑÍ∞í: oldValues,
        ÏÉàÍ∞í: newValues,
        current: icdStore.currentTrackingMstId,
        currentDetailId: icdStore.currentTrackingDetailId,
        next: icdStore.nextTrackingMstId,
        nextDetailId: icdStore.nextTrackingDetailId
      })

      // üÜï ÏßÄÏó∞Îêú DOM ÏßÅÏ†ë Ï°∞ÏûëÏúºÎ°ú ÏÉâÏÉÅ Ï†ÅÏö©
      setTimeout(() => {
        applyRowColors()
      }, 100)

    } catch (error) {
      console.error('‚ùå Store watch ÏóêÎü¨:', error)
    }
  },
  { immediate: true, deep: true }
)

// üÜï Store Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Í∞êÏßÄ Í∞úÏÑ†
watch(
  () => passScheduleStore.selectedScheduleList,
  (newData, oldData) => {
    try {
      console.log('üëÄ Store Î≥ÄÍ≤Ω Í∞êÏßÄ - ÏÉà Îç∞Ïù¥ÌÑ∞:', {
        newCount: newData?.length || 0,
        oldCount: oldData?.length || 0,
        hasData: newData && newData.length > 0
      })

      // üÜï Îç∞Ïù¥ÌÑ∞Í∞Ä Î≥ÄÍ≤ΩÎêòÎ©¥ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Í∞ïÏ†ú Ïã§Ìñâ
      if (newData && newData.length > 0) {
        setTimeout(() => {
          if (passChart && !passChart.isDisposed()) {
            updateChart()
            console.log('‚úÖ Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤ΩÏúºÎ°ú Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìñâ')
          }
        }, 200)
      }
    } catch (error) {
      console.error('‚ùå passScheduleStore watch ÏóêÎü¨:', error)
    }
  },
  { immediate: true, deep: true }
)

// ‚úÖ Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Ìï®Ïàò (EphemerisDesignationPage.vueÏôÄ Ïú†ÏÇ¨)
const restoreChartData = () => {
  try {
    // ‚úÖ ÏïàÏ†ÑÌïú null Ï≤¥ÌÅ¨
    if (!passChart || passChart.isDisposed() || !chartRef.value) {
      console.warn('‚ö†Ô∏è Ï∞®Ìä∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏïÑ Îç∞Ïù¥ÌÑ∞ Î≥µÏõêÏùÑ Í±¥ÎÑàÎúÅÎãàÎã§')
      return
    }

    // ‚úÖ StoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
    const actualPath = passScheduleStore.actualTrackingPath
    const predictedPath = passScheduleStore.predictedTrackingPath
    const hasActualPath = actualPath && actualPath.length > 0
    const hasPredictedPath = predictedPath && predictedPath.length > 0

    // ‚úÖ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î≥µÏõêÌïòÏßÄ ÏïäÏùå (ÏûêÎèô Î°úÎìú Ï†úÍ±∞ - ÏóêÎü¨ Î∞©ÏßÄ)
    if (!hasActualPath && !hasPredictedPath) {
      console.log('‚ö†Ô∏è Î≥µÏõêÌï† Í≤ΩÎ°ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§')
      return
    }

    // ‚úÖ Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å Í≤ΩÎ°ú Î≥µÏõê
    if (hasActualPath) {
      passChartPool.updateTrackingPath(actualPath as [number, number][])
      console.log('‚úÖ Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å Í≤ΩÎ°ú Î≥µÏõê:', actualPath.length, 'Í∞ú Ìè¨Ïù∏Ìä∏')
    }

    // ‚úÖ ÏòàÏ∏° Í≤ΩÎ°ú Î≥µÏõê
    if (hasPredictedPath) {
      passChartPool.updatePredictedPath(predictedPath as [number, number][])
      console.log('‚úÖ ÏòàÏ∏° Í≤ΩÎ°ú Î≥µÏõê:', predictedPath.length, 'Í∞ú Ìè¨Ïù∏Ìä∏')
    }

    // ‚úÖ Ï∞®Ìä∏ Ïû¨Ï¥àÍ∏∞Ìôî ÏóÜÏù¥ Îç∞Ïù¥ÌÑ∞Îßå ÏóÖÎç∞Ïù¥Ìä∏ (ÏïàÏ†ÑÌïú Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä)
    if (passChart && !passChart.isDisposed()) {
      const updateOption = passChartPool.getUpdateOption()
      passChart.setOption(updateOption, false, true) // ‚úÖ notMerge: false, lazyUpdate: true
      console.log('‚úÖ Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê ÏôÑÎ£å (Ïû¨Ï¥àÍ∏∞Ìôî ÏóÜÏùå)')
    }
  } catch (error) {
    console.error('‚ùå Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Ï§ë Ïò§Î•ò:', error)
  }
}

// üÜï Ïª¥Ìè¨ÎÑåÌä∏ ÌôúÏÑ±Ìôî Ïãú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
const handleActivated = () => {
  try {
    console.log('üîÑ PassSchedulePage ÌôúÏÑ±ÌôîÎê®')

    // ‚úÖ Ï∞®Ìä∏Í∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÍ≥† Ïú†Ìö®ÌïòÎ©¥ Ïû¨Ï¥àÍ∏∞ÌôîÌïòÏßÄ ÏïäÏùå
    if (!passChart || passChart.isDisposed() || !chartRef.value) {
      setTimeout(() => {
        // ‚úÖ Ïª¥Ìè¨ÎÑåÌä∏Í∞Ä Ïó¨Ï†ÑÌûà ÎßàÏö¥Ìä∏ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏
        if (!chartRef.value) {
          console.warn('‚ö†Ô∏è Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑàÍ∞Ä ÏóÜÏñ¥ Ï¥àÍ∏∞ÌôîÎ•º Í±¥ÎÑàÎúÅÎãàÎã§')
          return
        }

        try {
          initChart()
          console.log('‚úÖ Ï∞®Ìä∏ Ïû¨Ï¥àÍ∏∞Ìôî ÏôÑÎ£å')

          // ‚úÖ Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî ÌõÑ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
          void nextTick(() => {
            if (passChart && !passChart.isDisposed() && chartRef.value) {
              restoreChartData()
            }
          })
        } catch (error) {
          console.error('‚ùå Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', error)
        }
      }, 100)
    } else {
      // ‚úÖ keep-aliveÎ°ú Ïù∏Ìï¥ Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§Í∞Ä Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÎê®
      // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ÎèÑ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÎêòÎØÄÎ°ú restoreChartData Ìò∏Ï∂ú Î∂àÌïÑÏöî
      console.log('‚úÖ Ï∞®Ìä∏Í∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï® - Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ (keep-alive)')
    }

    // üÜï ÌÉÄÏù¥Î®∏ Ïû¨ÏãúÏûë
    if (!updateTimer) {
      // ‚úÖ ÌÉÄÏù¥Î®∏Î•º 100msÎ°ú Î≥ÄÍ≤ΩÌïòÏó¨ Î∞±ÏóîÎìú Î™®ÎãàÌÑ∞ÎßÅ Ï£ºÍ∏∞(100ms)ÏôÄ ÏùºÏπò
      updateTimer = window.setInterval(() => {
        try {
          updateChart()
          // ‚úÖ ÌïòÏù¥ÎùºÏù¥Ìä∏ÎèÑ Ï£ºÍ∏∞Ï†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ (Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ)
          applyRowColors()
        } catch (error) {
          console.error('‚ùå Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ïò§Î•ò:', error)
        }
      }, 100)
      console.log('‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ïû¨ÏãúÏûë (100ms)')
    }

    // üÜï DOM ÌïòÏù¥ÎùºÏù¥Ìä∏ Í∞ïÏ†ú Ï†ÅÏö©
    setTimeout(() => {
      try {
        applyRowColors()
      } catch (error) {
        console.error('‚ùå DOM ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö© Ï§ë Ïò§Î•ò:', error)
      }
    }, 200)
  } catch (error) {
    console.error('‚ùå handleActivated Ï§ë Ïò§Î•ò:', error)
  }
}

// ‚úÖ Ïª¥Ìè¨ÎÑåÌä∏ ÎπÑÌôúÏÑ±Ìôî Ïãú ÌÉÄÏù¥Î®∏Îßå Ï†ïÎ¶¨ (keep-aliveÎ°ú Ï∞®Ìä∏ÏôÄ Îç∞Ïù¥ÌÑ∞Îäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÎê®)
const handleDeactivated = () => {
  console.log('üîÑ PassSchedulePage ÎπÑÌôúÏÑ±ÌôîÎê® (keep-alive)')

  // ‚úÖ ÌÉÄÏù¥Î®∏Îßå Ï†ïÎ¶¨ (Ï∞®Ìä∏ÏôÄ Ï∂îÏ†Å Í≤ΩÎ°úÎäî keep-aliveÎ°ú Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ)
  if (updateTimer) {
    clearInterval(updateTimer)
    updateTimer = null
    console.log('‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨Îê®')
  }

  // ‚úÖ Î∏åÎùºÏö∞Ï†Ä ÏÉàÎ°úÍ≥†Ïπ® ÎåÄÎπÑÏö© localStorage Ï†ÄÏû• (ÌéòÏù¥ÏßÄ Í∞Ñ Ïù¥ÎèôÏóêÎäî Î∂àÌïÑÏöîÌïòÏßÄÎßå ÏïàÏ†ÑÏùÑ ÏúÑÌï¥ Ïú†ÏßÄ)
  if (saveTimeout) {
    clearTimeout(saveTimeout)
    saveTimeout = null
  }
  passScheduleStore.saveToLocalStorage()
}

// ‚úÖ localStorage ÏûêÎèô Ï†ÄÏû•ÏùÑ ÏúÑÌïú watch ÏÑ§Ï†ï
watch(
  [
    () => passScheduleStore.predictedTrackingPath,
    () => passScheduleStore.actualTrackingPath,
    () => passScheduleStore.selectedSchedule,
    () => passScheduleStore.selectedScheduleList,
  ],
  () => {
    // ‚úÖ ÎîîÎ∞îÏö¥Ïä§ Ï≤òÎ¶¨ (500ms)
    if (saveTimeout) {
      clearTimeout(saveTimeout)
    }
    saveTimeout = window.setTimeout(() => {
      passScheduleStore.saveToLocalStorage()
    }, 500)
  },
  { deep: true }
)

// ‚úÖ Ï†ÄÏû• ÌÉÄÏù¥Î®∏ Î≥ÄÏàò
let saveTimeout: number | null = null

// üÜï Vue ÏÉùÎ™ÖÏ£ºÍ∏∞ ÌõÖ Îì±Î°ù
onActivated(handleActivated)
onDeactivated(handleDeactivated)

const selectedSchedule = ref<ScheduleItem | null>(null)

// üîß current/next Í∏∞Ï§ÄÏúºÎ°ú ÏûêÎèô ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ
const autoSelectedSchedule = computed(() => {
  try {
    const current = icdStore.currentTrackingMstId
    const currentDetailId = icdStore.currentTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    const next = icdStore.nextTrackingMstId
    const nextDetailId = icdStore.nextTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    const schedules = sortedScheduleList.value

    // 1ÏàúÏúÑ: current Ïä§ÏºÄÏ§Ñ Ï∞æÍ∏∞
    if (current !== null) {
      // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (detailIdÍ∞Ä ÏûàÏúºÎ©¥ Ìï®Íªò ÎπÑÍµê, ÏóÜÏúºÎ©¥ mstIdÎßåÏúºÎ°ú Îß§Ïπ≠)
      const currentSchedule = schedules.find(s => {
        const mstIdMatch = Number(s.mstId) === Number(current)
        // detailIdÍ∞Ä Îëò Îã§ ÏûàÏúºÎ©¥ Ìï®Íªò ÎπÑÍµê, ÏïÑÎãàÎ©¥ mstIdÎßåÏúºÎ°ú Îß§Ïπ≠
        const detailIdMatch = currentDetailId === null || s.detailId === null ||
                              Number(s.detailId) === Number(currentDetailId)
        return mstIdMatch && detailIdMatch
      })
      if (currentSchedule) {
        console.log('üéØ current Í∏∞Ï§Ä ÏûêÎèô ÏÑ†ÌÉù:', currentSchedule.satelliteName, currentSchedule.mstId, currentSchedule.detailId)
        return currentSchedule
      }
    }

    // 2ÏàúÏúÑ: next Ïä§ÏºÄÏ§Ñ Ï∞æÍ∏∞ (currentÍ∞Ä ÏóÜÏùÑ Îïå)
    if (next !== null) {
      // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (detailIdÍ∞Ä ÏûàÏúºÎ©¥ Ìï®Íªò ÎπÑÍµê, ÏóÜÏúºÎ©¥ mstIdÎßåÏúºÎ°ú Îß§Ïπ≠)
      const nextSchedule = schedules.find(s => {
        const mstIdMatch = Number(s.mstId) === Number(next)
        // detailIdÍ∞Ä Îëò Îã§ ÏûàÏúºÎ©¥ Ìï®Íªò ÎπÑÍµê, ÏïÑÎãàÎ©¥ mstIdÎßåÏúºÎ°ú Îß§Ïπ≠
        const detailIdMatch = nextDetailId === null || s.detailId === null ||
                              Number(s.detailId) === Number(nextDetailId)
        return mstIdMatch && detailIdMatch
      })
      if (nextSchedule) {
        console.log('üéØ next Í∏∞Ï§Ä ÏûêÎèô ÏÑ†ÌÉù:', nextSchedule.satelliteName, nextSchedule.mstId, nextSchedule.detailId)
        return nextSchedule
      }
    }

    return null
  } catch (error) {
    console.error('‚ùå autoSelectedSchedule computed ÏóêÎü¨:', error)
    return null
  }
})

// üîß ÏµúÏ¢Ö ÌëúÏãúÌï† Ïä§ÏºÄÏ§Ñ (ÏûêÎèô ÏÑ†ÌÉù Ïö∞ÏÑ†, ÏàòÎèô ÏÑ†ÌÉù Ï∞®ÏàúÏúÑ)
const displaySchedule = computed(() => {
  return autoSelectedSchedule.value || selectedSchedule.value
})

// üîß ÌòÑÏû¨ ÌëúÏãúÌï† Ïä§ÏºÄÏ§ÑÏùò ÏÉÅÌÉú Ï†ïÎ≥¥
const currentScheduleStatus = computed(() => {
  const schedule = displaySchedule.value
  if (!schedule) return null

  try {
    const current = icdStore.currentTrackingMstId
    const currentDetailId = icdStore.currentTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    const next = icdStore.nextTrackingMstId
    const nextDetailId = icdStore.nextTrackingDetailId // ‚úÖ detailId Ï∂îÍ∞Ä
    // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (Ï†ÑÏó≠ Í≥†Ïú† ID + Ìå®Ïä§ Ïù∏Îç±Ïä§)
    const scheduleMstId = Number(schedule.mstId ?? schedule.no)
    const scheduleDetailId = schedule.detailId ?? null

    // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù∏ÏßÄ ÌôïÏù∏ (mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê, detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
    if (current !== null &&
        scheduleMstId === Number(current) &&
        (currentDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(currentDetailId))) {
      return {
        color: 'positive',
        label: 'Ï∂îÏ†ÅÏ§ë'
      }
    }

    // Îã§Ïùå ÏòàÏ†ï Ïä§ÏºÄÏ§ÑÏù∏ÏßÄ ÌôïÏù∏ (mstIdÏôÄ detailId Î™®Îëê ÎπÑÍµê, detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
    if (next !== null &&
        scheduleMstId === Number(next) &&
        (nextDetailId !== null && scheduleDetailId !== null && Number(scheduleDetailId) === Number(nextDetailId))) {
      return {
        color: 'primary',
        label: 'ÎåÄÍ∏∞Ï§ë'
      }
    }

    // ÏùºÎ∞ò Ïä§ÏºÄÏ§Ñ
    return {
      color: 'grey-5',
      label: 'ÏùºÎ∞ò'
    }
  } catch (error) {
    console.error('‚ùå currentScheduleStatus ÏóêÎü¨:', error)
    return null
  }
})

// üîß ÎÇ®ÏùÄ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
const timeRemaining = ref(0)
let timeUpdateTimer: ReturnType<typeof setInterval> | null = null

const updateTimeRemaining = () => {
  if (displaySchedule.value?.startTime) {
    try {
      const startTimeMs = new Date(displaySchedule.value.startTime).getTime()
      const currentCalTime = getCalTimeTimestamp(icdStore.resultTimeOffsetCalTime)
      const remainingMs = startTimeMs - currentCalTime
      timeRemaining.value = remainingMs
    } catch (error) {
      console.error('ÏãúÍ∞Ñ Í≥ÑÏÇ∞ Ïò§Î•ò:', error)
      const clientTime = Date.now()
      const startTimeMs = new Date(displaySchedule.value.startTime).getTime()
      timeRemaining.value = Math.max(0, startTimeMs - clientTime)
    }
  } else {
    timeRemaining.value = 0
  }
}

// üîß Ïã§ÏãúÍ∞Ñ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ ÏãúÏûë/Ï§ëÏßÄ
const startTimeTimer = () => {
  if (timeUpdateTimer) {
    clearInterval(timeUpdateTimer)
  }
  timeUpdateTimer = setInterval(updateTimeRemaining, 1000) // 1Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏
}

const stopTimeTimer = () => {
  if (timeUpdateTimer) {
    clearInterval(timeUpdateTimer)
    timeUpdateTimer = null
  }
}

// üÜï ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏùò Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú (watchÎ≥¥Îã§ Î®ºÏ†Ä ÏÑ†Ïñ∏)
// ‚úÖ ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°úÎßå Î°úÎìú
const loadSelectedScheduleTrackingPath = async () => {
  try {
    // ‚úÖ ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ Ïö∞ÏÑ† ÌôïÏù∏
    const currentTrackingMstId = icdStore.currentTrackingMstId
    let scheduleToLoad: ScheduleItem | null = null

    if (currentTrackingMstId !== null) {
      // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ Ïä§ÏºÄÏ§Ñ ÏÇ¨Ïö©
      // ‚úÖ mstIdÏôÄ detailId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (Ï†ÑÏó≠ Í≥†Ïú† ID + Ìå®Ïä§ Ïù∏Îç±Ïä§, detailIdÍ∞Ä Ìï≠ÏÉÅ Ï°¥Ïû¨ÌïúÎã§Í≥† Í∞ÄÏ†ï)
      const currentDetailId = icdStore.currentTrackingDetailId
      const currentSchedule = sortedScheduleList.value.find(s =>
        Number(s.mstId) === Number(currentTrackingMstId) &&
        (currentDetailId !== null && s.detailId !== null && Number(s.detailId) === Number(currentDetailId))
      )
      if (currentSchedule) {
        scheduleToLoad = currentSchedule
        console.log('üéØ ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°ú Î°úÎìú:', currentSchedule.satelliteName, currentSchedule.mstId, currentSchedule.detailId)
      }
    } else {
      // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏúºÎ©¥ ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ ÏÇ¨Ïö©
      scheduleToLoad = displaySchedule.value
      if (scheduleToLoad) {
        console.log('üìå ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°ú Î°úÎìú:', scheduleToLoad.satelliteName)
      }
    }

    if (!scheduleToLoad) {
      console.log('‚ö†Ô∏è Î°úÎìúÌï† Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏùå')
      return
    }

    // ‚úÖ mstIdÏôÄ detailId ÏÇ¨Ïö© (satelliteId Î∂àÌïÑÏöî)
    const mstId = scheduleToLoad.mstId
    const detailId = scheduleToLoad.detailId

    if (!mstId || detailId == null) {
      console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
        mstId: scheduleToLoad.mstId,
        detailId: scheduleToLoad.detailId,
        no: scheduleToLoad.no,
        satelliteName: scheduleToLoad.satelliteName
      })
      return
    }

    // ‚úÖ Ïä§ÏºÄÏ§ÑÏùò keyhole Ïó¨Î∂ÄÏóê Îî∞Îùº DataType Í≤∞Ï†ï
    const isKeyhole = scheduleToLoad.isKeyhole || scheduleToLoad.IsKeyhole || false
    const dataType = isKeyhole ? 'keyhole_optimized_final_transformed' : 'final_transformed'

    console.log('üöÄ Ïä§ÏºÄÏ§Ñ Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú ÏãúÏûë:', {
      satelliteName: scheduleToLoad.satelliteName,
      mstId,
      detailId,
      isKeyhole,
      dataType,
    })

    // ‚úÖ DataTypeÏùÑ StoreÏóê Ï†ÑÎã¨
    const success = await passScheduleStore.loadTrackingDetailData(
      mstId,
      detailId,
      dataType  // ‚úÖ DataType Ï†ÑÎã¨
    )

    if (success) {
      console.log('‚úÖ Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú ÏôÑÎ£å, Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏')
      // ‚úÖ ÏòàÏ†ï Í≤ΩÎ°ú Í∏∏Ïù¥ Ï¥àÍ∏∞Ìôî (ÏÉà Í≤ΩÎ°ú Î°úÎìú)
      lastPredictedPathLength.value = 0
      // Ï∞®Ìä∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏñ¥ ÏûàÎã§Î©¥ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏ (ÏïàÏ†ÑÌïú Ìò∏Ï∂ú)
      void nextTick(() => {
        if (passChart && !passChart.isDisposed() && typeof updateChart === 'function') {
          try {
            updateChart()
          } catch (error) {
            console.error('‚ùå Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò:', error)
          }
        }
      })
    } else {
      console.warn('‚ö†Ô∏è Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú Ïã§Ìå®')
    }
  } catch (error) {
    console.error('‚ùå Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú Ï§ë Ïò§Î•ò:', error)
  }
}

// üîß Ïä§ÏºÄÏ§Ñ Î≥ÄÍ≤Ω Ïãú ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
watch(displaySchedule, (newSchedule) => {
  updateTimeRemaining()
  if (newSchedule) {
    startTimeTimer()
    // üÜï Ïä§ÏºÄÏ§ÑÏù¥ ÏÑ†ÌÉùÎêòÎ©¥ ÏûêÎèôÏúºÎ°ú Ï∂îÏ†Å Í≤ΩÎ°ú Î°úÎìú
    void loadSelectedScheduleTrackingPath()
  } else {
    stopTimeTimer()
    // üÜï Ïä§ÏºÄÏ§ÑÏù¥ Ìï¥Ï†úÎêòÎ©¥ Ï∂îÏ†Å Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî
    passScheduleStore.clearTrackingPaths()
  }
}, { immediate: true })
const loading = passScheduleStore.loading

// ÏûÖÎ†•Í∞íÍ≥º Ï∂úÎ†•Í∞í - PassSchedule ÎèÖÎ¶ΩÏ†Å ÏÉÅÌÉú
const inputs = ref<string[]>(['0.00', '0.00', '0.00', '0'])
const outputs = ref<string[]>(['0.00', '0.00', '0.00', '0'])

// ÌÖåÏù¥Î∏î Ïª¨Îüº Ï†ïÏùò - StoreÏùò Ïã§Ï†ú ÌïÑÎìúÎ™ÖÏóê ÎßûÏ∂§
type QTableColumn = NonNullable<QTableProps['columns']>[0]

const scheduleColumns: QTableColumn[] = [
  { name: 'no', label: 'No', field: 'no', align: 'center' as const, sortable: true, style: 'width: 60px' },
  { name: 'mstId', label: 'MstId', field: 'mstId', align: 'center' as const, sortable: true, style: 'width: 70px' },
  { name: 'detailId', label: 'DetailId', field: 'detailId', align: 'center' as const, sortable: true, style: 'width: 70px' },
  {
    name: 'satelliteInfo',
    label: 'ÏúÑÏÑ± ID\nÏúÑÏÑ± Ïù¥Î¶Ñ',
    field: 'satelliteId',
    align: 'center' as const,
    sortable: true,
    style: 'width: 120px',
    headerStyle: 'white-space: pre-line; line-height: 1.3; text-align: center; vertical-align: middle;'
  },
  {
    name: 'timeRange',
    label: 'ÏãúÏûë ÏãúÍ∞Ñ\nÏ¢ÖÎ£å ÏãúÍ∞Ñ',
    field: 'startTime',
    align: 'center' as const,
    sortable: true,
    style: 'width: 150px',
    headerStyle: 'white-space: pre-line; line-height: 1.3; text-align: center; vertical-align: middle;'
  },
  {
    name: 'duration',
    label: 'ÏßÄÏÜç ÏãúÍ∞Ñ',
    field: 'duration',
    align: 'center' as const,
    sortable: true,
    format: (val) => formatDuration(val),
    style: 'width: 80px'
  },
  {
    name: 'azimuthRange',
    label: 'Start Az\nEnd Az',
    field: 'startAzimuthAngle',
    align: 'center' as const,
    sortable: true,
    style: 'width: 100px',
    headerStyle: 'white-space: pre-line; line-height: 1.3; text-align: center; vertical-align: middle;'
  },
  {
    name: 'elevationInfo',
    label: 'Max El\nTilt',
    field: 'maxElevation',
    align: 'center' as const,
    sortable: true,
    style: 'width: 80px',
    headerStyle: 'white-space: pre-line; line-height: 1.3; text-align: center; vertical-align: middle;'
  },
  { name: 'keyhole', label: 'keyhole', field: 'keyhole', align: 'center' as const, sortable: false, style: 'width: 80px' },
]

const formatDateTime = (dateString: string): string => {
  try {
    return formatToLocalTime(dateString)
  } catch (error) {
    console.error('ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ Ïò§Î•ò:', error)
    return dateString
  }
}

const formatAngle = (angle: number | undefined | null): string => {
  if (angle === undefined || angle === null) return '-'
  return `${angle.toFixed(1)}¬∞`
}

// ‚úÖ Duration Ìè¨Îß∑ Ìï®Ïàò Ï∂îÍ∞Ä (ISO 8601 Duration ÌòïÏãù ÌååÏã±)
const formatDuration = (duration: string): string => {
  if (!duration) return '0Î∂Ñ 0Ï¥à'

  // ISO 8601 Duration ÌòïÏãù (PT13M43.6S) ÌååÏã±
  const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?/)
  if (!match) return duration // ÌååÏã± Ïã§Ìå® Ïãú ÏõêÎ≥∏ Î∞òÌôò

  const hours = parseInt(match[1] || '0', 10)
  const minutes = parseInt(match[2] || '0', 10)
  const seconds = parseFloat(match[3] || '0')

  const parts: string[] = []
  if (hours > 0) parts.push(`${hours}ÏãúÍ∞Ñ`)
  if (minutes > 0) parts.push(`${minutes}Î∂Ñ`)
  if (seconds > 0) parts.push(`${Math.round(seconds)}Ï¥à`)

  return parts.length > 0 ? parts.join(' ') : '0Î∂Ñ 0Ï¥à'
}

// TLE ÏóÖÎ°úÎìú Ìï∏Îì§Îü¨
const handleTLEUpload = async () => {
  try {
    console.log('TLE ÏóÖÎ°úÎìú Î™®Îã¨ Ïó¥Í∏∞')

    const modal = await openModal('tle-upload', {
      width: 1000,
      height: 860,
      modalClass: 'tle-upload-modal',
      onClose: () => {
        void (async () => {
          console.log('TLE ÏóÖÎ°úÎìú Î™®Îã¨ Îã´Ìûò')

          // ‚úÖ TLE ÏóÖÎ°úÎìú ÌõÑ Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†
          // ÏóÖÎ°úÎìúÍ∞Ä ÏÑ±Í≥µÌñàÏùÑ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÏúºÎØÄÎ°ú Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞Î•º Í∞ïÏ†úÎ°ú Îã§Ïãú Î°úÎìú
          try {
            console.log('üîÑ TLE ÏóÖÎ°úÎìú ÌõÑ Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã† ÏãúÏûë')

            // ‚úÖ ÏµúÏã† Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (fetchScheduleDataFromServerÍ∞Ä ÎÇ¥Î∂ÄÏóêÏÑú ÏûêÎèôÏúºÎ°ú ÎçÆÏñ¥ÏîÄ)
            await passScheduleStore.fetchScheduleDataFromServer()

            console.log('‚úÖ Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã† ÏôÑÎ£å:', passScheduleStore.scheduleData.length, 'Í∞ú')
          } catch (error) {
            console.error('‚ùå Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã† Ïã§Ìå®:', error)
          }
        })()
      },
      onError: (error) => {
        console.error('TLE ÏóÖÎ°úÎìú Î™®Îã¨ Ïò§Î•ò:', error)
        $q.notify({
          type: 'negative',
          message: 'TLE ÏóÖÎ°úÎìú Ï∞ΩÏùÑ Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§',
        })
      },
    })

    if (modal) {
      console.log('TLE ÏóÖÎ°úÎìú Î™®Îã¨ Ïó¥Í∏∞ ÏÑ±Í≥µ')
    }
  } catch (error) {
    console.error('TLE ÏóÖÎ°úÎìú Î™®Îã¨ Ïó¥Í∏∞ Ïã§Ìå®:', error)
    $q.notify({
      type: 'negative',
      message: 'TLE ÏóÖÎ°úÎìú Ï∞ΩÏùÑ Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§',
    })
  }
}

// ‚úÖ Ï∞®Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†ï Ìï®Ïàò (Ïô∏Î∂ÄÏóêÏÑúÎèÑ Ìò∏Ï∂ú Í∞ÄÎä•) - DOM Ïä§ÌÉÄÏùºÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌïòÏó¨ ÍπúÎπ°ÏûÑ Î∞©ÏßÄ
const adjustChartSize = async () => {
  await nextTick() // ‚úÖ VueÏùò DOM ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å ÎåÄÍ∏∞

  if (!passChart || passChart.isDisposed() || !chartRef.value) return

  // ‚úÖ Ï∞®Ìä∏ ÌÅ¨Í∏∞ ÏÑ§Ï†ï
  const chartSize = 500

  // ‚úÖ 1Îã®Í≥Ñ: DOM Ïä§ÌÉÄÏùºÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ï (Î¶¨ÏÇ¨Ïù¥Ï¶à Ï†ÑÏóê!)
  // Ïù¥Î†áÍ≤å ÌïòÎ©¥ Ï∞®Ìä∏Í∞Ä Ï≤òÏùåÎ∂ÄÌÑ∞ Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóêÏÑú Î†åÎçîÎßÅÎêòÏñ¥ ÍπúÎπ°ÏûÑÏù¥ ÏóÜÏùå
  const chartElement = chartRef.value.querySelector('div') as HTMLElement | null
  if (chartElement) {
    // ‚úÖ Ïä§ÌÉÄÏùºÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌïòÏó¨ Ï∞®Ìä∏Í∞Ä Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóêÏÑú Î†åÎçîÎßÅÎêòÎèÑÎ°ù Ìï®
    chartElement.style.width = `${chartSize}px`
    chartElement.style.height = `${chartSize}px`
    chartElement.style.maxWidth = `${chartSize}px`
    chartElement.style.maxHeight = `${chartSize}px`
    chartElement.style.minWidth = `${chartSize}px`
    chartElement.style.minHeight = `${chartSize}px`
    // ‚úÖ Ï§ëÏïô Ï†ïÎ†¨
    chartElement.style.top = '50%'
    chartElement.style.position = 'absolute'
    chartElement.style.left = '50%'
    chartElement.style.transform = 'translate(-50%, -50%)'
  }

  // ‚úÖ 2Îã®Í≥Ñ: DOM Ïä§ÌÉÄÏùº Ï†ÅÏö© ÌõÑ Î¶¨ÏÇ¨Ïù¥Ï¶à (Ïä§ÌÉÄÏùºÏù¥ Ï†ÅÏö©Îêú ÏÉÅÌÉúÏóêÏÑú)
  await nextTick()
  passChart.resize({
    width: chartSize,
    height: chartSize
  })

  console.log('Ï∞®Ìä∏ Î¶¨ÏÇ¨Ïù¥Ï¶à ÏôÑÎ£å:', chartSize)
}

// ‚úÖ Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ìï®Ïàò ÏàòÏ†ï - Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞Ïóê ÎßûÏ∂ò ÌÅ¨Í∏∞
const initChart = () => {
  try {
    // ‚úÖ Ïù¥ÎØ∏ Ï¥àÍ∏∞ÌôîÎêòÏóàÏúºÎ©¥ Ïû¨Ï¥àÍ∏∞ÌôîÌïòÏßÄ ÏïäÏùå
    if (isChartInitialized.value && passChart && !passChart.isDisposed()) {
      console.log('‚úÖ Ï∞®Ìä∏Í∞Ä Ïù¥ÎØ∏ Ï¥àÍ∏∞ÌôîÎêòÏñ¥ ÏûàÏùå - Ïû¨Ï¥àÍ∏∞Ìôî Í±¥ÎÑàÎúÄ')
      return
    }

    if (!chartRef.value) {
      console.warn('‚ö†Ô∏è Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑàÍ∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏùå')
      return
    }

    // Í∏∞Ï°¥ Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§Í∞Ä ÏûàÏúºÎ©¥ Ï†úÍ±∞
    if (passChart) {
      try {
        passChart.dispose()
      } catch (disposeError) {
        console.warn('Ï∞®Ìä∏ dispose Ïò§Î•ò (Î¨¥Ïãú):', disposeError)
      }
    }

    // ‚úÖ Ï∞®Ìä∏ ÌÅ¨Í∏∞ ÏÑ§Ï†ï (Ï∞®Ìä∏Î•º Îçî ÌÅ¨Í≤å, Position View Íµ¨Ïó≠ ÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†Å)
    const initialSize = 500

    // Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±
    passChart = echarts.init(chartRef.value, null, {
      width: initialSize,
      height: initialSize
    })
    console.log('PassSchedule Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±Îê®, ÌÅ¨Í∏∞:', initialSize)

    // Ï∞®Ìä∏ ÏòµÏÖò ÏÑ§Ï†ï
    const option = {
      backgroundColor: 'transparent',
      grid: {
        left: '10%', /* ‚úÖ Í∑†Îì±Ìïú Ïó¨Î∞± ÌôïÎ≥¥ */
        right: '10%',
        top: '10%',
        bottom: '10%',
        containLabel: false
      },
      polar: {
        radius: ['0%', '50%'],
        center: ['50%', '50%'],
      },
      angleAxis: {
        type: 'value',
        startAngle: 90,
        clockwise: true,
        min: 0,
        max: 360,
        animation: false, // ‚úÖ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÏ†Ñ ÎπÑÌôúÏÑ±Ìôî
        axisLine: {
          show: true,
          lineStyle: {
            color: '#555',
          },
        },
        axisTick: {
          show: true,
          interval: 60,
          length: 3,
          lineStyle: {
            color: '#555',
          },
        },
        axisLabel: {
          interval: 60,
          formatter: function (value: number) {
            if (value === 0) return 'N (0¬∞)'
            if (value === 90) return 'E (90¬∞)'
            if (value === 180) return 'S (180¬∞)'
            if (value === 270) return 'W (270¬∞)'
            if (value === 45) return 'NE (45¬∞)'
            if (value === 135) return 'SE (135¬∞)'
            if (value === 225) return 'SW (225¬∞)'
            if (value === 315) return 'NW (315¬∞)'
            if (value % 60 === 0) return value + '¬∞'
            return ''
          },
          color: '#999',
          fontSize: 8,
          distance: -8,
        },
        splitLine: {
          show: true,
          interval: 60,
          lineStyle: {
            color: '#555',
            type: 'dashed',
            width: 1,
          },
        },
      },
      radiusAxis: {
        type: 'value',
        min: 0,
        max: 90,
        inverse: true,
        animation: false, // ‚úÖ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÏ†Ñ ÎπÑÌôúÏÑ±Ìôî
        axisLine: {
          show: false,
        },
        axisTick: {
          show: false,
        },
        axisLabel: {
          formatter: '{value}¬∞',
          color: '#999',
          fontSize: 8,
        },
        splitLine: {
          show: true,
          lineStyle: {
            color: '#555',
            type: 'dashed',
          },
        },
      },
      series: [
        {
          name: 'Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å ÏúÑÏπò',
          type: 'scatter',
          coordinateSystem: 'polar',
          symbol: 'circle',
          symbolSize: 15,
          animation: false, // ‚úÖ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÏ†Ñ ÎπÑÌôúÏÑ±Ìôî
          itemStyle: {
            color: '#ff5722',
          },
          data: [[0, 0]],
          emphasis: {
            itemStyle: {
              color: '#ff9800',
              borderColor: '#fff',
              borderWidth: 2,
            },
          },
          label: {
            show: true,
            formatter: function (params: EChartsScatterParam) {
              // ‚úÖ ÏõêÎ≥∏ Í∞í ÌëúÏãú (Ï†ïÍ∑úÌôîÎêú Í∞íÏù¥ ÏïÑÎãå)
              const originalAz = currentPosition.value?.azimuth || params.value[1]
              const originalEl = currentPosition.value?.elevation || params.value[0]
              return `Az: ${originalAz.toFixed(2)}¬∞\nEl: ${originalEl.toFixed(2)}¬∞`
            },
            position: 'top',
            distance: 5,
            color: '#fff',
            backgroundColor: 'rgba(0,0,0,0.7)',
            padding: [4, 8],
            borderRadius: 4,
            fontSize: 10,
          },
          zlevel: 3,
        },
        // ‚úÖ ÏúÑÏπò ÏÑ† Ï†úÍ±∞ - ÌòÑÏû¨ ÏúÑÏπò Ï†êÏù¥ Ïù¥ÎèôÌïòÎ©¥ÏÑú Ïã§ÏãúÍ∞Ñ Í≤ΩÎ°úÎ•º Í∑∏Î¶¨ÎØÄÎ°ú Î∂àÌïÑÏöî
        {
          name: 'Ïã§ÏãúÍ∞Ñ Ï∂îÏ†Å Í≤ΩÎ°ú',
          type: 'line',
          coordinateSystem: 'polar',
          symbol: 'none',
          animation: false, // ‚úÖ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÏ†Ñ ÎπÑÌôúÏÑ±Ìôî
          lineStyle: {
            color: '#ffffff', // Ìù∞ÏÉâ
            width: 2,
            opacity: 0.8,
          },
          data: [],
          zlevel: 2,
        },
        {
          name: 'ÏòàÏ†ï ÏúÑÏÑ± Í∂§Ï†Å',
          type: 'line',
          coordinateSystem: 'polar',
          symbol: 'none',
          animation: false, // ‚úÖ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÏ†Ñ ÎπÑÌôúÏÑ±Ìôî
          lineStyle: {
            color: '#2196f3', // ÌååÎûÄÏÉâ
            width: 2,
          },
          data: [],
          zlevel: 1,
        },
      ],
    }

    // Ï∞®Ìä∏ ÏòµÏÖò Ï†ÅÏö© (Ï¥àÍ∏∞ ÌÅ¨Í∏∞)
    passChart.setOption(option, true)
    passChart.resize({
      width: initialSize,
      height: initialSize
    })
    console.log('PassSchedule Ï∞®Ìä∏ ÏòµÏÖò Ï†ÅÏö©Îê®')

    // ‚úÖ DOM Ïä§ÌÉÄÏùºÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ï (Î¶¨ÏÇ¨Ïù¥Ï¶à Ï†ÑÏóê!) - EphemerisDesignationPage.vueÏôÄ ÎèôÏùº
    void nextTick(() => {
      const chartElement = chartRef.value?.querySelector('div') as HTMLElement | null
      if (chartElement) {
        // ‚úÖ Ïä§ÌÉÄÏùºÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌïòÏó¨ Ï∞®Ìä∏Í∞Ä Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóêÏÑú Î†åÎçîÎßÅÎêòÎèÑÎ°ù Ìï®
        chartElement.style.width = `${initialSize}px`
        chartElement.style.height = `${initialSize}px`
        chartElement.style.maxWidth = `${initialSize}px`
        chartElement.style.maxHeight = `${initialSize}px`
        chartElement.style.minWidth = `${initialSize}px`
        chartElement.style.minHeight = `${initialSize}px`
        chartElement.style.position = 'absolute'
        chartElement.style.top = '50%'
        chartElement.style.left = '50%'
        chartElement.style.transform = 'translate(-50%, -50%)'
      }

      // ‚úÖ Ïä§ÌÉÄÏùº Ï†ÅÏö© ÌõÑ Î¶¨ÏÇ¨Ïù¥Ï¶à
      void nextTick(() => {
        if (passChart && !passChart.isDisposed()) {
          passChart.resize({
            width: initialSize,
            height: initialSize
          })
        }
      })
    })

    // ‚úÖ ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏Ïóê ÎåÄÏùë (Î∞òÏùëÌòï) - Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞ Í∏∞Î∞ò
    // ‚úÖ Í∏∞Ï°¥ Î¶¨ÏÇ¨Ïù¥Ï¶à Î¶¨Ïä§ÎÑà Ï†úÍ±∞ (Ï§ëÎ≥µ Î∞©ÏßÄ)
    if (chartResizeHandler) {
      window.removeEventListener('resize', chartResizeHandler)
      chartResizeHandler = null
    }

    chartResizeHandler = () => {
      if (!passChart || passChart.isDisposed()) return

      nextTick().then(() => {
        // ‚úÖ Î¶¨ÏÇ¨Ïù¥Ï¶à ÏãúÏóêÎèÑ Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞Ïóê ÎßûÏ∂∞ Ï°∞Ï†ï
        adjustChartSize().catch(console.error)
      }).catch(console.error)
    }

    window.addEventListener('resize', chartResizeHandler)

    // ‚úÖ Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
    isChartInitialized.value = true
    console.log('‚úÖ Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï')
  } catch (error) {
    console.error('Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', error)
    // Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ïã§Ìå®Ìï¥ÎèÑ Ïª¥Ìè¨ÎÑåÌä∏Îäî Í≥ÑÏÜç Î†åÎçîÎßÅÎêòÎèÑÎ°ù Ìï®
    isChartInitialized.value = false
  }
}



// üÜï ÏÑ±Îä• ÏµúÏ†ÅÌôîÎ•º ÏúÑÌïú Î≥ÄÏàòÎì§
const lastUpdateTime = ref(0)
const updateThrottle = 100 // ‚úÖ 100msÎ°ú Î≥ÄÍ≤ΩÌïòÏó¨ Î∞±ÏóîÎìú Î™®ÎãàÌÑ∞ÎßÅ Ï£ºÍ∏∞(100ms)ÏôÄ ÏùºÏπò
const lastPathLength = ref(0)
const pathUpdateThreshold = 5 // Í≤ΩÎ°ú Ìè¨Ïù∏Ìä∏Í∞Ä 5Í∞ú Ïù¥ÏÉÅ Î≥ÄÍ≤ΩÎê† ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏
// ‚úÖ appendDataÎ•º ÏúÑÌïú Ïù¥Ï†Ñ Í≤ΩÎ°ú Í∏∏Ïù¥ Ï∂îÏ†Å (Ïù¥ÎØ∏ ÏúÑÏóêÏÑú ÏÑ†Ïñ∏Îê®)

// üÜï Í≤ΩÎ°ú Îß§Ïπ≠ Î°úÍ∑∏ Ïä§Î°úÌãÄÎßÅ
const lastPathMatchLogTime = ref(0)
const PATH_MATCH_LOG_INTERVAL = 10000 // 10Ï¥à

// üÜï Ïù¥Ï†Ñ ÏÉÅÌÉú Ï∂îÏ†Å (Î≥ÄÍ≤Ω Í∞êÏßÄÏö©)
const lastPosition = ref<{ azimuth: number; elevation: number } | null>(null)
const lastPathInfo = ref<{ mstId: number | null; detailId: number | null } | null>(null)
// ‚úÖ lastPredictedPathLengthÎäî Ïù¥ÎØ∏ 515ÎùºÏù∏ÏóêÏÑú ÏÑ†Ïñ∏Îê® (Ï§ëÎ≥µ ÏÑ†Ïñ∏ Ï†úÍ±∞)
const POSITION_CHANGE_THRESHOLD = 0.1 // 0.1ÎèÑ Ïù¥ÏÉÅ Î≥ÄÍ≤ΩÎê† ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏

// üÜï ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ Î∞è Ï†ÅÏùëÌòï Ìï¥ÏÉÅÎèÑ Ï°∞Ï†ï
const performanceMonitor = {
  lastFrameTime: 0,
  frameCount: 0,
  averageFrameTime: 0,
  performanceThreshold: 16.67, // 60fps Í∏∞Ï§Ä (16.67ms)
  slowFrameThreshold: 33.33, // 30fps Í∏∞Ï§Ä (33.33ms)
  currentResolution: 1, // 1 = Î™®Îì† Ìè¨Ïù∏Ìä∏ ÌëúÏãú, 10 = 1/10 ÌëúÏãú
  maxResolution: 1,
  minResolution: 10,
}

// üÜï Ï†ÅÏùëÌòï Ìï¥ÏÉÅÎèÑ Ï°∞Ï†ï Ìï®Ïàò
const adjustDisplayResolution = (pathLength: number, frameTime: number) => {
  const currentRes = performanceMonitor.currentResolution

  // ÏÑ±Îä•Ïù¥ Ï¢ãÏúºÎ©¥ Ìï¥ÏÉÅÎèÑ ÎÜíÏù¥Í∏∞
  if (frameTime < performanceMonitor.performanceThreshold && currentRes > performanceMonitor.maxResolution) {
    performanceMonitor.currentResolution = Math.max(performanceMonitor.maxResolution, currentRes - 1)
    console.log(`üü¢ ÏÑ±Îä• Í∞úÏÑ† - Ìï¥ÏÉÅÎèÑ Ï¶ùÍ∞Ä: 1/${currentRes} ‚Üí 1/${performanceMonitor.currentResolution}`)
  }

  // ÏÑ±Îä•Ïù¥ ÎÇòÏÅòÎ©¥ Ìï¥ÏÉÅÎèÑ ÎÇÆÏ∂îÍ∏∞
  if (frameTime > performanceMonitor.slowFrameThreshold && currentRes < performanceMonitor.minResolution) {
    performanceMonitor.currentResolution = Math.min(performanceMonitor.minResolution, currentRes + 1)
    console.log(`üî¥ ÏÑ±Îä• Ï†ÄÌïò - Ìï¥ÏÉÅÎèÑ Í∞êÏÜå: 1/${currentRes} ‚Üí 1/${performanceMonitor.currentResolution}`)
  }

  // Ìè¨Ïù∏Ìä∏ Ïàò Í∏∞Î∞ò ÏûêÎèô Ï°∞Ï†ï
  if (pathLength > 1000 && currentRes === 1) {
    performanceMonitor.currentResolution = 10
    console.log(`üìä Ìè¨Ïù∏Ìä∏ Ïàò Ï¥àÍ≥º - ÏûêÎèô Ìï¥ÏÉÅÎèÑ Ï°∞Ï†ï: 1/1 ‚Üí 1/10`)
  }

  return performanceMonitor.currentResolution
}

// üÜï Ï†ÅÏùëÌòï Í≤ΩÎ°ú ÏµúÏ†ÅÌôî Ìï®Ïàò
const optimizePathAdaptive = (path: [number, number][], resolution: number): [number, number][] => {
  if (!path || path.length === 0) return []

  // Ìï¥ÏÉÅÎèÑÏóê Îî∞Îùº Ìè¨Ïù∏Ìä∏ ÏÉòÌîåÎßÅ
  const optimizedPath: [number, number][] = []

  for (let i = 0; i < path.length; i += resolution) {
    const point = path[i]
    if (point && Array.isArray(point) && point.length === 2) {
      optimizedPath.push(point)
    }
  }

  // ÎßàÏßÄÎßâ Ìè¨Ïù∏Ìä∏Îäî Ìï≠ÏÉÅ Ìè¨Ìï®
  const lastPoint = path[path.length - 1]
  if (lastPoint && Array.isArray(lastPoint) && lastPoint.length === 2 &&
    optimizedPath[optimizedPath.length - 1] !== lastPoint) {
    optimizedPath.push(lastPoint)
  }

  return optimizedPath
}

// üÜï ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅÏù¥ Ìè¨Ìï®Îêú Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
const updateChartWithPerformanceMonitoring = () => {
  try {
    if (!passChart || passChart.isDisposed()) {
      return
    }

    const startTime = performance.now()
    const now = Date.now()

    // Ïä§Î°úÌãÄÎßÅ
    if (now - lastUpdateTime.value < updateThrottle) {
      return
    }

    // ‚úÖ Ï∂îÏ†Å ÏÉÅÌÉú ÌôïÏù∏ (TRACKING ÏÉÅÌÉúÏóêÏÑúÎßå trackingActual ÏÇ¨Ïö©)
    // PassScheduleÏùÄ passScheduleTrackingStateÎ•º ÏÇ¨Ïö© (ephemerisTrackingStateÍ∞Ä ÏïÑÎãò)
    // COMPLETED, IDLE, WAITING, PREPARING ÏÉÅÌÉúÏóêÏÑúÎäî ÏùºÎ∞ò Í∞ÅÎèÑ Í∞í ÏÇ¨Ïö©
    const trackingState = icdStore.passScheduleTrackingState
    const isActuallyTracking = trackingState === 'TRACKING'

    // ‚úÖ Í∏∞Î≥∏Í∞í: ÏùºÎ∞ò Í∞ÅÎèÑ Í∞í (ÏïàÌÖåÎÇò Ïã§Ï†ú ÏúÑÏπò)
    let azimuth = parseFloat(icdStore.azimuthAngle) || 0
    let elevation = parseFloat(icdStore.elevationAngle) || 0

    // ‚úÖ Ïã§Ï†ú Ï∂îÏ†Å Ï§ëÏùº ÎïåÎßå trackingActual Í∞í ÏÇ¨Ïö© (Ï†êÌîÑ ÌòÑÏÉÅ Î∞©ÏßÄ)
    if (isActuallyTracking) {
      const trackingAz = parseFloat(icdStore.trackingActualAzimuthAngle)
      const trackingEl = parseFloat(icdStore.trackingActualElevationAngle)
      // ‚úÖ trackingCMD Í∞í Ï∂îÍ∞Ä (Ïù¥Ï†Ñ ÏÑ∏ÏÖò Í∞í Í≤ÄÏ¶ùÏö©)
      const trackingCmdAz = parseFloat(icdStore.trackingCMDAzimuthAngle)
      const trackingCmdEl = parseFloat(icdStore.trackingCMDElevationAngle)

      // ‚úÖ trackingActualÏù¥ CMD Í∞íÍ≥º Í∑ºÏ†ëÌïúÏßÄ ÌôïÏù∏ (Ïù¥Ï†Ñ ÏÑ∏ÏÖò Í∞í Î∞©ÏßÄ)
      // CMD Í∞íÏù¥ Ïú†Ìö®ÌïòÏßÄ ÏïäÏúºÎ©¥ trackingActualÎèÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå (Ï∂îÏ†Å ÏãúÏûë ÏßÅÌõÑ Ï†êÌîÑ Î∞©ÏßÄ)
      const hasCmdAz = !isNaN(trackingCmdAz) && trackingCmdAz !== 0
      const hasCmdEl = !isNaN(trackingCmdEl) && trackingCmdEl !== 0
      const isTrackingAzValid = !isNaN(trackingAz) && trackingAz !== 0 &&
        hasCmdAz && Math.abs(trackingAz - trackingCmdAz) < 5
      const isTrackingElValid = !isNaN(trackingEl) && trackingEl !== 0 &&
        hasCmdEl && Math.abs(trackingEl - trackingCmdEl) < 5

      // ‚úÖ Í≤ÄÏ¶ùÎêú trackingActual ‚Üí trackingCMD ‚Üí ÏùºÎ∞ò Í∞í
      if (isTrackingAzValid) {
        azimuth = trackingAz
      } else if (hasCmdAz) {
        azimuth = trackingCmdAz
      }
      // else: ÏùºÎ∞ò azimuthAngle Í∞í Ïú†ÏßÄ

      if (isTrackingElValid) {
        elevation = trackingEl
      } else if (hasCmdEl) {
        elevation = trackingCmdEl
      }
      // else: ÏùºÎ∞ò elevationAngle Í∞í Ïú†ÏßÄ
    }
    // ‚úÖ isActuallyTracking === falseÏùº ÎïåÎäî ÏùºÎ∞ò azimuthAngle/elevationAngle Í∞í Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©

    const normalizedAz = azimuth < 0 ? azimuth + 360 : azimuth
    const normalizedEl = Math.max(0, Math.min(90, elevation))

    // üÜï ÏúÑÏπò Î≥ÄÍ≤Ω Í∞êÏßÄ (Ïã§Ï†ú Î≥ÄÍ≤ΩÏù¥ ÏûàÏùÑ ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏)
    const currentPos = { azimuth: normalizedAz, elevation: normalizedEl }
    const hasPositionChanged = !lastPosition.value ||
      Math.abs(currentPos.azimuth - lastPosition.value.azimuth) > POSITION_CHANGE_THRESHOLD ||
      Math.abs(currentPos.elevation - lastPosition.value.elevation) > POSITION_CHANGE_THRESHOLD

    currentPosition.value = currentPos

    // Í≤ΩÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ Ï°∞Í±¥
    const shouldUpdatePath = icdStore.passScheduleStatusInfo?.isActive === true ||
      icdStore.currentTrackingMstId !== null ||
      icdStore.nextTrackingMstId !== null

    // üÜï actualPath ÏÑ†Ïñ∏
    const actualPath = passScheduleStore.actualTrackingPath

    if (shouldUpdatePath) {
      const currentPathLength = actualPath?.length || 0

      if (Math.abs(currentPathLength - lastPathLength.value) >= pathUpdateThreshold) {
        console.log('‚úÖ Ï∂îÏ†Å Í≤ΩÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë (Ï†ÅÏùëÌòï Ìï¥ÏÉÅÎèÑ)')
        void passScheduleStore.updateActualTrackingPath(normalizedAz, normalizedEl)
        lastPathLength.value = currentPathLength
      }
    }

    // üÜï Ï†ÅÏùëÌòï Ìï¥ÏÉÅÎèÑ Ï°∞Ï†ï
    // ‚úÖ Ï∞®Ìä∏ Í≤ΩÎ°ú ÌëúÏãú Ïö∞ÏÑ†ÏàúÏúÑ: ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÎßå ÌëúÏãú
    const currentTrackingMstId = icdStore.currentTrackingMstId
    const selectedSchedule = displaySchedule.value
    const shouldShowPredictedPath = currentTrackingMstId !== null || selectedSchedule !== null

    // üÜï pathInfoÎ•º Ìï®Ïàò ÏÉÅÎã®ÏóêÏÑú ÏÑ†Ïñ∏ (Ïä§ÏΩîÌîÑ Î¨∏Ï†ú Ìï¥Í≤∞)
    const pathInfo = passScheduleStore.currentTrackingPathInfo

    // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°úÎßå, ÏóÜÏúºÎ©¥ ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°úÎßå ÌëúÏãú
    let predictedPathToShow: [number, number][] = []

    if (shouldShowPredictedPath) {
      const currentPath = passScheduleStore.predictedTrackingPath

      // ‚úÖ Í≤ΩÎ°úÍ∞Ä ÏûàÏúºÎ©¥ Îß§Ïπ≠ ÌôïÏù∏, ÏóÜÏúºÎ©¥ ÌëúÏãúÌïòÏßÄ ÏïäÏùå (mstId, detailIdÎßå ÎπÑÍµê)
      if (currentPath && currentPath.length > 0) {
        // ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§ÑÏù¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°ú ÏÇ¨Ïö©
        if (currentTrackingMstId !== null) {
          // ‚úÖ mstId Í∏∞Ï§ÄÏúºÎ°ú Îß§Ïπ≠ (Ï†ÑÏó≠ Í≥†Ïú† ID)
          const currentSchedule = sortedScheduleList.value.find(s => Number(s.mstId) === Number(currentTrackingMstId))
          if (currentSchedule) {
            const scheduleMstId = currentSchedule.mstId
            const scheduleDetailId = currentSchedule.detailId

            // ‚úÖ Í≤ΩÎ°ú Îß§Ïπ≠: mstIdÏôÄ detailIdÎßå ÎπÑÍµê
            if (!pathInfo.passId ||
                (pathInfo.passId === scheduleMstId &&
                 pathInfo.detailId === scheduleDetailId)) {
              predictedPathToShow = currentPath.map((point: readonly [number, number]) => [...point])

              // üÜï Î°úÍ∑∏ Ïä§Î°úÌãÄÎßÅ (10Ï¥àÎãπ 1Í∞ú)
              const currentTime = Date.now()
              if (currentTime - lastPathMatchLogTime.value >= PATH_MATCH_LOG_INTERVAL) {
                console.log('‚úÖ ÌòÑÏû¨ Ï∂îÏ†Å Ïä§ÏºÄÏ§Ñ Í≤ΩÎ°ú ÌëúÏãú:', {
                  scheduleMstId,
                  scheduleDetailId,
                  pathInfoMstId: pathInfo.passId,
                  pathInfoDetailId: pathInfo.detailId,
                  pathLength: currentPath.length
                })
                lastPathMatchLogTime.value = currentTime
              }
            } else {
              // üÜï Î°úÍ∑∏ Ïä§Î°úÌãÄÎßÅ (10Ï¥àÎãπ 1Í∞ú)
              const currentTime = Date.now()
              if (currentTime - lastPathMatchLogTime.value >= PATH_MATCH_LOG_INTERVAL) {
                console.log('‚ö†Ô∏è Í≤ΩÎ°ú Îß§Ïπ≠ Ïã§Ìå® (ÌòÑÏû¨ Ï∂îÏ†Å):', {
                  scheduleMstId,
                  scheduleDetailId,
                  pathInfoMstId: pathInfo.passId,
                  pathInfoDetailId: pathInfo.detailId
                })
                lastPathMatchLogTime.value = currentTime
              }
            }
          }
        } else if (selectedSchedule) {
          // ‚úÖ ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°ú ÏÇ¨Ïö©
          const scheduleMstId = selectedSchedule.mstId
          const scheduleDetailId = selectedSchedule.detailId

          // ‚úÖ Í≤ΩÎ°ú Îß§Ïπ≠: mstIdÏôÄ detailIdÎßå ÎπÑÍµê
          if (!pathInfo.passId ||
              (pathInfo.passId === scheduleMstId &&
               pathInfo.detailId === scheduleDetailId)) {
            predictedPathToShow = currentPath.map((point: readonly [number, number]) => [...point])

            // üÜï Î°úÍ∑∏ Ïä§Î°úÌãÄÎßÅ (10Ï¥àÎãπ 1Í∞ú)
            const currentTime = Date.now()
            if (currentTime - lastPathMatchLogTime.value >= PATH_MATCH_LOG_INTERVAL) {
              console.log('‚úÖ ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ Í≤ΩÎ°ú ÌëúÏãú:', {
                scheduleMstId,
                scheduleDetailId,
                pathInfoMstId: pathInfo.passId,
                pathInfoDetailId: pathInfo.detailId,
                pathLength: currentPath.length
              })
              lastPathMatchLogTime.value = currentTime
            }
          } else {
            // üÜï Î°úÍ∑∏ Ïä§Î°úÌãÄÎßÅ (10Ï¥àÎãπ 1Í∞ú)
            const currentTime = Date.now()
            if (currentTime - lastPathMatchLogTime.value >= PATH_MATCH_LOG_INTERVAL) {
              console.log('‚ö†Ô∏è Í≤ΩÎ°ú Îß§Ïπ≠ Ïã§Ìå® (ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ):', {
                scheduleMstId,
                scheduleDetailId,
                pathInfoMstId: pathInfo.passId,
                pathInfoDetailId: pathInfo.detailId
              })
              lastPathMatchLogTime.value = currentTime
            }
          }
        } else {
          // ‚úÖ Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏñ¥ÎèÑ Í≤ΩÎ°úÍ∞Ä ÏûàÏúºÎ©¥ ÌëúÏãú (pathInfoÍ∞Ä ÏóÜÏùÑ Îïå)
          if (!pathInfo.passId) {
            predictedPathToShow = currentPath.map((point: readonly [number, number]) => [...point])
            console.log('‚úÖ Í≤ΩÎ°ú Ï†ïÎ≥¥ ÏóÜÏùå - Í≤ΩÎ°ú ÌëúÏãú:', currentPath.length, 'Í∞ú Ìè¨Ïù∏Ìä∏')
          }
        }
      } else {
        console.log('‚ö†Ô∏è ÏòàÏÉÅ Í≤ΩÎ°ú Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå')
      }
    }

    const shouldShowTrackingPath = icdStore.passScheduleStatusInfo?.isActive === true &&
      actualPath && actualPath.length > 0

    // ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ Î∞è Ìï¥ÏÉÅÎèÑ Ï°∞Ï†ï
    const currentFrameTime = performance.now() - startTime
    const resolution = adjustDisplayResolution(actualPath?.length || 0, currentFrameTime)

    // Ï†ÅÏùëÌòï Í≤ΩÎ°ú ÏµúÏ†ÅÌôî
    const displayPath = shouldShowTrackingPath ?
      optimizePathAdaptive(actualPath as [number, number][], resolution) : []

    // üÜï Î≥ÄÍ≤Ω Í∞êÏßÄ: Í≤ΩÎ°ú Í∏∏Ïù¥, ÏúÑÏπò, Í≤ΩÎ°ú Ï†ïÎ≥¥Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÎäîÏßÄ ÌôïÏù∏
    const currentPathInfo = {
      mstId: pathInfo?.passId ?? null,
      detailId: pathInfo?.detailId ?? null
    }
    const hasPathInfoChanged = !lastPathInfo.value ||
      lastPathInfo.value.mstId !== currentPathInfo.mstId ||
      lastPathInfo.value.detailId !== currentPathInfo.detailId
    const hasPredictedPathLengthChanged = predictedPathToShow.length !== lastPredictedPathLength.value
    const hasDisplayPathChanged = displayPath.length !== lastTrackingPathLength.value

    // üÜï Ïã§Ï†ú Î≥ÄÍ≤ΩÏù¥ ÏûàÏùÑ ÎïåÎßå Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    // ‚úÖ ÌòÑÏû¨ ÏúÑÏπòÎäî Ìï≠ÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏ (hasPositionChanged)
    // Ï∂îÏ†Å Ï§ë: ÏúÑÏπò Î≥ÄÍ≤ΩÏù¥ÎÇò Ïã§Ï†ú Í≤ΩÎ°ú Î≥ÄÍ≤Ω Ïãú ÏóÖÎç∞Ïù¥Ìä∏
    // Ïù¥Î°†ÏπòÎßå ÌëúÏãú: ÏúÑÏπò Î≥ÄÍ≤ΩÏù¥ÎÇò Í≤ΩÎ°ú Ï†ïÎ≥¥ Î≥ÄÍ≤Ω Ïãú ÏóÖÎç∞Ïù¥Ìä∏
    const shouldUpdateChart = hasPositionChanged || // ‚úÖ ÌòÑÏû¨ ÏúÑÏπò Î≥ÄÍ≤Ω Ïãú Ìï≠ÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
      (shouldShowTrackingPath
        ? hasDisplayPathChanged // Ï∂îÏ†Å Ï§ë: Ïã§Ï†ú Í≤ΩÎ°ú Î≥ÄÍ≤Ω Ïãú
        : (hasPathInfoChanged || hasPredictedPathLengthChanged)) // Ïù¥Î°†ÏπòÎßå: Í≤ΩÎ°ú Ï†ïÎ≥¥ Î≥ÄÍ≤Ω Ïãú

    // ‚úÖ PassChartUpdatePoolÏùÑ ÏÇ¨Ïö©Ìïú Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Ï°¥ Î∞©ÏãùÏúºÎ°ú Î≥µÏõê)
    try {
      if (shouldUpdateChart) {
        passChartPool.updatePosition(normalizedEl, normalizedAz)
        passChartPool.updateTrackingPath(displayPath)
        // ‚úÖ ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ ÎòêÎäî ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏùò Í≤ΩÎ°úÎßå ÌëúÏãú
        passChartPool.updatePredictedPath(predictedPathToShow)

        // ‚úÖ Ï†ÑÏ≤¥ ÏóÖÎç∞Ïù¥Ìä∏ (appendData ÎåÄÏã† setOption ÏÇ¨Ïö©)
        const finalOption = passChartPool.getUpdateOption()

        if (passChart && !passChart.isDisposed()) {
          passChart.setOption(finalOption, false, true)

          // ‚úÖ Í≤ΩÎ°ú Í∏∏Ïù¥ Ï∂îÏ†Å ÏóÖÎç∞Ïù¥Ìä∏
          if (shouldShowTrackingPath) {
            lastTrackingPathLength.value = displayPath.length
          } else {
            lastTrackingPathLength.value = 0
          }
          lastPredictedPathLength.value = predictedPathToShow.length

          // üÜï Ïù¥Ï†Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
          lastPosition.value = currentPos
          lastPathInfo.value = currentPathInfo

          lastUpdateTime.value = now
        }
          // ÏÑ±Îä• ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
          performanceMonitor.frameCount++
          performanceMonitor.averageFrameTime =
            (performanceMonitor.averageFrameTime * (performanceMonitor.frameCount - 1) + currentFrameTime) /
            performanceMonitor.frameCount

          // ÏÑ±Îä• Î°úÍ∑∏ (10ÌîÑÎ†àÏûÑÎßàÎã§)
          if (performanceMonitor.frameCount % 10 === 0) {
            console.log(`üìä ÏÑ±Îä• ÌÜµÍ≥Ñ: ÌèâÍ∑† ${performanceMonitor.averageFrameTime.toFixed(2)}ms, Ìï¥ÏÉÅÎèÑ: 1/${resolution}, Ìè¨Ïù∏Ìä∏: ${displayPath.length}/${actualPath?.length || 0}`)
          }
        } else {
          // üÜï Î≥ÄÍ≤ΩÏù¥ ÏóÜÏúºÎ©¥ Ïä§ÌÇµ (Î¶¨ÏÜåÏä§ Ï†àÏïΩ)
          return
        }
    } catch (chartError) {
      console.error('Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•ò:', chartError)
      // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®Ìï¥ÎèÑ Ïª¥Ìè¨ÎÑåÌä∏Îäî Í≥ÑÏÜç ÎèôÏûëÌïòÎèÑÎ°ù Ìï®
    }
  } catch (error) {
    console.error('PassSchedule Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error)
    // ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï¥ÎèÑ Ïª¥Ìè¨ÎÑåÌä∏Îäî Í≥ÑÏÜç ÎèôÏûëÌïòÎèÑÎ°ù Ìï®
  }
}

// üÜï Í∏∞Ï°¥ updateChart Ìï®ÏàòÎ•º ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ Î≤ÑÏ†ÑÏúºÎ°ú ÍµêÏ≤¥
const updateChart = updateChartWithPerformanceMonitoring

const selectScheduleData = async () => {
  try {
    console.log('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨ Ïó¥Í∏∞')

    // ‚úÖ 1ÏàúÏúÑ: localStorageÏóêÏÑú Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Îπ†Î¶Ñ)
    const cached = passScheduleStore.loadScheduleDataFromLocalStorage()

    if (cached && passScheduleStore.scheduleData.length > 0) {
      console.log('‚úÖ Ï∫êÏãúÎêú Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (API Ìò∏Ï∂ú ÏÉùÎûµ):', passScheduleStore.scheduleData.length, 'Í∞ú')
    } else {
      // ‚úÖ 2ÏàúÏúÑ: API Ìò∏Ï∂ú (Ï∫êÏãúÍ∞Ä ÏóÜÏùÑ ÎïåÎßå)
      console.log('üì° Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ API Ìò∏Ï∂ú ÏãúÏûë (Ï∫êÏãú ÏóÜÏùå)')
      try {
        await passScheduleStore.fetchScheduleDataFromServer()
        console.log('‚úÖ Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å:', passScheduleStore.scheduleData.length, 'Í∞ú')
      } catch (error) {
        console.error('‚ùå Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error)
        $q.notify({
          type: 'negative',
          message: 'Ïä§ÏºÄÏ§Ñ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§',
        })
        return
      }
    }

    const modal = await openModal('select-schedule', {
      width: 1200,
      height: 700,
      modalClass: 'select-schedule-modal',
      onClose: (selectedData?: ScheduleItem) => {
        console.log('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨ Îã´Ìûò', selectedData)
        // üîß SelectScheduleContentÏóêÏÑú Ïù¥ÎØ∏ Ï≤òÎ¶¨ÌñàÏúºÎØÄÎ°ú Ï∂îÍ∞Ä ÏûëÏóÖ ÏóÜÏùå
        if (selectedData) {
          console.log('‚úÖ Ïä§ÏºÄÏ§ÑÏù¥ Ïù¥ÎØ∏ SelectScheduleContentÏóêÏÑú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§:', selectedData.satelliteName)
        }
      },
      onError: (error) => {
        console.error('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨ Ïò§Î•ò:', error)
        $q.notify({
          type: 'negative',
          message: 'Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Ï∞ΩÏùÑ Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§',
        })
      },
    })

    if (modal) {
      console.log('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨ Ïó¥Í∏∞ ÏÑ±Í≥µ')
    }
  } catch (error) {
    console.error('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Î™®Îã¨ Ïó¥Í∏∞ Ïã§Ìå®:', error)
    $q.notify({
      type: 'negative',
      message: 'Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù Ï∞ΩÏùÑ Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§',
    })
  }
}

// ÌÖåÏù¥Î∏î Ìñâ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
const onRowClick = (evt: Event, row: ScheduleItem) => {
  selectedSchedule.value = row
  passScheduleStore.selectSchedule(row) // StoreÏóêÎèÑ ÏÑ†ÌÉù ÏÉÅÌÉú Ï†ÄÏû•
  void updateScheduleChart() // ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ•º Î™ÖÏãúÏ†ÅÏúºÎ°ú Î¨¥Ïãú

  console.log('Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉùÎê®:', {
    mstId: row.mstId,
    no: row.no,
    satelliteName: row.satelliteName,
    startTime: row.startTime,
  })
}

// üÜï ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏóê Îî∞Î•∏ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå - loadSelectedScheduleTrackingPathÎ°ú ÎåÄÏ≤¥)
const updateScheduleChart = async () => {
  if (!passChart || !selectedSchedule.value) return

  try {
    // StoreÏùò Ï∂îÏ†Å Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî
    passScheduleStore.clearTrackingPaths()

    // ‚úÖ mstIdÏôÄ detailId ÏÇ¨Ïö© (satelliteId Î∂àÌïÑÏöî)
    const mstId = selectedSchedule.value.mstId
    const detailId = selectedSchedule.value.detailId

    console.log('üîç updateScheduleChart - mstId/detailId ÌôïÏù∏:', {
      mstId: selectedSchedule.value.mstId,
      detailId: selectedSchedule.value.detailId,
      no: selectedSchedule.value.no,
      satelliteName: selectedSchedule.value.satelliteName,
      schedule: selectedSchedule.value // ‚úÖ Ï†ÑÏ≤¥ Ïä§ÏºÄÏ§Ñ Í∞ùÏ≤¥ ÌôïÏù∏
    })

    if (!mstId || detailId == null) {
      console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
        mstId: selectedSchedule.value.mstId,
        detailId: selectedSchedule.value.detailId,
        no: selectedSchedule.value.no,
        satelliteName: selectedSchedule.value.satelliteName
      })
      return
    }

    if (mstId && detailId != null) {
      // ‚úÖ Ïä§ÏºÄÏ§ÑÏùò keyhole Ïó¨Î∂ÄÏóê Îî∞Îùº DataType Í≤∞Ï†ï
      const isKeyhole = selectedSchedule.value.isKeyhole || selectedSchedule.value.IsKeyhole || false
      const dataType = isKeyhole ? 'keyhole_optimized_final_transformed' : 'final_transformed'

      console.log(`üõ∞Ô∏è Ïä§ÏºÄÏ§Ñ ÏÑ†ÌÉù - Ï∂îÏ†Å Í≤ΩÎ°ú Ï°∞Ìöå: mstId=${mstId}, detailId=${detailId}, DataType: ${dataType}`)

      // ‚úÖ DataTypeÏùÑ StoreÏóê Ï†ÑÎã¨
      const success = await passScheduleStore.loadTrackingDetailData(mstId, detailId, dataType)

      if (success) {
        console.log('‚úÖ Ï∂îÏ†Å Í≤ΩÎ°ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ')
        updateChart()
      } else {
        console.warn('‚ùå Ï∂îÏ†Å Í≤ΩÎ°ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå® - Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥ Í≤ΩÎ°úÎ•º ÌëúÏãúÌïòÏßÄ ÏïäÏäµÎãàÎã§')
        // ‚úÖ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÎçîÎØ∏ Í≤ΩÎ°úÎ•º ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏùå (Í≤ΩÎ°ú ÌëúÏãú Ïïà Ìï®)
        passScheduleStore.clearTrackingPaths()
        updateChart()
      }
    } else {
      console.warn('‚ùå Ïä§ÏºÄÏ§ÑÏóêÏÑú ÌïÑÏöîÌïú Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå:', selectedSchedule.value)
    }

  } catch (error) {
    console.error('Ïä§ÏºÄÏ§Ñ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error)
  }
}

// üÜï ÏòàÏÉÅ Í≤ΩÎ°ú ÏÑ§Ï†ï Ìï®Ïàò (Store ÌÜµÌï¥ÏÑú)
// ‚úÖ ÎçîÎØ∏ Í≤ΩÎ°ú ÏÑ§Ï†ï Ìï®Ïàò Ï†úÍ±∞ - Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í≤ΩÎ°úÎ•º ÌëúÏãúÌïòÏßÄ ÏïäÏùå
/*
// üÜï Ïã§Ï†ú Ï∂îÏ†Å Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî (Store ÌÜµÌï¥ÏÑú)
const clearActualPath = () => {
  passScheduleStore.clearTrackingPaths()
  updateChart()
}
 */
// ÏûÖÎ†•Í∞í Î≥ÄÍ≤Ω Ìï∏Îì§Îü¨
const onInputChange = (index: number, value: string) => {
  inputs.value[index] = value
  updateOutputs()
}

// Ï¶ùÍ∞Ä Ìï®Ïàò
const increment = async (index: number) => {
  const currentOutput = parseFloat(outputs.value[index] || '0')
  const inputValue = parseFloat(inputs.value[index] || '0')
  const newValue = (currentOutput + inputValue).toFixed(index === 3 ? 0 : 2)

  outputs.value[index] = newValue
  await updateOffset(index, newValue)
}

// Í∞êÏÜå Ìï®Ïàò
const decrement = async (index: number) => {
  const currentOutput = parseFloat(outputs.value[index] || '0')
  const inputValue = parseFloat(inputs.value[index] || '0')
  const newValue = (currentOutput - inputValue).toFixed(index === 3 ? 0 : 2)

  outputs.value[index] = newValue
  await updateOffset(index, newValue)
}

// Î¶¨ÏÖã Ìï®Ïàò
const reset = async (index: number) => {
  inputs.value[index] = index === 3 ? '0' : '0.00'
  outputs.value[index] = index === 3 ? '0' : '0.00'
  await updateOffset(index, outputs.value[index])
}

// Ï∂úÎ†•Í∞í ÏóÖÎç∞Ïù¥Ìä∏
const updateOutputs = () => {
  outputs.value = [...inputs.value]
}

// ‚úÖ updateOffset Ìï®Ïàò ÏàòÏ†ï - Time Ï≤òÎ¶¨ Î∂ÑÎ¶¨
const updateOffset = async (index: number, value: string) => {
  try {
    // ‚úÖ ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂îÍ∞Ä
    console.log('updateOffset Ìò∏Ï∂úÎê®:', {
      index,
      value,
      valueType: typeof value,
      inputs3: inputs.value[3],
      currentTimeResult: passScheduleStore.offsetValues.timeResult,
    })

    const numValue = Number(parseFloat(value).toFixed(2)) || 0
    console.log('Í≥ÑÏÇ∞Îêú numValue:', numValue)

    const offsetTypes = ['azimuth', 'elevation', 'train', 'time'] as const
    const offsetType = offsetTypes[index]

    if (!offsetType) {
      console.error('Invalid offset index:', index)
      return
    }

    if (index === 3) {
      const timeInputValue = inputs.value[3] || '0.00'
      passScheduleStore.updateOffsetValues('time', timeInputValue)
      try {
        await passScheduleStore.sendTimeOffset(numValue)
        passScheduleStore.updateOffsetValues('timeResult', numValue.toFixed(2))
        console.log('Time Result ÏóÖÎç∞Ïù¥Ìä∏:', numValue.toFixed(2))
      } catch (error) {
        console.error('Time offset command failed:', error)
      }
      return
    }

    // Position Offset Ï≤òÎ¶¨ (azimuth, elevation, train)
    passScheduleStore.updateOffsetValues(offsetType, numValue.toFixed(2))

    const azOffset = Number((parseFloat(passScheduleStore.offsetValues.azimuth) || 0).toFixed(2))
    const elOffset = Number((parseFloat(passScheduleStore.offsetValues.elevation) || 0).toFixed(2))
    const tiOffset = Number((parseFloat(passScheduleStore.offsetValues.train) || 0).toFixed(2))

    await icdStore.sendPositionOffsetCommand(azOffset, elOffset, tiOffset)
  } catch (error) {
    console.error('Error updating offset:', error)
  }
}

// Î™ÖÎ†π Ìï∏Îì§Îü¨Îì§ - handleStartCommand ÏàòÏ†ï
const handleStartCommand = async () => {
  // üîß ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§ÑÏù¥ ÏïÑÎãå Îì±Î°ùÎêú Î™®Îì† Ïä§ÏºÄÏ§ÑÏùÑ Ï≤òÎ¶¨
  if (scheduleData.value.length === 0) {
    $q.notify({
      type: 'warning',
      message: 'Îì±Î°ùÎêú Ïä§ÏºÄÏ§ÑÏù¥ ÏóÜÏäµÎãàÎã§',
    })
    return
  }

  try {
    console.log('üöÄ ACS Start Î™ÖÎ†π ÏãúÏûë - Îì±Î°ùÎêú Î™®Îì† Ïä§ÏºÄÏ§Ñ:', scheduleData.value.length, 'Í∞ú')
    console.log('üîç Start Ï†Ñ Store ÏÉÅÌÉú:', {
      current: icdStore.currentTrackingMstId,
      next: icdStore.nextTrackingMstId
    })

    // üîß Îì±Î°ùÎêú Î™®Îì† Ïä§ÏºÄÏ§ÑÏùÑ Ï∂îÏ†Å ÎåÄÏÉÅÏúºÎ°ú ÏÑ§Ï†ï
    const success = await passScheduleStore.setTrackingTargets(scheduleData.value)

    if (success) {
      console.log('‚úÖ Ï∂îÏ†Å ÎåÄÏÉÅ ÏÑ§Ï†ï ÏÑ±Í≥µ')

      // üÜï Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûë API Ìò∏Ï∂ú Ï∂îÍ∞Ä
      try {
        console.log('üöÄ Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûë API Ìò∏Ï∂ú')
        const trackingStartResult = await passScheduleStore.startScheduleTracking()

        if (trackingStartResult.success) {
          console.log('‚úÖ Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûë ÏÑ±Í≥µ:', trackingStartResult)
        } else {
          console.warn('‚ö†Ô∏è Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûë Ïã§Ìå®:', trackingStartResult.message)
          $q.notify({
            type: 'warning',
            message: 'Ï∂îÏ†Å ÎåÄÏÉÅÏùÄ ÏÑ§Ï†ïÎêòÏóàÏúºÎÇò Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
            caption: trackingStartResult.message
          })
        }
      } catch (error) {
        console.error('‚ùå Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûë API Ìò∏Ï∂ú Ïã§Ìå®:', error)
        $q.notify({
          type: 'warning',
          message: 'Ï∂îÏ†Å ÎåÄÏÉÅÏùÄ ÏÑ§Ï†ïÎêòÏóàÏúºÎÇò Î∞±ÏóîÎìú Ï∂îÏ†Å ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
          caption: 'API Ïó∞Í≤∞ Ïò§Î•ò'
        })
      }

      // üÜï ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú (Ï≤´ Î≤àÏß∏ Ïä§ÏºÄÏ§Ñ Í∏∞Ï§Ä)
      if (scheduleData.value.length > 0) {
        const firstSchedule = scheduleData.value[0]
        if (firstSchedule) {
          // ‚úÖ mstIdÏôÄ detailId ÏÇ¨Ïö© (satelliteId Î∂àÌïÑÏöî)
          const mstId = firstSchedule.mstId
          const detailId = firstSchedule.detailId

          if (!mstId || detailId == null) {
            console.warn('‚ö†Ô∏è MstId ÎòêÎäî DetailIdÍ∞Ä ÏóÜÏùå:', {
              mstId: firstSchedule.mstId,
              detailId: firstSchedule.detailId,
              no: firstSchedule.no,
              satelliteName: firstSchedule.satelliteName
            })
            return
          }

          if (mstId && detailId != null) {
            console.log('üõ∞Ô∏è ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú ÏãúÏûë: mstId=', mstId, 'detailId=', detailId)
            try {
              const pathLoaded = await passScheduleStore.loadTrackingDetailData(mstId, detailId)
              if (pathLoaded) {
                console.log('‚úÖ ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú ÏÑ±Í≥µ')
              } else {
                console.warn('‚ö†Ô∏è ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú Ïã§Ìå®')
              }
            } catch (error) {
              console.error('‚ùå ÏòàÏ∏° Í≤ΩÎ°ú Î°úÎìú Ï§ë Ïò§Î•ò:', error)
            }
          }
        }
      }

      // Store Í∞í Î≥ÄÍ≤Ω ÌôïÏù∏ÏùÑ ÏúÑÌïú ÏßÄÏó∞Îêú Ï≤¥ÌÅ¨
      setTimeout(() => {
        console.log('üîç Start ÌõÑ Store ÏÉÅÌÉú:', {
          current: icdStore.currentTrackingMstId,
          next: icdStore.nextTrackingMstId
        })
        // Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏ Ï†úÍ±∞ - watchÏóêÏÑú ÏûêÎèôÏúºÎ°ú Ï≤òÎ¶¨Îê®
        // forceTableUpdate()
      }, 1000)

      // üÜï Ï∂îÏ†Å ÎåÄÏÉÅ ÏÑ§Ï†ï ÏÑ±Í≥µ ÌõÑ Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë
      const monitoringStarted = await passScheduleStore.startTrackingMonitor()
      if (monitoringStarted) {
        $q.notify({
          type: 'positive',
          message: `${scheduleData.value.length}Í∞úÏùò Ïä§ÏºÄÏ§Ñ Ï∂îÏ†ÅÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§`,
          caption: 'Î™®ÎãàÌÑ∞ÎßÅÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§ (100ms Ï£ºÍ∏∞)'
        })

        console.log('‚úÖ ACS Start Î™ÖÎ†π ÏôÑÎ£å - Ï∂îÏ†Å ÎåÄÏÉÅ ÏÑ§Ï†ï Î∞è Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûëÎê®')

        // üÜï ÌÖåÏù¥Î∏î ÌïòÏù¥ÎùºÏù¥Ìä∏ ÎîîÎ≤ÑÍπÖ
        setTimeout(() => {
          console.log('üîç Start ÌõÑ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÏÉÅÌÉú ÌôïÏù∏:')
          console.log('  - currentTrackingMstId:', icdStore.currentTrackingMstId)
          console.log('  - nextTrackingMstId:', icdStore.nextTrackingMstId)
          console.log('  - scheduleData:', scheduleData.value.length, 'Í∞ú')

          // WebSocket Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
          console.log('üì° WebSocket Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏:')
          console.log('  - icdStore.currentTrackingMstId:', icdStore.currentTrackingMstId)
          console.log('  - icdStore.nextTrackingMstId:', icdStore.nextTrackingMstId)

          // Í∞ïÏ†ú Î∞òÏùëÏÑ± Ìä∏Î¶¨Í±∞
          reactivityTrigger.value++

          // DOM ÏßÅÏ†ë Ï°∞ÏûëÏúºÎ°ú ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©
          applyRowColors()
        }, 2000)

        // 5Ï¥à ÌõÑ ÏµúÏ¢Ö ÏÉÅÌÉú ÌôïÏù∏
        setTimeout(() => {
          console.log('‚è∞ 5Ï¥à ÌõÑ ÏµúÏ¢Ö ÏÉÅÌÉú ÌôïÏù∏:')
          console.log('  - icdStore.currentTrackingMstId:', icdStore.currentTrackingMstId)
          console.log('  - icdStore.nextTrackingMstId:', icdStore.nextTrackingMstId)
          console.log('  - scheduleData:', scheduleData.value.length, 'Í∞ú')
        }, 5000)
      } else {
        $q.notify({
          type: 'warning',
          message: 'Ï∂îÏ†Å ÎåÄÏÉÅÏùÄ ÏÑ§Ï†ïÎêòÏóàÏúºÎÇò Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
          caption: 'ÏàòÎèôÏúºÎ°ú Î™®ÎãàÌÑ∞ÎßÅÏùÑ ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî'
        })
      }
    } else {
      $q.notify({
        type: 'negative',
        message: 'Ï∂îÏ†Å ÎåÄÏÉÅ ÏÑ§Ï†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
      })
    }
  } catch (error) {
    console.error('‚ùå ACS Start Î™ÖÎ†π Ïã§Ìå®:', error)
    $q.notify({
      type: 'negative',
      message: 'Ïä§ÏºÄÏ§Ñ ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
    })
  }
}

const handleStopCommand = async () => {
  try {
    // üÜï Î∞±ÏóîÎìú Ï∂îÏ†Å Ï§ëÏßÄ API Ìò∏Ï∂ú Ï∂îÍ∞Ä
    try {
      console.log('üõë Î∞±ÏóîÎìú Ï∂îÏ†Å Ï§ëÏßÄ API Ìò∏Ï∂ú')
      const trackingStopResult = await passScheduleStore.stopScheduleTracking()

      if (trackingStopResult.success) {
        console.log('‚úÖ Î∞±ÏóîÎìú Ï∂îÏ†Å Ï§ëÏßÄ ÏÑ±Í≥µ:', trackingStopResult)
      } else {
        console.warn('‚ö†Ô∏è Î∞±ÏóîÎìú Ï∂îÏ†Å Ï§ëÏßÄ Ïã§Ìå®:', trackingStopResult.message)
      }
    } catch (error) {
      console.error('‚ùå Î∞±ÏóîÎìú Ï∂îÏ†Å Ï§ëÏßÄ API Ìò∏Ï∂ú Ïã§Ìå®:', error)
    }

    // üÜï Ï∂îÏ†Å Î™®ÎãàÌÑ∞ÎßÅ Î®ºÏ†Ä Ï§ëÏßÄ
    const monitoringStopped = await passScheduleStore.stopTrackingMonitor()

    // Í∏∞Ï°¥ ICD Ï†ïÏßÄ Î™ÖÎ†π
    await icdStore.stopCommand(true, true, true)

    if (monitoringStopped) {
      $q.notify({
        type: 'positive',
        message: 'Ï∂îÏ†Å Î™®ÎãàÌÑ∞ÎßÅ Î∞è ÏãúÏä§ÌÖúÏù¥ Ï†ïÏßÄÎêòÏóàÏäµÎãàÎã§',
      })
    } else {
      $q.notify({
        type: 'warning',
        message: 'ÏãúÏä§ÌÖú Ï†ïÏßÄ Î™ÖÎ†πÏùÄ Ï†ÑÏÜ°ÎêòÏóàÏúºÎÇò Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
      })
    }
  } catch (error) {
    console.error('Failed to send stop command:', error)
    $q.notify({
      type: 'negative',
      message: 'Ï†ïÏßÄ Î™ÖÎ†π Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
    })
  }
}
const handleStowCommand = async () => {
  try {
    // üÜï Ï∂îÏ†Å Ï§ëÏßÄ
    await passScheduleStore.stopTrackingMonitor()
    await icdStore.stowCommand()

    $q.notify({
      type: 'positive',
      message: 'Stow Î™ÖÎ†πÏù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§',
    })
  } catch (error) {
    console.error('Failed to send stow command:', error)
    $q.notify({
      type: 'negative',
      message: 'Stow Î™ÖÎ†π Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
    })
  }
}
/*
const handleReset = async () => {
  try {


    // Í∏∞Ï°¥ Î¶¨ÏÖã Î°úÏßÅ
    selectedSchedule.value = null
    inputs.value = ['0.00', '0.00', '0.00', '0']
    outputs.value = ['0.00', '0.00', '0.00', '0']

    // üîß ÏÑ†ÌÉùÎêú Ïä§ÏºÄÏ§Ñ Î™©Î°ùÎèÑ Ï¥àÍ∏∞Ìôî
    passScheduleStore.clearSelectedSchedules()

    // üÜï Ï∂îÏ†Å Í≤ΩÎ°ú Ï¥àÍ∏∞Ìôî (Store ÌÜµÌï¥ÏÑú)
    clearActualPath()

    // Î™®Îì† Ïò§ÌîÑÏÖã Î¶¨ÏÖã
    await icdStore.sendPositionOffsetCommand(0, 0, 0)

    $q.notify({
      type: 'info',
      message: 'PassScheduleÏù¥ Î¶¨ÏÖãÎêòÏóàÏäµÎãàÎã§',
      caption: 'Î™®ÎãàÌÑ∞ÎßÅÏù¥ Ï§ëÏßÄÎêòÍ≥† Î™®Îì† ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§'
    })
  } catch (error) {
    console.error('Failed to reset:', error)
    $q.notify({
      type: 'negative',
      message: 'Î¶¨ÏÖãÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§',
    })
  }
} */
// Ï¥àÍ∏∞Ìôî Ìï®Ïàò (ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå - onMountedÏóêÏÑú ÏßÅÏ†ë Ï≤òÎ¶¨)
// const init = async () => {
//   console.log('PassSchedulePage Ï¥àÍ∏∞Ìôî ÏãúÏûë')
//   // ... Í∏∞Ï°¥ ÏΩîÎìú
// }
// Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏
onMounted(() => {
  try {
    console.log('PassSchedulePage Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏Îê®')

    // ‚úÖ localStorageÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
    const restored = passScheduleStore.loadFromLocalStorage()
    if (restored) {
      console.log('‚úÖ localStorage Îç∞Ïù¥ÌÑ∞ Î≥µÏõê ÏôÑÎ£å')
    }

    // ‚úÖ Ï∞®Ìä∏Îäî Ï¶âÏãú Ï¥àÍ∏∞Ìôî (ÏÑúÎ≤Ñ Ïó∞Í≤∞Í≥º Î¨¥Í¥Ä)
    void nextTick(() => {
      try {
        initChart()
        console.log('‚úÖ Ï∞®Ìä∏ Ï¶âÏãú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å')

        // ‚úÖ Î≥µÏõêÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Ï∞®Ìä∏Ïóê Î∞òÏòÅ
        if (restored) {
          restoreChartData()
        }

        // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ ÏãúÏûë
        if (updateTimer) {
          clearInterval(updateTimer)
        }
        updateTimer = window.setInterval(() => {
          try {
            updateChart()
          } catch (timerError) {
            console.error('Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ïò§Î•ò:', timerError)
          }
        }, 100)
      } catch (chartError) {
        console.error('Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', chartError)
      }
    })

    // ‚úÖ ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎäî "Select Schedule" Î≤ÑÌäº ÌÅ¥Î¶≠ ÏãúÏóêÎßå ÏàòÌñâ
    // selectScheduleData()ÏóêÏÑú Î™®Îã¨ÏùÑ Ïó¥ Îïå Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î°úÎìúÌïòÎèÑÎ°ù Ï≤òÎ¶¨
    // ÌéòÏù¥ÏßÄ Ï†ëÍ∑º Ïãú Î∂àÌïÑÏöîÌïú API Ìò∏Ï∂ú Î∞©ÏßÄ
  } catch (error) {
    console.error('PassSchedulePage ÎßàÏö¥Ìä∏ Ï§ë Ïò§Î•ò:', error)
  }
})

// Ïª¥Ìè¨ÎÑåÌä∏ Ïñ∏ÎßàÏö¥Ìä∏
onUnmounted(() => {
  console.log('PassSchedulePage Ïª¥Ìè¨ÎÑåÌä∏ Ïñ∏ÎßàÏö¥Ìä∏Îê®')

  // üÜï Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨ (Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏Í∞Ä ÏûàÏùÑ ÎïåÎßå)
  if (updateTimer) {
    clearInterval(updateTimer)
    updateTimer = null
    console.log('‚úÖ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨Îê®')
  }

  // ‚úÖ Ï∞®Ìä∏Îäî Ïú†ÏßÄ (disposeÌïòÏßÄ ÏïäÏùå) - keep-aliveÎÇò Ïû¨ÎßàÏö¥Ìä∏ Ïãú Ïû¨ÏÇ¨Ïö©
  // Ï∞®Ìä∏Îäî onDeactivatedÏóêÏÑúÎèÑ Ïú†ÏßÄÎêòÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎèÑ Ïú†ÏßÄ
  // Ïã§Ï†úÎ°ú Ïª¥Ìè¨ÎÑåÌä∏Í∞Ä ÏôÑÏ†ÑÌûà Ï†úÍ±∞Îê† ÎïåÎßå dispose (ÏùºÎ∞òÏ†ÅÏúºÎ°ú Î∞úÏÉùÌïòÏßÄ ÏïäÏùå)
  // if (passChart && !passChart.isDisposed()) {
  //   passChart.dispose()
  //   passChart = null
  //   console.log('‚úÖ PassSchedule Ï∞®Ìä∏ Ïù∏Ïä§ÌÑ¥Ïä§ Ï†ïÎ¶¨Îê®')
  // }

  // üÜï ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
  stopTimeTimer()

  // üÜï Ï∂îÏ†Å Í≤ΩÎ°ú Îç∞Ïù¥ÌÑ∞Îäî Ïú†ÏßÄ (StoreÏóêÏÑú Í¥ÄÎ¶¨)
  // passScheduleStore.clearTrackingPaths() Ï†úÍ±∞

  // üÜï Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†ïÎ¶¨
  if (chartResizeHandler) {
    window.removeEventListener('resize', chartResizeHandler)
    chartResizeHandler = null
  }

  // ‚úÖ Ï†ÄÏû• ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
  if (saveTimeout) {
    clearTimeout(saveTimeout)
    saveTimeout = null
  }

  // ‚úÖ ÎßàÏßÄÎßâ Ï†ÄÏû• Ïã§Ìñâ
  passScheduleStore.saveToLocalStorage()

  console.log('‚úÖ PassSchedulePage Ï†ïÎ¶¨ ÏôÑÎ£å (Ï∞®Ìä∏Îäî Ïú†ÏßÄ)')
})

// ÏÑúÎ≤Ñ ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖÏùÑ ÏúÑÌïú Í≥ÑÏÇ∞Îêú ÏÜçÏÑ± Ï∂îÍ∞Ä
const formattedCalTime = computed(() => {
  const calTime = icdStore.resultTimeOffsetCalTime
  if (!calTime) return ''
  try {
    // ÏÑúÎ≤Ñ ÏãúÍ∞Ñ ÌååÏã±
    const dateObj = new Date(calTime)

    // Ïú†Ìö®Ìïú ÎÇ†ÏßúÏù∏ÏßÄ ÌôïÏù∏
    if (isNaN(dateObj.getTime())) {
      return calTime // Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ ÎÇ†ÏßúÎ©¥ ÏõêÎ≥∏ Î∞òÌôò
    }

    // UTC Í∏∞Ï§ÄÏúºÎ°ú ÏãúÍ∞Ñ ÌòïÏãù ÏßÄÏ†ï
    const utcYear = dateObj.getFullYear()
    const utcMonth = String(dateObj.getMonth() + 1).padStart(2, '0')
    const utcDay = String(dateObj.getDate()).padStart(2, '0')
    const utcHours = String(dateObj.getHours()).padStart(2, '0')
    const utcMinutes = String(dateObj.getMinutes()).padStart(2, '0')
    const utcSeconds = String(dateObj.getSeconds()).padStart(2, '0')
    const utcMilliseconds = String(dateObj.getMilliseconds()).padStart(3, '0')

    // YYYY-MM-DD HH:MM:SS.mmm (UTC) ÌòïÏãù
    return `${utcYear}-${utcMonth}-${utcDay} ${utcHours}:${utcMinutes}:${utcSeconds}.${utcMilliseconds} `
  } catch (e) {
    console.error('Error formatting cal time:', e)
    return calTime
  }
})
</script>

<style scoped>
/* Î™®Îì† Í∞ÑÍ≤©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï°∞Ï†ïÎêòÎäî Î∞òÏùëÌòï Î†àÏù¥ÏïÑÏõÉ */
.flexible-offset-layout {
  display: flex;
  align-items: stretch;
  justify-content: center;
  width: 100%;
  gap: 40px;
  row-gap: 8px;
  flex-wrap: wrap;
}

/* Í∞úÎ≥Ñ Offset Í∑∏Î£π - Elevation, Tilt, TimeÏùÄ Ï¢åÏ∏° Í≥µÍ∞Ñ Ï∂ïÏÜå */
.offset-group {
  flex: none;
  min-width: 0;
  padding: 4px 8px;
  border-radius: 4px;
  background-color: rgba(255, 255, 255, 0.01);
  display: flex;
  align-items: center;
}

/* ‚úÖ Í∞ÑÍ≤© ÌÜµÏùº - padding-left Ï†úÍ±∞ÌïòÍ≥† gapÎßåÏúºÎ°ú Í∞ÑÍ≤© Í¥ÄÎ¶¨ */

/* ÎùºÎ≤® Ïä§ÌÉÄÏùº */
.position-offset-label {
  min-width: 80px;
  padding: 4px 8px;
  border-radius: 4px;
  background-color: rgba(25, 118, 210, 0.1);
  border: 1px solid rgba(25, 118, 210, 0.3);
}

/* Cal Time ÌïÑÎìú Ïä§ÌÉÄÏùº - ÌôïÎ≥¥Îêú Í≥µÍ∞Ñ ÌôúÏö© */
.cal-time-field {
  flex-shrink: 0;
  min-width: 190px;
}

/* Î∞òÏùëÌòï ÎèôÏûë - 1900px Í∏∞Ï§ÄÏúºÎ°ú Ï§ÑÎ∞îÍøà */
@media (max-width: 1900px) {
  .flexible-offset-layout {
    flex-wrap: wrap;
    gap: 20px;
    row-gap: 8px;
    justify-content: center;
  }

  .offset-group {
    flex: none;
    min-width: 0;
    padding: 8px;
  }

  .position-offset-label {
    min-width: 70px;
    font-size: 0.8rem;
  }

  .cal-time-field {
    min-width: 180px;
    max-width: 200px;
  }
}

@media (min-width: 1901px) {
  .flexible-offset-layout {
    flex-wrap: nowrap;
    gap: 40px;
    justify-content: center;
  }

  .offset-group {
    flex: none;
    min-width: 0;
  }

  .position-offset-label {
    min-width: 80px;
    font-size: 0.875rem;
  }
}

/* ‚úÖ Ïò§ÌîÑÏÖã Ïª®Ìä∏Î°§ Ìñâ ÌïòÎã® Ïó¨Î∞± Ï§ÑÏù¥Í∏∞ */
.pass-schedule-mode .offset-control-row {
  margin-bottom: 0.5rem !important;
  /* ‚úÖ Í∏∞Î≥∏ q-mb-sm (0.5rem) Ïú†ÏßÄÌïòÎêò Î™ÖÏãúÏ†ÅÏúºÎ°ú ÏÑ§Ï†ï */
}

/* ‚úÖ Î©îÏù∏ ÏΩòÌÖêÏ∏† Ìñâ ÌïòÎã® Ïó¨Î∞±ÏùÑ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå) */
.pass-schedule-mode .main-content-row {
  margin-bottom: 0 !important;
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå */
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© Ï†úÍ±∞ */
}

/* ‚úÖ Quasar q-col-gutter-mdÍ∞Ä ÌñâÏóê Ï∂îÍ∞ÄÌïòÎäî ÌïòÎã® ÎßàÏßÑÏùÑ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå) */
.pass-schedule-mode .main-content-row.q-col-gutter-md,
.pass-schedule-mode .row.q-col-gutter-md.main-content-row {
  margin-bottom: 0 !important;
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå */
  padding-bottom: 0 !important;
}

/* ‚úÖ Quasar row Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ïò§Î≤ÑÎùºÏù¥Îìú (Îçî Í∞ïÎ†•Ìïú ÏÑ†ÌÉùÏûê) - EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå) */
.pass-schedule-mode .main-content-row.row,
.pass-schedule-mode .row.main-content-row {
  margin-bottom: 0 !important;
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå */
  padding-bottom: 0 !important;
}

/* ‚úÖ 1Îã®Í≥Ñ: pass-schedule-modeÏôÄ Î∂ÄÎ™® ÏöîÏÜåÏùò ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ */
/* router-view, q-page-container ÎÇ¥Î∂ÄÏùò pass-schedule-mode ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
router-view .pass-schedule-mode,
q-page-container .pass-schedule-mode,
q-page .pass-schedule-mode,
.pass-schedule-mode,
[class*="pass-schedule-mode"],
div.pass-schedule-mode {
  height: auto !important;
  /* ‚úÖ height: 100% Ï†úÍ±∞ÌïòÏó¨ ÎÇ¥Ïö©Ïóê ÎßûÍ≤å Ï°∞Ï†ï */
  width: 100%;
  padding: 0 !important;
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÏÉÅÎã® Ìå®Îî© Ï†úÍ±∞ */
  margin: 0 !important;
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© Ï†úÍ±∞ */
  /* ‚úÖ min-heightÎäî Í≥µÌÜµ CSSÏùò var(--theme-layout-modePageMinHeight, 500px) ÏÇ¨Ïö© */
  max-height: none !important;
  /* ‚úÖ ÏµúÎåÄ ÎÜíÏù¥ Ï†úÍ±∞ */
  display: flex !important;
  /* ‚úÖ flexboxÎ°ú Î≥ÄÍ≤Ω */
  flex-direction: column !important;
  /* ‚úÖ ÏÑ∏Î°ú Î∞©Ìñ• */
  gap: 0 !important;
  /* ‚úÖ flex gap Ï†úÍ±∞ */
  row-gap: 0 !important;
  /* ‚úÖ flex row-gap Ï†úÍ±∞ */
  column-gap: 0 !important;
  /* ‚úÖ flex column-gap Ï†úÍ±∞ */
}

/* router-view, q-page-containerÏùò ÌïòÎã® Ìå®Îî©/ÎßàÏßÑ Ï†úÍ±∞ */
router-view,
q-page-container,
router-view>*,
q-page-container>* {
  padding-bottom: 0 !important;
  margin-bottom: 0 !important;
}

/* router-view ÎÇ¥Î∂ÄÏùò Î™®Îì† ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
router-view .pass-schedule-mode,
q-page-container .pass-schedule-mode {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ pass-schedule-mode ÎÇ¥Î∂ÄÏùò ÎßàÏßÄÎßâ ÏöîÏÜå ÌïòÎã® Ïó¨Î∞±ÏùÑ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå) */
.pass-schedule-mode>*:last-child {
  margin-bottom: 0 !important;
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïòÍ≤å ÌïòÎã® ÎßàÏßÑ ÏóÜÏùå */
  padding-bottom: 0 !important;
}

/* ‚úÖ pass-schedule-mode ÎÇ¥Î∂ÄÏùò Î™®Îì† ÏßÅÏ†ë ÏûêÏãù ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode>* {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-rowÍ∞Ä pass-schedule-modeÏùò ÎßàÏßÄÎßâ ÏûêÏãùÏùº Îïå ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ */
.pass-schedule-mode>.main-content-row:last-child,
.pass-schedule-mode>.row.main-content-row:last-child,
.pass-schedule-mode>div.main-content-row:last-child,
.pass-schedule-mode>.main-content-row,
.pass-schedule-mode>.row.main-content-row,
.pass-schedule-mode>div.main-content-row {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* ‚úÖ pass-schedule-modeÏùò ÎßàÏßÄÎßâ div ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ (Îçî Í∞ïÎ†•Ìïú ÏÑ†ÌÉùÏûê) */
.pass-schedule-mode>div:last-child {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ pass-schedule-modeÏùò ÎßàÏßÄÎßâ row ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ */
.pass-schedule-mode>.row:last-child {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ pass-schedule-modeÏùò Î™®Îì† ÏßÅÏ†ë ÏûêÏãù row ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode>.row {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ pass-schedule-modeÏùò Î™®Îì† ÏßÅÏ†ë ÏûêÏãù div ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode>div {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ Ïô∏Í∞Å Í≥µÍ∞Ñ Ï†úÏñ¥ - Îã®ÏàúÌôî */
.pass-schedule-mode .schedule-container {
  padding: 0;
  width: 100%;
  height: 100%;
  margin: 0;
}

.section-title {
  font-weight: 500;
  padding-left: 0.5rem;
  margin-bottom: 1rem;
}

/* ===== 2. Ïª®Ìä∏Î°§ ÏÑπÏÖò Í∏∞Î≥∏ Ïä§ÌÉÄÏùº ===== */
.control-section {
  height: 100%;
  max-height: 500px;
  width: 100%;
  background-color: var(--theme-card-background);
  /* ‚úÖ border, border-radius, box-shadowÎäî mode-common.scssÏóêÏÑú ÌÜµÏùº Í¥ÄÎ¶¨ */
  /* ‚úÖ EphemerisDesignationPage.vueÏôÄ ÎèôÏùºÌïú ÎÜíÏù¥Î•º ÏúÑÌï¥ flex Ï∂îÍ∞Ä - ÎÇ¥Î∂Ä Íµ¨ÏÑ± Î≥ÄÍ≤Ω ÏóÜÏùå */
  display: flex;
  flex-direction: column;
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò Î™®Îì† Ïª¨Îüº ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row>[class*="col-"] {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò ÎßàÏßÄÎßâ Ïª¨Îüº ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ (Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÑ†ÌÉùÏûê) */
.pass-schedule-mode .main-content-row>[class*="col-"]:last-child {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò Î™®Îì† Ïª¨Îüº ÎÇ¥Î∂ÄÏùò q-card ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row>[class*="col-"] .q-card {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò ÎßàÏßÄÎßâ Ïª¨Îüº ÎÇ¥Î∂ÄÏùò q-card ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ (Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÑ†ÌÉùÏûê) */
.pass-schedule-mode .main-content-row>[class*="col-"]:last-child .q-card {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò Î™®Îì† Ïª¨Îüº ÎÇ¥Î∂ÄÏùò q-card-section ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row>[class*="col-"] .q-card-section {
  padding-bottom: 0 !important;
  margin-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò ÎßàÏßÄÎßâ Ïª¨Îüº ÎÇ¥Î∂ÄÏùò q-card-section ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ (Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÑ†ÌÉùÏûê) */
.pass-schedule-mode .main-content-row>[class*="col-"]:last-child .q-card-section {
  padding-bottom: 0 !important;
  margin-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò Quasar q-card ÌïòÎã® ÎßàÏßÑ/Ìå®Îî© ÏôÑÏ†Ñ Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row .q-card {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ main-content-row ÎÇ¥Î∂ÄÏùò Î™®Îì† control-section ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row .control-section {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ Position View Ïπ¥Îìú ÎÜíÏù¥ Ï†úÌïú */
.pass-schedule-mode .control-section.position-view-card,
.pass-schedule-mode .control-section.position-view-card.q-card {
  min-height: 360px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• */
  height: 100% !important;
  /* ‚úÖ Î∂ÄÎ™® ÎÜíÏù¥Ïóê ÎßûÏ∂§ (Îã§Î•∏ Ìå®ÎÑêÍ≥º ÎèôÏùºÌïòÍ≤å) */
  display: flex !important;
  flex-direction: column !important;
}

/* ‚úÖ Position View Ïπ¥Îìú ÏÑπÏÖò ÎÜíÏù¥ Ï°∞Ï†ï */
.pass-schedule-mode .control-section.position-view-card .q-card-section.position-view-section {
  min-height: 360px !important;
  /* ‚úÖ Ï∞®Ìä∏ ÏòÅÏó≠ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• */
  height: 100% !important;
  /* ‚úÖ Î∂ÄÎ™® ÎÜíÏù¥Ïóê ÎßûÏ∂§ (Îã§Î•∏ Ìå®ÎÑêÍ≥º ÎèôÏùºÌïòÍ≤å) */
  flex: 1 !important;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞Ñ Ï±ÑÏö∞Í∏∞ */
  display: flex !important;
  flex-direction: column !important;
}

.control-section .q-card-section {
  padding: 16px !important;
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© Ï†úÍ±∞ (ÏÉÅÎã® Í≥µÍ∞ÑÍ≥º ÎèôÏùºÌïòÍ≤å) */
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞ÑÏùÑ Ï±ÑÏö∞ÎèÑÎ°ù flex Ï∂îÍ∞Ä - ÎÇ¥Î∂Ä Íµ¨ÏÑ± Î≥ÄÍ≤Ω ÏóÜÏùå */
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  /* ‚úÖ Ï†úÎ™© absolute positioningÏùÑ ÏúÑÌïú Í∏∞Ï§ÄÏ†ê */
}

/* ‚úÖ Schedule Information Ïπ¥Îìú ÎÜíÏù¥Î•º Position ViewÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (360px) */
.pass-schedule-mode .main-content-row>[class*="col-"]:nth-child(2) .control-section,
.pass-schedule-mode .main-content-row>[class*="col-"]:nth-child(2) .control-section.q-card {
  min-height: 360px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• */
  height: 100% !important;
  /* ‚úÖ Î∂ÄÎ™® ÎÜíÏù¥Ïóê ÎßûÏ∂§ */
  display: flex !important;
  flex-direction: column !important;
}

/* ‚úÖ Schedule Information Ïπ¥Îìú ÏÑπÏÖò ÎÜíÏù¥ Ï°∞Ï†ï */
.pass-schedule-mode .main-content-row>[class*="col-"]:nth-child(2) .control-section .q-card-section {
  min-height: 360px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• */
  flex: 1 !important;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞Ñ Ï±ÑÏö∞Í∏∞ */
  display: flex !important;
  flex-direction: column !important;
}

/* ‚úÖ Schedule Control Ïπ¥Îìú ÎÜíÏù¥Î•º Position ViewÏôÄ ÎèôÏùºÌïòÍ≤å ÏÑ§Ï†ï (367px) */
.pass-schedule-mode .main-content-row .schedule-control-col .control-section,
.pass-schedule-mode .main-content-row .schedule-control-col .control-section.q-card {
  min-height: 367px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• - EphemerisDesignationPage.vueÏôÄ ÎèôÏùº (367px) */
  height: 100% !important;
  /* ‚úÖ Î∂ÄÎ™® ÎÜíÏù¥Ïóê ÎßûÏ∂§ */
  display: flex !important;
  flex-direction: column !important;
}

/* ‚úÖ Schedule Control Ïπ¥Îìú ÏÑπÏÖò ÎÜíÏù¥ Ï°∞Ï†ï */
.pass-schedule-mode .main-content-row .schedule-control-col .control-section .q-card-section.schedule-control-section {
  min-height: 367px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• - EphemerisDesignationPage.vueÏôÄ ÎèôÏùº (367px) */
  flex: 1 1 auto !important;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞Ñ Ï±ÑÏö∞Í∏∞ (flex-grow: 1, flex-shrink: 1, flex-basis: auto) */
  display: flex !important;
  flex-direction: column !important;
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© ÏôÑÏ†Ñ Ï†úÍ±∞ (ÏÉÅÎã® Í≥µÍ∞ÑÍ≥º ÎèôÏùºÌïòÍ≤å) */
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
  overflow: hidden !important;
  /* ‚úÖ ÌïòÎã® Ïó¨Î∞± Î∞©ÏßÄ */
  justify-content: flex-start !important;
  /* ‚úÖ ÏÉÅÎã® Ï†ïÎ†¨Î°ú ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
}

/* ‚úÖ 3Îã®Í≥Ñ: schedule-control-section ÎÇ¥Î∂ÄÏùò button-group ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ (Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÑ†ÌÉùÏûê) */
.pass-schedule-mode .main-content-row .schedule-control-col .control-section .q-card-section.schedule-control-section .button-group {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
  flex-shrink: 0 !important;
  /* ‚úÖ Î≤ÑÌäº Í∑∏Î£πÏù¥ Ï∂ïÏÜåÎêòÏßÄ ÏïäÎèÑÎ°ù */
}

/* ‚úÖ schedule-control-section ÎÇ¥Î∂ÄÏùò ÎßàÏßÄÎßâ ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± ÏôÑÏ†Ñ Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row .schedule-control-col .control-section .q-card-section.schedule-control-section>*:last-child {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

/* ‚úÖ schedule-control-section ÎÇ¥Î∂ÄÏùò Î™®Îì† ÏßÅÏ†ë ÏûêÏãù ÏöîÏÜå ÌïòÎã® Ïó¨Î∞± Ï†úÍ±∞ */
.pass-schedule-mode .main-content-row .schedule-control-col .control-section .q-card-section.schedule-control-section>* {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

.position-view-section {
  padding: 16px 16px 0px 16px !important;
  /* ‚úÖ ÏÉÅÎã® Ìå®Îî©ÏùÑ Îã§Î•∏ Ìå®ÎÑêÍ≥º ÎèôÏùºÌïòÍ≤å 16pxÎ°ú ÎßûÏ∂§, ÌïòÎã® Ìå®Îî© Ï†úÍ±∞ */
}

.position-view-title {
  position: absolute;
  /* ‚úÖ Ï†úÎ™©ÏùÑ absoluteÎ°ú Î∞∞ÏπòÌïòÏó¨ Ï∞®Ìä∏ ÏòÅÏó≠Ïù¥ Ï†ÑÏ≤¥ Í≥µÍ∞Ñ ÏÇ¨Ïö© */
  top: 16px;
  left: 16px;
  z-index: 10;
  margin: 0;
  padding: 0;
}

.chart-area {
  min-height: 340px !important;
  /* ‚úÖ ÏµúÏÜå ÎÜíÏù¥ Î≥¥Ïû• */
  height: 100% !important;
  /* ‚úÖ Î∂ÄÎ™® ÎÜíÏù¥Ïóê ÎßûÏ∂§ */
  flex: 1 !important;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞Ñ Ï±ÑÏö∞Í∏∞ */
  width: 100%;
  display: flex;
  align-items: center;
  /* ‚úÖ Ï§ëÏïô Ï†ïÎ†¨ */
  justify-content: center;
  margin: 0 auto;
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
  padding: 0 !important;
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© Ï†úÍ±∞ */
  box-sizing: border-box;
  overflow: visible !important;
  /* ‚úÖ Ï∞®Ìä∏Í∞Ä ÎÑòÏ≥êÎèÑ Î≥¥Ïù¥ÎèÑÎ°ù Î≥ÄÍ≤Ω */
  text-align: center;
  position: relative;
}

/* ‚úÖ Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà - Ï∞®Ìä∏Î•º Îçî ÌÅ¨Í≤å (Position View Íµ¨Ïó≠ ÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†Å) */
.chart-area>div {
  position: absolute !important;
  left: 50% !important;
  top: 50% !important;
  /* ‚úÖ Ï§ëÏïô Ï†ïÎ†¨ */
  transform: translate(-50%, -50%) !important;
  margin: 0 !important;
  padding: 0 !important;
  box-sizing: border-box !important;
  /* ‚úÖ Ï∞®Ìä∏Î•º Îçî ÌÅ¨Í≤å ÏÑ§Ï†ï (Position View Íµ¨Ïó≠ ÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†Å) */
  width: 500px !important;
  height: 500px !important;
  max-width: 500px !important;
  max-height: 500px !important;
  min-width: 500px !important;
  min-height: 500px !important;
  aspect-ratio: 1 !important;
  /* ‚úÖ Ï†ïÏÇ¨Í∞ÅÌòï Ïú†ÏßÄ */
}

/* Î∞òÏùëÌòï Ï∞®Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†ï - Ï∞®Ìä∏Î•º Îçî ÌÅ¨Í≤å (Position View Íµ¨Ïó≠ ÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†Å) */
@media (max-width: 1900px) {
  .chart-area>div {
    width: 500px !important;
    height: 500px !important;
    max-width: 500px !important;
    max-height: 500px !important;
    min-width: 500px !important;
    min-height: 500px !important;
    top: 50% !important;
    /* ‚úÖ Ï§ëÏïô Ï†ïÎ†¨ */
  }
}

@media (max-width: 1600px) {
  .chart-area>div {
    width: 470px !important;
    height: 470px !important;
    max-width: 470px !important;
    max-height: 470px !important;
    min-width: 470px !important;
    min-height: 470px !important;
    top: 50% !important;
    /* ‚úÖ Ï§ëÏïô Ï†ïÎ†¨ */
  }
}

@media (max-width: 1200px) {
  .chart-area>div {
    width: 420px !important;
    height: 420px !important;
    max-width: 420px !important;
    max-height: 420px !important;
    min-width: 420px !important;
    min-height: 420px !important;
    top: 50% !important;
    /* ‚úÖ Ï§ëÏïô Ï†ïÎ†¨ */
  }
}

/* ===== 4. Ïª®Ìä∏Î°§ Ïπ¥Îìú Ïä§ÌÉÄÏùº ===== */
.control-card {
  height: 100%;
  border-radius: 8px;
  overflow: hidden;
}

/* ‚úÖ Ïª¥Ìå©Ìä∏ Ïª®Ìä∏Î°§ Ïä§ÌÉÄÏùº - Ï†ïÎ¶¨ */
.pass-schedule-mode .compact-control {
  padding: 0 8px;
  margin: 0;
  min-height: auto;
  height: auto;
  line-height: 1;
  vertical-align: top;
}

.pass-schedule-mode .compact-control .q-input {
  margin-bottom: 0.25rem;
}

.pass-schedule-mode .compact-control .q-btn {
  min-height: 2rem;
  padding: 0.25rem;
}

/* ‚úÖ Î†àÏù¥ÏïÑÏõÉ Ï†ïÎ†¨ Ïä§ÌÉÄÏùº - Ï†ïÎ¶¨ */
.pass-schedule-mode .align-center {
  align-items: center;
}

.pass-schedule-mode .justify-end {
  justify-content: flex-end;
}

.pass-schedule-mode .justify-center {
  justify-content: center;
}

/* ‚úÖ Ïª¥Ìå©Ìä∏ Ïª®Ìä∏Î°§ Î†àÏù¥ÏïÑÏõÉ */
.pass-schedule-mode .compact-control .row {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  width: 100%;
}

.pass-schedule-mode .compact-control .q-field {
  margin-bottom: 0;
}

.pass-schedule-mode .compact-control .col-auto {
  flex-shrink: 0;
}

/* ‚úÖ ÏÑ∏Î∂Ä Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùº - Ï†ïÎ¶¨ */
.pass-schedule-mode .compact-control .row .row {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 0.25rem;
}

.pass-schedule-mode .compact-control .text-subtitle2 {
  display: flex;
  align-items: center;
  height: 100%;
  margin: 0;
  padding: 0;
  font-size: 0.9rem;
  white-space: nowrap;
}

.pass-schedule-mode .compact-control .col-1 {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  min-width: fit-content;
}

/* ‚úÖ ÏûÖÎ†• ÌïÑÎìú Ïä§ÌÉÄÏùº - ÌÜµÏùº */
.pass-schedule-mode .offset-input {
  width: 110px;
  min-width: 110px;
  max-width: 110px;
}

.pass-schedule-mode .cal-time-field {
  min-width: 190px;
  max-width: 220px;
}

/* ‚úÖ ÏÉàÎ°úÏö¥ ÏÑ∏Î°ú Î≤ÑÌäº Î†àÏù¥ÏïÑÏõÉ */
.vertical-button-group {
  display: flex !important;
  align-items: center !important;
  gap: 4px !important;
}

.vertical-buttons {
  display: flex !important;
  flex-direction: column !important;
  gap: 2px !important;
}

/* ‚úÖ Î∞©Î≤ï 1: ÏôºÏ™Ω ÏÑ∏Î°ú ÎùºÎ≤® (Ïπ¥Îìú Ïïà) - ÎÜíÏù¥ ÏµúÏ†ÅÌôî */
.position-offset-label {
  background: linear-gradient(135deg, rgba(25, 118, 210, 0.15) 0%, rgba(25, 118, 210, 0.08) 100%);
  padding: 4px 8px;
  border-radius: 6px;
  border-right: 3px solid var(--q-primary);
  min-width: 50px;
  margin-right: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
}

.position-offset-label .text-subtitle2 {
  font-size: 0.8rem !important;
  line-height: 1.2 !important;
}

/* ‚úÖ Ïπ¥Îìú ÌÖåÎëêÎ¶¨ ÏúÑÏïÑÎûò Ìå®Îî© ÏôÑÏ†Ñ Ï†úÍ±∞ - Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÖÄÎ†âÌÑ∞ */
.q-card.control-card .q-card-section.compact-control {
  padding: 0px 8px !important;
}

/* ‚úÖ Ï∂îÍ∞ÄÏ†ÅÏù∏ Í∞ïÏ†ú Ï†ÅÏö© */
.q-card-section.compact-control {
  padding-top: 0px !important;
  padding-bottom: 0px !important;
  padding-left: 8px !important;
  padding-right: 8px !important;
}

/* ‚úÖ Îçî Í∞ïÎ†•Ìïú Í∞ïÏ†ú Ï†ÅÏö© - Î™®Îì† Í∞ÄÎä•Ìïú ÏÖÄÎ†âÌÑ∞ */
.q-card-section.compact-control.purple-1,
.q-card.control-card .q-card-section.compact-control.purple-1,
.q-card-section[class*="compact-control"],
.q-card-section[class*="purple-1"] {
  padding-top: 0px !important;
  padding-bottom: 0px !important;
  padding-left: 8px !important;
  padding-right: 8px !important;
  margin-top: 0px !important;
  margin-bottom: 0px !important;
  min-height: auto !important;
  height: auto !important;
  line-height: 1 !important;
  vertical-align: top !important;
  display: flex !important;
  align-items: flex-start !important;
}

/* ‚úÖ Quasar Í∏∞Î≥∏ Ïä§ÌÉÄÏùº ÎçÆÏñ¥Ïì∞Í∏∞ - 1Ìñâ offset control Ïπ¥ÎìúÏóêÎßå Ï†ÅÏö© */
.pass-schedule-mode .q-card.control-card .q-card-section {
  padding-top: 0px !important;
  padding-bottom: 0px !important;
  line-height: 1 !important;
  vertical-align: top !important;
}

/* ‚úÖ 2Ìñâ control-section Ïπ¥ÎìúÎäî Í∏∞Î≥∏ Ìå®Îî© Ïú†ÏßÄ */
.pass-schedule-mode .control-section .q-card-section {
  padding: 16px !important;
}

/* ‚úÖ Ïπ¥Îìú ÏûêÏ≤¥ ÎßàÏßÑÎèÑ Ï†úÍ±∞ */
.pass-schedule-mode .q-card.control-card {
  margin-bottom: 0px !important;
  min-height: auto !important;
  height: auto !important;
  line-height: 1 !important;
  vertical-align: top !important;
}

.pass-schedule-mode .q-card.control-card .q-card__section {
  padding-top: 0px !important;
  padding-bottom: 0px !important;
  min-height: auto !important;
  height: auto !important;
  line-height: 1 !important;
  vertical-align: top !important;
}

/* ‚úÖ Ï∂îÍ∞Ä ÎÜíÏù¥ Ï§ÑÏù¥Í∏∞ - Î™®Îì† ÏöîÏÜåÏùò ÎÜíÏù¥ ÏµúÏÜåÌôî */
.pass-schedule-mode .q-input {
  min-height: auto !important;
}

.pass-schedule-mode .q-field__control {
  min-height: auto !important;
}

.pass-schedule-mode .q-field__native {
  padding: auto !important;
}

.pass-schedule-mode .q-btn {
  min-height: auto !important;
}

.pass-schedule-mode .q-btn--dense {
  min-height: auto !important;
}

/* ‚úÖ ÎùºÎ≤® ÌÖåÎëêÎ¶¨ ÎÜíÏù¥Îßå Ï§ÑÏù¥Í∏∞ - ÎÇ¥Î∂Ä Íµ¨ÏÑ±ÏùÄ Ïú†ÏßÄ */
.pass-schedule-mode .position-offset-label {
  padding: 4px 8px !important;
  min-width: 50px !important;
  border-right: 1px solid var(--q-primary) !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
}

.pass-schedule-mode .position-offset-label .text-subtitle2 {
  font-size: 0.8rem !important;
  line-height: 1.2 !important;
}

/* ‚úÖ Í∞ÑÍ≤© Ï†úÍ±∞Î°ú Îçî ÌÉÄÏù¥Ìä∏ÌïòÍ≤å */
.pass-schedule-mode .compact-control .row.q-gutter-none {
  margin: 0 !important;
  padding: 0 !important;
}

.pass-schedule-mode .compact-control .row.q-gutter-none>div {
  padding-left: 0.25rem !important;
  padding-right: 0.25rem !important;
}

.pass-schedule-mode .compact-control .row.q-gutter-none>div:first-child {
  padding-left: 0 !important;
}

.pass-schedule-mode .compact-control .row.q-gutter-none>div:last-child {
  padding-right: 0 !important;
}

/* ===== 5. Ïª¥Ìå©Ìä∏ Ïª®Ìä∏Î°§ Ìñâ Ïä§ÌÉÄÏùº ===== */
.compact-control-row {
  display: flex;
  align-items: center;
  gap: 6px;
  width: 100%;
  min-height: 48px;
}

/* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú ÌôïÏã§Ìûà Í∞ÄÎ°ú Î∞∞Ïπò Ïú†ÏßÄ */
@media (min-width: 768px) {
  .compact-control-row {
    flex-direction: row !important;
    align-items: center !important;
    gap: 6px !important;
  }
}

/* Input ÌïÑÎìú Ïä§ÌÉÄÏùº */
.control-input {
  flex: 1;
  min-width: 80px;
  max-width: 120px;
}

.control-input :deep(.q-field__control) {
  height: 40px;
}

/* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú ÏûÖÎ†• ÌïÑÎìú ÌÅ¨Í∏∞ Í≥†Ï†ï */
@media (min-width: 768px) {
  .control-input {
    flex: 1 !important;
    min-width: 80px !important;
    max-width: 120px !important;
  }
}

/* Î≤ÑÌäº Í∑∏Î£π Ïä§ÌÉÄÏùº */
.control-buttons {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex-shrink: 0;
  width: 32px;
}

.control-buttons .q-btn {
  min-width: 32px !important;
  width: 32px !important;
  height: 19px;
  padding: 0;
  flex-shrink: 0;
}

/* Î¶¨ÏÖã Î≤ÑÌäº Ïä§ÌÉÄÏùº */
.reset-button {
  min-width: 32px !important;
  width: 32px !important;
  height: 40px !important;
  flex-shrink: 0 !important;
}

/* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Î¶¨ÏÖã Î≤ÑÌäº ÌÅ¨Í∏∞ Í≥†Ï†ï */
@media (min-width: 768px) {
  .reset-button {
    min-width: 32px !important;
    width: 32px !important;
    height: 40px !important;
    flex-shrink: 0 !important;
  }
}

/* Output ÌïÑÎìú Ïä§ÌÉÄÏùº */
.output-input-small {
  flex: 1;
  min-width: 80px;
  max-width: 120px;
}

.output-input-small :deep(.q-field__control) {
  height: 40px;
}

/* ===== 6. Time Ïª®Ìä∏Î°§ ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº ===== */
.time-output-section {
  flex: 2;
  display: flex;
  gap: 4px;
  align-items: center;
}

.time-output-section .output-input {
  flex: 1;
  min-width: 80px;
  max-width: 120px;
}

.time-output-section .output-input :deep(.q-field__control) {
  height: 40px;
}

.time-output-section .cal-time-input {
  flex: 1.5;
  min-width: 140px;
}

.time-output-section .cal-time-input :deep(.q-field__control) {
  height: 40px;
}

.time-output-section .cal-time-input :deep(.q-field__control input) {
  font-size: 11px;
  font-family: 'Courier New', monospace;
}

/* ===== 7. Ïä§ÏºÄÏ§Ñ Ï†ïÎ≥¥ ÏÑπÏÖò Ïä§ÌÉÄÏùº ===== */
.schedule-form {
  margin-top: 0.5rem;
  width: 100%;
  margin-bottom: 0;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
  flex: 1;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞ÑÏùÑ Ï±ÑÏõåÏÑú ÌïòÎã® Ï†ïÎ†¨ */
  display: flex;
  flex-direction: column;
}

.form-row {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  /* ‚úÖ gap Ï§ÑÏûÑ (0.5rem ‚Üí 0.25rem) */
  width: 100%;
  flex: 1;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞ÑÏùÑ Ï±ÑÏõåÏÑú ÌïòÎã® Ï†ïÎ†¨ */
  justify-content: flex-start;
  /* ‚úÖ ÏÉÅÎã®Î∂ÄÌÑ∞ ÏãúÏûë */
}

.schedule-info {
  background-color: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 12px 16px 8px 16px;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© Ï§ÑÏûÑ (16px ‚Üí 8px) */
  border: 1px solid rgba(255, 255, 255, 0.1);
  flex: 1;
  /* ‚úÖ ÎÇ®ÏùÄ Í≥µÍ∞ÑÏùÑ Ï±ÑÏõåÏÑú ÌïòÎã® Ï†ïÎ†¨ */
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  /* ‚úÖ ÏÉÅÎã®Î∂ÄÌÑ∞ ÏãúÏûë */
}

.no-schedule-selected {
  padding: 2rem;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 6px;
  background-color: rgba(255, 255, 255, 0.02);
  /* ‚úÖ flex: 1 Ï†úÍ±∞ - EphemerisDesignationPage.vue Í∏∞Ï§ÄÏúºÎ°ú ÎÜíÏù¥ ÎßûÏ∂îÍ∏∞ */
  display: flex;
  align-items: center;
  justify-content: center;
}

.info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  /* ‚úÖ Ìå®Îî© Ï§ÑÏûÑ (8px ‚Üí 6px) */
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.info-row:last-child {
  border-bottom: none;
  margin-bottom: auto;
  /* ‚úÖ ÎßàÏßÄÎßâ Ìñâ ÏïÑÎûòÏóê ÏûêÎèô Ïó¨Î∞± Ï∂îÍ∞ÄÌïòÏó¨ ÌïòÎã® Ï†ïÎ†¨ */
}

.info-label {
  font-weight: 500;
  color: #90caf9;
  min-width: 120px;
}

.info-value {
  font-weight: 400;
  color: #ffffff;
  text-align: right;
  flex: 1;
}

.info-value-with-badge {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
}

/* ===== 8. Ïä§ÏºÄÏ§Ñ Ìó§Îçî Ïä§ÌÉÄÏùº ===== */
.schedule-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 0.5rem;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.schedule-header-title {
  line-height: 1.2;
  margin: 0;
  padding: 0;
}

.schedule-header-right {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 2px;
}

.current-schedule-display {
  display: flex;
  align-items: center;
  padding: 2px 6px;
  background-color: rgba(25, 118, 210, 0.1);
  border-radius: 4px;
  border: 1px solid rgba(25, 118, 210, 0.3);
}

.registered-schedule-info {
  background-color: rgba(0, 0, 0, 0.8);
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.registered-schedule-info .text-body2 {
  margin-bottom: 0;
  font-weight: 600;
  font-size: 11px;
  color: #2196f3;
  line-height: 1.2;
}

.registered-schedule-info .text-caption {
  font-size: 10px;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  line-height: 1.2;
}

/* ===== 9. ÌÖåÏù¥Î∏î Í∏∞Î≥∏ Ïä§ÌÉÄÏùº ===== */
.schedule-table {
  background-color: var(--theme-card-background);
  color: white;
  /* ‚úÖ flex: 1 Ï†úÍ±∞ - EphemerisDesignationPage.vue Í∏∞Ï§ÄÏúºÎ°ú ÎÜíÏù¥ ÎßûÏ∂îÍ∏∞ */
  border-radius: 6px;
  overflow: hidden;
  height: 210px !important;
  /* ‚úÖ ÎÜíÏù¥ Í≥†Ï†ï (Ï†ïÌôïÌûà 3Í∞ú ÌñâÎßå Î≥¥Ïù¥ÎèÑÎ°ù) */
  max-height: 210px !important;
  /* ‚úÖ ÏµúÎåÄ ÎÜíÏù¥ Í≥†Ï†ï */
}

/* Quasar ÌÖåÏù¥Î∏î Í∏∞Î≥∏ ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî */
.schedule-table :deep(.q-table__container) {
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  height: 210px !important;
  /* ‚úÖ ÎÜíÏù¥ Í≥†Ï†ï (Ï†ïÌôïÌûà 3Í∞ú ÌñâÎßå Î≥¥Ïù¥ÎèÑÎ°ù) */
  max-height: 210px !important;
  /* ‚úÖ ÏµúÎåÄ ÎÜíÏù¥ Í≥†Ï†ï */
  display: flex;
  flex-direction: column;
  overflow: hidden;
  /* ‚úÖ Ïª®ÌÖåÏù¥ÎÑàÎäî Ïä§ÌÅ¨Î°§ ÏóÜÏùå */
}

/* ‚úÖ ÌÖåÏù¥Î∏î Î∞îÎîî ÏòÅÏó≠Îßå Ïä§ÌÅ¨Î°§ Í∞ÄÎä•ÌïòÎèÑÎ°ù ÏÑ§Ï†ï */
.schedule-table :deep(.q-table__middle) {
  flex: 1;
  overflow-y: auto;
  /* ‚úÖ ÏÑ∏Î°ú Ïä§ÌÅ¨Î°§ Í∞ÄÎä• */
  overflow-x: auto;
  /* ‚úÖ Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ÎèÑ Í∞ÄÎä• */
  min-height: 0;
}

.schedule-table :deep(.q-table__top) {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.12);
}

.schedule-table :deep(.q-table__bottom) {
  display: none !important;
}

.schedule-table :deep(.q-table__control) {
  display: none !important;
}

/* ‚úÖ ÌÖåÏù¥Î∏î Ìó§Îçî Í≥†Ï†ï (Sticky Header) */
.schedule-table :deep(.q-table thead) {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: var(--theme-card-background);
}

/* ÌÖåÏù¥Î∏î Ìó§Îçî Ïä§ÌÉÄÏùº */
.schedule-table :deep(.q-table thead th) {
  background-color: rgba(255, 255, 255, 0.05) !important;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  font-size: 12px;
  padding: 8px 20px 8px 6px;
  border-bottom: 2px solid rgba(255, 255, 255, 0.1);
  text-align: center !important;
  vertical-align: middle !important;
  white-space: pre-line;
  line-height: 1.2;
  height: 50px !important;
  position: sticky;
  top: 0;
  z-index: 10;
}

/* Ìó§Îçî Ï†ïÎ†¨ ÏöîÏÜåÎ•º flexboxÎ°ú Î∂ÑÎ¶¨ Î∞∞Ïπò */
.schedule-table :deep(.q-table thead th .q-table__sort) {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  width: 100% !important;
  height: 100% !important;
}

/* Ìó§Îçî ÌÖçÏä§Ìä∏ Î∂ÄÎ∂Ñ Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */
.schedule-table :deep(.q-table thead th .q-table__sort > span) {
  flex: 1 !important;
  text-align: center !important;
  white-space: pre-line !important;
  line-height: 1.2 !important;
}

/* Ï†ïÎ†¨ ÏïÑÏù¥ÏΩòÏùÑ Ïö∞Ï∏°Ïóê Í≥†Ï†ï Î∞∞Ïπò */
.schedule-table :deep(.q-table thead th .q-table__sort-icon) {
  position: absolute !important;
  right: 4px !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  flex-shrink: 0 !important;
  margin: 0 !important;
}





/* ÌÖåÏù¥Î∏î Î∞îÎîî Í∏∞Î≥∏ Ïä§ÌÉÄÏùº */
.schedule-table :deep(.q-table tbody) {
  background-color: transparent;
}

/* ===== 10. ÌÖåÏù¥Î∏î Ìñâ Í∏∞Î≥∏ Ïä§ÌÉÄÏùº ===== */
.schedule-table :deep(.q-table tbody tr) {
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  transition: all 0.2s ease;
  cursor: pointer;
}

/* Í∏∞Î≥∏ Ìò∏Î≤Ñ Ìö®Í≥º */
.schedule-table :deep(.q-table tbody tr:hover) {
  background-color: rgba(255, 255, 255, 0.08) !important;
}

/* ÏßùÏàò Ìñâ Ïä§ÌÉÄÏùº Ï†úÍ±∞ (Quasar Í∏∞Î≥∏Í∞í Ïò§Î≤ÑÎùºÏù¥Îìú) */
.schedule-table :deep(.q-table tbody tr:nth-child(even)) {
  background-color: transparent;
}

/* ÌÖåÏù¥Î∏î ÏÖÄ Í∏∞Î≥∏ Ïä§ÌÉÄÏùº */
.schedule-table :deep(.q-table tbody td) {
  padding: 8px 6px;
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  border-right: 1px solid rgba(255, 255, 255, 0.04);
  vertical-align: middle;
  text-align: center;
}

.schedule-table :deep(.q-table tbody td:last-child) {
  border-right: none;
}

/* Ìñâ ÏÑ†ÌÉù Ìö®Í≥º */
.schedule-table :deep(.q-table tbody tr.selected) {
  background-color: rgba(33, 150, 243, 0.1) !important;
  border-left: 3px solid #2196f3;
}

/* ===== 11. ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïä§ÌÉÄÏùº (ÏµúÍ≥† Ïö∞ÏÑ†ÏàúÏúÑ) ===== */

/* ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ */
.schedule-table :deep(.q-table tbody tr.current-tracking-row) {
  background-color: #c8e6c9 !important;
  border-left: 4px solid #4caf50 !important;
  color: #2e7d32 !important;
}

.schedule-table :deep(.q-table tbody tr.current-tracking-row td) {
  background-color: #c8e6c9 !important;
  color: #2e7d32 !important;
  font-weight: 500;
}

.schedule-table :deep(.q-table tbody tr.current-tracking-row:hover) {
  background-color: #a5d6a7 !important;
}

.schedule-table :deep(.q-table tbody tr.current-tracking-row:hover td) {
  background-color: #a5d6a7 !important;
}

/* Îã§Ïùå ÏòàÏ†ï Ïä§ÏºÄÏ§Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ */
.schedule-table :deep(.q-table tbody tr.next-tracking-row) {
  background-color: #e3f2fd !important;
  border-left: 4px solid #2196f3 !important;
  color: #1565c0 !important;
}

.schedule-table :deep(.q-table tbody tr.next-tracking-row td) {
  background-color: #e3f2fd !important;
  color: #1565c0 !important;
  font-weight: 500;
}

.schedule-table :deep(.q-table tbody tr.next-tracking-row:hover) {
  background-color: #bbdefb !important;
}

.schedule-table :deep(.q-table tbody tr.next-tracking-row:hover td) {
  background-color: #bbdefb !important;
}

/* ÌÖåÏä§Ìä∏Ïö© Ï≤´ Î≤àÏß∏ Ìñâ ÌïòÏù¥ÎùºÏù¥Ìä∏ */
.schedule-table :deep(.q-table tbody tr.highlight-first-row) {
  background-color: #ffeb3b !important;
  color: #000 !important;
  border-left: 4px solid #ffc107 !important;
}

.schedule-table :deep(.q-table tbody tr.highlight-first-row td) {
  background-color: #ffeb3b !important;
  color: #000 !important;
  font-weight: 600;
}

.schedule-table :deep(.q-table tbody tr.highlight-first-row:hover) {
  background-color: #ffc107 !important;
}

.schedule-table :deep(.q-table tbody tr.highlight-first-row:hover td) {
  background-color: #ffc107 !important;
  /* ===== 12. ÌÖåÏù¥Î∏î Ïª¨ÎüºÎ≥Ñ ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº ===== */

  /* ÏúÑÏÑ± Ï†ïÎ≥¥ Ïª¨Îüº */
  .satellite-info-cell {
    padding: 8px 6px !important;
    min-width: 100px;
  }

  .satellite-container {
    display: flex;
    flex-direction: column;
    gap: 3px;
    align-items: flex-start;
  }

  .satellite-id {
    font-weight: 600;
    font-size: 11px;
    color: #2196f3;
    line-height: 1.2;
  }

  .satellite-name {
    font-size: 10px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 400;
    line-height: 1.2;
    word-break: break-word;
  }

  /* ÏãúÍ∞Ñ Î≤îÏúÑ Ïª¨Îüº */
  .time-range-cell {
    padding: 8px 6px !important;
    min-width: 130px;
  }

  .time-container {
    display: flex;
    flex-direction: column;
    gap: 3px;
    align-items: flex-start;
  }

  .start-time,
  .end-time {
    font-size: 10px;
    font-weight: 500;
    line-height: 1.2;
    font-family: 'Courier New', monospace;
  }

  .start-time {
    color: #4caf50;
  }

  .end-time {
    color: #ff9800;
  }
}

/* ===== 12. ÌÖåÏù¥Î∏î Ïª¨ÎüºÎ≥Ñ ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº ===== */

/* ÏúÑÏÑ± Ï†ïÎ≥¥ Ïª¨Îüº */
.satellite-info-cell {
  padding: 8px 6px !important;
  min-width: 100px;
  text-align: center;
}

.satellite-container {
  display: flex;
  flex-direction: column;
  gap: 3px;
  align-items: center;
}

.satellite-id {
  font-weight: 600;
  font-size: 14px;
  color: #2196f3;
  line-height: 1.2;
}

.satellite-name {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 400;
  line-height: 1.2;
  word-break: break-word;
}

/* ÏãúÍ∞Ñ Î≤îÏúÑ Ïª¨Îüº */
.time-range-cell {
  padding: 8px 6px !important;
  min-width: 130px;
  text-align: center;
}

.time-container {
  display: flex;
  flex-direction: column;
  gap: 3px;
  align-items: center;
}

.start-time,
.end-time {
  font-size: 14px;
  font-weight: 500;
  line-height: 1.2;
  font-family: 'Courier New', monospace;
}

.start-time {
  color: #4caf50;
}

.end-time {
  color: #ff9800;
}

/* ===== 12.5. Ïä§ÏºÄÏ§Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïä§ÌÉÄÏùº ===== */

/* ÌòÑÏû¨ Ï∂îÏ†Å Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏ - Îçî Í∞ïÎ†•Ìïú ÏÑ†ÌÉùÏûê */
.schedule-table tbody tr.highlight-current-schedule {
  background-color: rgba(27, 94, 32, 0.92) !important;
  border-left: 4px solid #66bb6a !important;
  color: #e8f5e9 !important;
}

.schedule-table tbody tr.highlight-current-schedule td {
  background-color: transparent !important;
  color: inherit !important;
  font-weight: 600 !important;
}

.schedule-table tbody tr.highlight-current-schedule * {
  background-color: transparent !important;
  color: inherit !important;
}

.schedule-table tbody tr.highlight-current-schedule .q-btn,
.schedule-table tbody tr.highlight-current-schedule .q-icon {
  background-color: transparent !important;
}

.schedule-table tbody tr.highlight-current-schedule:hover td {
  background-color: rgba(46, 125, 50, 0.95) !important;
}

.schedule-table tbody tr.highlight-next-schedule {
  background-color: rgba(13, 71, 161, 0.9) !important;
  border-left: 4px solid #42a5f5 !important;
  color: #e3f2fd !important;
}

.schedule-table tbody tr.highlight-next-schedule td {
  background-color: transparent !important;
  color: inherit !important;
  font-weight: 600 !important;
}

.schedule-table tbody tr.highlight-next-schedule * {
  background-color: transparent !important;
  color: inherit !important;
}

.schedule-table tbody tr.highlight-next-schedule .q-btn,
.schedule-table tbody tr.highlight-next-schedule .q-icon {
  background-color: transparent !important;
}

.schedule-table tbody tr.highlight-next-schedule:hover td {
  background-color: rgba(25, 118, 210, 0.92) !important;
}



/* ===== 13. Azimuth/Elevation Ïª¨Îüº Ïä§ÌÉÄÏùº ===== */

/* Azimuth Î≤îÏúÑ Ïª¨Îüº */
.azimuth-range-cell {
  padding: 8px 6px !important;
  vertical-align: middle !important;
  min-width: 80px;
  text-align: center;
}

.azimuth-container {
  display: flex;
  flex-direction: column;
  gap: 3px;
  align-items: center;
  justify-content: center;
  min-height: 35px;
}

.start-az,
.end-az {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.2;
  font-family: 'Courier New', monospace;
}

.start-az {
  color: #4caf50;
}

.end-az {
  color: #ff9800;
}

/* Elevation Ï†ïÎ≥¥ Ïª¨Îüº */
.elevation-info-cell {
  padding: 8px 6px !important;
  vertical-align: middle !important;
  min-width: 70px;
  text-align: center;
}

.elevation-container {
  display: flex;
  flex-direction: column;
  gap: 3px;
  align-items: center;
  justify-content: center;
  min-height: 35px;
}

.max-elevation,
.train {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.2;
  font-family: 'Courier New', monospace;
}

.max-elevation {
  color: #9c27b0;
}

.train {
  color: #607d8b;
}

/* ===== 14. Î≤ÑÌäº Í∑∏Î£π Ïä§ÌÉÄÏùº ===== */
.button-group {
  margin-top: 0.25rem;
  /* ‚úÖ ÏÉÅÎã® ÎßàÏßÑ Ï§ÑÏûÑ (0.5rem ‚Üí 0.25rem) */
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ ÏôÑÏ†Ñ Ï†úÍ±∞ */
  width: 100%;
  flex-shrink: 0;
  padding-top: 0.25rem;
  /* ‚úÖ ÏÉÅÎã® Ìå®Îî© Ï§ÑÏûÑ (0.5rem ‚Üí 0.25rem) */
  padding-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® Ìå®Îî© ÏôÑÏ†Ñ Ï†úÍ±∞ */
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  box-sizing: border-box !important;
  display: flex !important;
  /* ‚úÖ flex Ïª®ÌÖåÏù¥ÎÑàÎ°ú Î™ÖÏãú */
  flex-direction: column !important;
  /* ‚úÖ ÏÑ∏Î°ú Î∞©Ìñ• */
  gap: 0.5rem !important;
  /* ‚úÖ Î≤ÑÌäº Ìñâ ÏÇ¨Ïù¥ Í∞ÑÍ≤© Î™ÖÏãú (Í≤πÏπ® Î∞©ÏßÄ) */
}

.button-row {
  display: flex;
  gap: 0.5rem;
  width: 100%;
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ ÏôÑÏ†Ñ Ï†úÍ±∞ (ÏÉÅÎã® Í≥µÍ∞ÑÍ≥º ÎèôÏùºÌïòÍ≤å) */
  flex-shrink: 0 !important;
  /* ‚úÖ Î≤ÑÌäº ÌñâÏù¥ Ï∂ïÏÜåÎêòÏßÄ ÏïäÎèÑÎ°ù */
}

/* ‚úÖ Quasar q-mb-sm ÌÅ¥ÎûòÏä§ Ïò§Î≤ÑÎùºÏù¥Îìú (button-rowÏóê Ï†ÅÏö©Îêú Í≤ΩÏö∞) */
.button-row.q-mb-sm,
.schedule-control-section .button-row.q-mb-sm {
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ ÏôÑÏ†Ñ Ï†úÍ±∞ */
}

.control-button-row {
  display: flex;
  gap: 0.5rem;
  width: 100%;
  flex-shrink: 0 !important;
  /* ‚úÖ Î≤ÑÌäº ÌñâÏù¥ Ï∂ïÏÜåÎêòÏßÄ ÏïäÎèÑÎ°ù */
  margin-bottom: 0 !important;
  /* ‚úÖ ÌïòÎã® ÎßàÏßÑ Ï†úÍ±∞ */
}

/* ÏóÖÎ°úÎìú Î≤ÑÌäº Ïä§ÌÉÄÏùº - ÌÅ¨Í∏∞Îäî Ïú†ÏßÄÌïòÍ≥† Ìè∞Ìä∏Îßå ÌôïÎåÄ */
.upload-btn {
  flex: 1;
  min-width: 0;
  height: 36px;
  font-size: 13px;
  font-weight: 500;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.pass-schedule-mode .button-group :deep(.upload-btn .q-btn__content) {
  font-size: 13px;
  line-height: 1.2;
}

.pass-schedule-mode :deep(.control-btn .q-btn__content) {
  font-size: 13px;
  line-height: 1.2;
}

.upload-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Ïª®Ìä∏Î°§ Î≤ÑÌäº Ïä§ÌÉÄÏùº - ÌÅ¨Í∏∞Îäî Ïú†ÏßÄÌïòÍ≥† Ìè∞Ìä∏Îßå ÌôïÎåÄ */
.control-btn {
  flex: 1;
  min-width: 0;
  height: 32px;
  font-size: 13px;
  font-weight: 500;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.control-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
}

/* ÎîîÎ≤ÑÍ∑∏ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
.debug-buttons {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-top: 0.5rem;
  padding: 0.5rem;
  background-color: rgba(255, 255, 255, 0.02);
  border-radius: 4px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.debug-buttons .q-btn {
  font-size: 11px;
  height: 28px;
  padding: 0 8px;
}

/* ===== 15. ÎîîÎ≤ÑÍ∑∏ Ìå®ÎÑê Ïä§ÌÉÄÏùº ===== */
.debug-panel {
  background-color: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.3);
  border-radius: 4px;
}

.debug-panel .q-card-section {
  padding: 8px 12px;
}

.debug-panel .text-caption {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.8);
  font-family: 'Courier New', monospace;
  line-height: 1.4;
}

.debug-panel .text-caption strong {
  color: #ffc107;
  font-weight: 600;
}

/* ÌòÑÏû¨ Ïä§ÏºÄÏ§Ñ ÏÉÅÌÉú ÌëúÏãú */
.current-schedule-status {
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.current-schedule-status .q-card-section {
  padding: 12px 16px;
}

.current-schedule-status .row {
  align-items: center;
}

.current-schedule-status .q-icon {
  margin-right: 8px;
}

.current-schedule-status .text-body2 {
  font-weight: 500;
  color: rgba(255, 255, 255, 0.9);
}

.current-schedule-status .q-badge {
  font-size: 10px;
  font-weight: 600;
}

/* ===== 16. Î∞òÏùëÌòï ÎîîÏûêÏù∏ ===== */

/* ÌÉúÎ∏îÎ¶ø ÌÅ¨Í∏∞ (1024px Ïù¥Ìïò) */
@media (max-width: 1023px) {
  .control-section {
    height: auto;
    min-height: 400px;
  }

  .chart-area {
    height: 300px;
  }

  /* Ïò§ÌîÑÏÖã Ïª®Ìä∏Î°§ÏùÑ 2x2Î°ú Î∞∞Ïπò */
  .row:first-of-type .col-sm-3 {
    flex: 0 0 50%;
    max-width: 50%;
  }

  .schedule-container {
    padding: 0.5rem;
  }

  .button-row,
  .control-button-row {
    flex-direction: column;
    gap: 0.5rem;
  }

  .upload-btn,
  .control-btn {
    width: 100%;
    height: 44px;
  }
}

/* Î™®Î∞îÏùº ÌÅ¨Í∏∞ (768px Ïù¥Ìïò) */
@media (max-width: 767px) {
  .pass-schedule-mode {
    padding: 0.25rem !important;
    /* ‚úÖ Î™®Î∞îÏùºÏóêÏÑúÎßå Ìå®Îî© Ï†ÅÏö© */
    padding-bottom: 0 !important;
    /* ‚úÖ ÌïòÎã® Ìå®Îî©ÏùÄ Ïó¨Ï†ÑÌûà Ï†úÍ±∞ */
  }

  .schedule-container {
    padding: 0.25rem;
  }

  /* Ïò§ÌîÑÏÖã Ïª®Ìä∏Î°§ÏùÑ ÏÑ∏Î°úÎ°ú Î∞∞Ïπò */
  .row:first-of-type .col-sm-3 {
    flex: 0 0 100%;
    max-width: 100%;
    margin-bottom: 0.5rem;
  }

  .control-section {
    height: auto;
    min-height: 300px;
  }

  .chart-area {
    height: 250px;
  }

  .schedule-table {
    font-size: 11px;
  }

  .schedule-table :deep(.q-table thead th) {
    font-size: 10px;
    padding: 8px 4px;
  }

  .schedule-table :deep(.q-table tbody td) {
    padding: 6px 4px;
    font-size: 10px;
  }

  .compact-control-row {
    flex-direction: column;
    gap: 4px;
    align-items: stretch;
  }

  .control-input,
  .output-input-small {
    flex: none;
    width: 100%;
    max-width: none;
  }

  .time-output-section {
    flex-direction: column;
    gap: 4px;
  }

  .time-output-section .output-input,
  .time-output-section .cal-time-input {
    flex: none;
    width: 100%;
    max-width: none;
  }
}

/* ÏûëÏùÄ Î™®Î∞îÏùº ÌÅ¨Í∏∞ (480px Ïù¥Ìïò) */
@media (max-width: 479px) {
  .section-title {
    font-size: 1.2rem;
    padding-left: 0.25rem;
  }

  .control-section .q-card-section {
    padding: 0.5rem;
  }

  .schedule-info {
    padding: 0.5rem;
  }

  .info-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
  }

  .info-label,
  .info-value {
    font-size: 12px;
  }

  .registered-schedule-info {
    padding: 6px 8px;
  }

  .registered-schedule-info .text-body2 {
    font-size: 11px;
  }

  .registered-schedule-info .text-caption {
    font-size: 10px;
  }
}

/* ===== 17. Ï†ÑÏó≠ Ïä§ÌÉÄÏùº (Quasar Ïò§Î≤ÑÎùºÏù¥Îìú) ===== */

/* ‚úÖ Ïª¨Îüº ÎπÑÏú® Ï°∞Ï†ï - padding Ï†úÍ±∞ÌïòÏó¨ q-col-gutter-md Í∞ÑÍ≤©Îßå ÏÇ¨Ïö© */
/* .col-md-2 Ïò§Î≤ÑÎùºÏù¥Îìú Ï†úÍ±∞ - Quasar Í∏∞Î≥∏Í∞í ÏÇ¨Ïö© */

.col-md-4 {
  width: 33.3333% !important;
}

.col-md-6 {
  width: 50% !important;
  /* ‚úÖ Ï†ïÌôïÌïú 50%Î°ú ÏàòÏ†ï */
}

/* ‚úÖ Schedule ControlÏù¥ ÎÇ®ÏùÄ Í≥µÍ∞ÑÏùÑ Ï∞®ÏßÄÌïòÎèÑÎ°ù ÏÑ§Ï†ï */
.schedule-control-col {
  flex: 1 1 auto;
  min-width: 0;
}

.col-md-7 {
  width: 58.3333% !important;
}

/* Ïò§ÌîÑÏÖã Ïª®Ìä∏Î°§ Ïπ¥Îìú ÎπÑÏ§ë Ï°∞Ï†ï */
.col-sm-3:not(:last-child) {
  flex: 0 0 22%;
  max-width: 22%;
}

.col-sm-3:last-child {
  flex: 0 0 34%;
  max-width: 34%;
}

/* Quasar ÌÖåÏù¥Î∏î Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ïò§Î≤ÑÎùºÏù¥Îìú */
.schedule-table .q-table tbody tr.highlight-first-row {
  background-color: #ffeb3b !important;
  color: #000 !important;
  border-left: 4px solid #ffc107 !important;
}

.schedule-table .q-table tbody tr.highlight-first-row td {
  background-color: #ffeb3b !important;
  color: #000 !important;
}

.schedule-table .q-table tbody tr.current-tracking-row {
  background-color: #c8e6c9 !important;
  color: #2e7d32 !important;
  border-left: 4px solid #4caf50 !important;
}

.schedule-table .q-table tbody tr.current-tracking-row td {
  background-color: #c8e6c9 !important;
  color: #2e7d32 !important;
}

.schedule-table .q-table tbody tr.next-tracking-row {
  background-color: #e3f2fd !important;
  color: #1565c0 !important;
  border-left: 4px solid #2196f3 !important;
}

.schedule-table .q-table tbody tr.next-tracking-row td {
  background-color: #e3f2fd !important;
  color: #1565c0 !important;
}

/* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùºÎßÅ */
.schedule-table .q-table__container {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
}

.schedule-table .q-table__container::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.schedule-table .q-table__container::-webkit-scrollbar-track {
  background: transparent;
}

.schedule-table .q-table__container::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}

.schedule-table .q-table__container::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}
</style>
