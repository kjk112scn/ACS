# PassSchedule 테스트 시나리오

> **작성일**: 2026-01-20
> **대상**: Phase A-B 구현 검증
> **참조**: [PLAN.md](./PLAN.md), [IMPLEMENTATION_PROGRESS.md](./IMPLEMENTATION_PROGRESS.md)

---

## 테스트 요약

| 섹션 | 테스트 수 | 설명 |
|------|:--------:|------|
| 1. 기본 흐름 | 4 | 정상 동작 검증 |
| 2. Phase A | 6 | Critical 버그 수정 검증 |
| 3. Phase B | 10 | High 버그 수정 검증 |
| 4. 에러 처리 | 5 | ERROR 상태 및 복구 |
| 5. 엣지 케이스 | 5 | 경계 조건 테스트 |
| **Total** | **30** | - |

---

## 1. 기본 흐름 테스트

### T1.1 단일 위성 추적 (Happy Path)

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 1개 등록, 추적 시작 4분+ 전 |
| **수행 절차** | 1. START 버튼 클릭<br>2. 상태 전환 관찰<br>3. 추적 완료까지 대기 |
| **예상 결과** | IDLE → STOWING → STOWED → MOVING_TRAIN → TRAIN_STABILIZING → MOVING_TO_START → READY → TRACKING → POST_TRACKING → COMPLETED |
| **검증 포인트** | - 각 상태에서 올바른 명령 전송<br>- FE 상태 표시 동기화<br>- 로그 메시지 확인 |

### T1.2 단일 위성 추적 (4분 이내 시작)

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 1개 등록, 추적 시작 4분 이내 |
| **수행 절차** | 1. START 버튼 클릭<br>2. 상태 전환 관찰 |
| **예상 결과** | IDLE → MOVING_TRAIN → ... (STOWING/STOWED 생략) |
| **검증 포인트** | - prepMinutes 조건 분기 확인 |

### T1.3 다중 위성 연속 추적

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 A, B 연속 등록 (A 종료 후 B 시작 4분 이내) |
| **수행 절차** | 1. START 버튼 클릭<br>2. A 추적 완료 후 B 자동 시작 확인 |
| **예상 결과** | A: TRACKING → POST_TRACKING → B: MOVING_TRAIN → ... |
| **검증 포인트** | - **A3 검증**: 플래그 초기화 (resetFlags)<br>- 큐 원본 업데이트 확인<br>- nextScheduleContext FE 전달 |

### T1.4 다중 위성 연속 추적 (4분 이상 간격)

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 A, B (간격 4분 이상) |
| **수행 절차** | 1. START 버튼 클릭<br>2. A 완료 후 STOWING 확인 |
| **예상 결과** | A: POST_TRACKING → STOWING → STOWED → B: MOVING_TRAIN → ... |
| **검증 포인트** | - Stow 이동 후 대기<br>- 4분 조건 분기 확인 |

---

## 2. Phase A 테스트 (Critical)

### T2.1 [A1] Stow 위치 확인 - 이동 중

| 항목 | 내용 |
|------|------|
| **전제조건** | 안테나가 Stow 위치가 아닌 상태 |
| **수행 절차** | 1. START 클릭<br>2. STOWING 상태 진입 확인<br>3. 이동 중 상태 유지 확인 |
| **예상 결과** | isAtStowPosition() = false → STOWING 유지 |
| **검증 포인트** | - **A1 검증**: Az/El/Train 3축 모두 확인<br>- 허용오차 1.0도 내 판정 |

### T2.2 [A1] Stow 위치 확인 - 도달

| 항목 | 내용 |
|------|------|
| **전제조건** | STOWING 상태 |
| **수행 절차** | 1. 안테나가 Stow 위치 도달 대기<br>2. STOWED 전환 확인 |
| **예상 결과** | isAtStowPosition() = true → STOWED 전환 |
| **검증 포인트** | - Settings의 stowAngle 값과 비교<br>- 3축 모두 허용오차 내 |

### T2.3 [A2] detailId FE 전달

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 시작 |
| **수행 절차** | 1. FE 테이블에서 현재 스케줄 하이라이트 확인 |
| **예상 결과** | 현재 추적 중인 행이 정확히 하이라이트 |
| **검증 포인트** | - **A2 검증**: mstId + detailId 조합으로 행 식별<br>- DataStoreService.currentTrackingDetailId 확인 |

### T2.4 [A2] nextScheduleContext FE 전달

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 A, B 등록 |
| **수행 절차** | 1. A 추적 중 FE에서 다음 스케줄 표시 확인 |
| **예상 결과** | 다음 스케줄 B가 FE에 표시 |
| **검증 포인트** | - **A2 검증**: nextTrackingMstId, nextTrackingDetailId<br>- 다음 스케줄 없을 때 null 처리 |

### T2.5 [A3] 플래그 초기화 - 큐 업데이트

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 A 완료, B 대기 |
| **수행 절차** | 1. A 완료 후 B 시작 확인<br>2. B의 플래그 상태 확인 |
| **예상 결과** | B의 모든 플래그 초기화 (stowCommandSent=false 등) |
| **검증 포인트** | - **A3 검증**: scheduleContextQueue 원본 업데이트<br>- 로그에서 resetFlags 호출 확인 |

### T2.6 [A3] Time Offset 변경 시 플래그

| 항목 | 내용 |
|------|------|
| **전제조건** | 추적 진행 중 |
| **수행 절차** | 1. Time Offset 변경<br>2. 현재 스케줄 플래그 상태 확인 |
| **예상 결과** | reevaluateScheduleQueue에서 플래그 초기화 |
| **검증 포인트** | - **B3 검증 포함**: 큐 원본 업데이트 |

---

## 3. Phase B 테스트 (High)

### T3.1 [B4] 상태 전환 유효성 - 정상

| 항목 | 내용 |
|------|------|
| **전제조건** | IDLE 상태 |
| **수행 절차** | 1. START 클릭<br>2. 상태 전환 로그 확인 |
| **예상 결과** | validTransitions에 따른 순차 전환 |
| **검증 포인트** | - **B4 검증**: 허용된 전환만 수행<br>- 로그에 [V2-TRANSITION] 메시지 |

### T3.2 [B4] 상태 전환 유효성 - 잘못된 전환

| 항목 | 내용 |
|------|------|
| **전제조건** | IDLE 상태 |
| **수행 절차** | 1. (테스트 코드) IDLE → TRACKING 직접 전환 시도 |
| **예상 결과** | ERROR 상태로 전환 |
| **검증 포인트** | - **B4 검증**: transitionToError 호출<br>- 로그에 [V2-INVALID] 메시지 |

### T3.3 [B5] STOWING 타임아웃

| 항목 | 내용 |
|------|------|
| **전제조건** | STOWING 상태 진입 |
| **수행 절차** | 1. 안테나 이동 없이 4분 대기 (또는 시뮬레이션) |
| **예상 결과** | 4분 후 ERROR 전환 |
| **검증 포인트** | - **B5 검증**: STOWING_TIMEOUT_MS = 240,000ms<br>- 로그에 [V2-TIMEOUT] 메시지 |

### T3.4 [B5] MOVING_TRAIN 타임아웃

| 항목 | 내용 |
|------|------|
| **전제조건** | MOVING_TRAIN 상태 진입 |
| **수행 절차** | 1. Train 이동 없이 2분 대기 |
| **예상 결과** | 2분 후 ERROR 전환 |
| **검증 포인트** | - **B5 검증**: MOVING_TRAIN_TIMEOUT_MS = 120,000ms |

### T3.5 [B5] MOVING_TO_START 타임아웃

| 항목 | 내용 |
|------|------|
| **전제조건** | MOVING_TO_START 상태 진입 |
| **수행 절차** | 1. Az/El 이동 없이 4분 대기 |
| **예상 결과** | 4분 후 ERROR 전환 |
| **검증 포인트** | - **B5 검증**: MOVING_TO_START_TIMEOUT_MS = 240,000ms |

### T3.6 [B1] executeExitAction 호출

| 항목 | 내용 |
|------|------|
| **전제조건** | TRACKING 상태 |
| **수행 절차** | 1. 추적 종료 시간 도달<br>2. POST_TRACKING 전환 확인 |
| **예상 결과** | 전환 전 executeExitAction 호출 |
| **검증 포인트** | - **B1 검증**: 로그에 [V2-EXIT] 메시지<br>- 정리 작업 수행 확인 |

### T3.7 [B2] IDLE 상태 진입 - 리소스 정리

| 항목 | 내용 |
|------|------|
| **전제조건** | 모든 스케줄 완료 |
| **수행 절차** | 1. COMPLETED → IDLE 전환<br>2. 리소스 상태 확인 |
| **예상 결과** | - passScheduleTracking = false<br>- currentScheduleContext = null<br>- nextScheduleContext = null |
| **검증 포인트** | - **B2 검증**: IDLE case 처리<br>- DataStoreService 상태 확인 |

### T3.8 [B2] IDLE 상태 진입 - STOP 버튼

| 항목 | 내용 |
|------|------|
| **전제조건** | 추적 진행 중 |
| **수행 절차** | 1. STOP 버튼 클릭<br>2. IDLE 전환 확인 |
| **예상 결과** | 즉시 IDLE 전환, 리소스 정리 |
| **검증 포인트** | - **B2 검증**: 강제 정지 시에도 정리 수행 |

### T3.9 [B3] reevaluateScheduleQueue - 스케줄 변경

| 항목 | 내용 |
|------|------|
| **전제조건** | 추적 진행 중, Time Offset 변경 |
| **수행 절차** | 1. Time Offset을 크게 변경<br>2. 스케줄 재평가 확인 |
| **예상 결과** | 새로운 현재 스케줄로 전환, 플래그 초기화 |
| **검증 포인트** | - **B3 검증**: 큐 원본 업데이트<br>- 로그에 [V2-TIME_OFFSET] 메시지 |

### T3.10 [B3] reevaluateScheduleQueue - 모든 스케줄 과거

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 등록 후 Time Offset을 미래로 대폭 변경 |
| **수행 절차** | 1. 모든 스케줄 종료 시간이 과거가 되도록 설정 |
| **예상 결과** | 경고 로그 출력, COMPLETED 상태 |
| **검증 포인트** | - 로그에 "모든 스케줄이 과거로 이동함" |

---

## 4. 에러 처리 테스트

### T4.1 ERROR 상태 진입

| 항목 | 내용 |
|------|------|
| **전제조건** | 타임아웃 또는 잘못된 전환 발생 |
| **수행 절차** | 1. ERROR 상태 진입 확인<br>2. FE 표시 확인 |
| **예상 결과** | - ERROR 상태 표시<br>- Stow 명령 전송 |
| **검증 포인트** | - executeEnterAction(ERROR) 동작<br>- 안전을 위한 Stow 이동 |

### T4.2 ERROR 복구 - 다음 스케줄

| 항목 | 내용 |
|------|------|
| **전제조건** | ERROR 상태, 다음 스케줄 존재 |
| **수행 절차** | 1. ERROR 발생 후 자동 복구 대기 (5초) |
| **예상 결과** | - 통신 정상이면 다음 스케줄로 진행<br>- IDLE 거쳐 재시작 |
| **검증 포인트** | - **T8 시나리오**: handleErrorRecovery 동작<br>- evaluateNextSchedule 호출 |

### T4.3 ERROR 복구 - 스케줄 없음

| 항목 | 내용 |
|------|------|
| **전제조건** | ERROR 상태, 다음 스케줄 없음 |
| **수행 절차** | 1. ERROR 발생 후 복구 대기 |
| **예상 결과** | COMPLETED 상태로 전환 |
| **검증 포인트** | - 마지막 스케줄에서 ERROR 시 처리 |

### T4.4 연속 타임아웃

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 A, B 등록, 하드웨어 문제로 이동 불가 |
| **수행 절차** | 1. A에서 타임아웃 → ERROR<br>2. B 시작 후 또 타임아웃 |
| **예상 결과** | - 각 스케줄마다 ERROR 처리<br>- 무한 루프 방지 |
| **검증 포인트** | - **T9 시나리오**: 연속 실패 시에도 안정적 동작 |

### T4.5 통신 끊김 시 ERROR

| 항목 | 내용 |
|------|------|
| **전제조건** | 추적 중 하드웨어 통신 끊김 |
| **수행 절차** | 1. 통신 끊김 시뮬레이션<br>2. 30초 후 동작 확인 |
| **예상 결과** | - 30초 후 COMPLETED로 전환<br>- 안전 상태 유지 |
| **검증 포인트** | - handleErrorRecovery 30초 타임아웃 |

---

## 5. 엣지 케이스 테스트

### T5.1 추적 시간 내 START

| 항목 | 내용 |
|------|------|
| **전제조건** | 현재 시간이 이미 추적 시간 범위 내 |
| **수행 절차** | 1. START 클릭 |
| **예상 결과** | 즉시 TRACKING 상태 (준비 단계 스킵) |
| **검증 포인트** | - determineStateByTime 우선순위 확인<br>- 강제 완료 플래그 처리 |

### T5.2 추적 종료 직전 START

| 항목 | 내용 |
|------|------|
| **전제조건** | 추적 종료 시간 10초 전 |
| **수행 절차** | 1. START 클릭 |
| **예상 결과** | 짧게 TRACKING 후 POST_TRACKING |
| **검증 포인트** | - 짧은 추적도 정상 처리 |

### T5.3 동시에 두 스케줄 시작

| 항목 | 내용 |
|------|------|
| **전제조건** | 두 스케줄의 시작 시간이 동일 |
| **수행 절차** | 1. START 클릭<br>2. 어떤 스케줄이 먼저 처리되는지 확인 |
| **예상 결과** | minByOrNull으로 하나만 선택 |
| **검증 포인트** | - 스케줄 충돌 처리 |

### T5.4 빈 스케줄 큐

| 항목 | 내용 |
|------|------|
| **전제조건** | 스케줄 없음 |
| **수행 절차** | 1. START 클릭 |
| **예상 결과** | COMPLETED 상태 또는 에러 메시지 |
| **검증 포인트** | - 빈 큐 처리 |

### T5.5 Stow 위치 허용오차 경계

| 항목 | 내용 |
|------|------|
| **전제조건** | 안테나가 Stow 위치에서 정확히 1.0도 차이 |
| **수행 절차** | 1. STOWING 상태에서 위치 확인 |
| **예상 결과** | 1.0도 이하면 STOWED, 초과면 STOWING 유지 |
| **검증 포인트** | - **A1 검증**: tolerance = 1.0 경계값 |

---

## 테스트 실행 체크리스트

### Phase A 검증 (필수)

- [ ] T2.1 Stow 위치 이동 중
- [ ] T2.2 Stow 위치 도달
- [ ] T2.3 detailId FE 전달
- [ ] T2.4 nextScheduleContext FE 전달
- [ ] T2.5 플래그 초기화
- [ ] T2.6 Time Offset 플래그

### Phase B 검증 (필수)

- [ ] T3.1 정상 상태 전환
- [ ] T3.2 잘못된 전환 → ERROR
- [ ] T3.3 STOWING 4분 타임아웃
- [ ] T3.4 MOVING_TRAIN 2분 타임아웃
- [ ] T3.5 MOVING_TO_START 4분 타임아웃
- [ ] T3.6 executeExitAction 호출
- [ ] T3.7 IDLE 리소스 정리
- [ ] T3.8 STOP 버튼 IDLE
- [ ] T3.9 Time Offset 스케줄 변경
- [ ] T3.10 모든 스케줄 과거

### 기본 흐름 (권장)

- [ ] T1.1 단일 위성 (4분+ 전)
- [ ] T1.2 단일 위성 (4분 이내)
- [ ] T1.3 다중 위성 (4분 이내)
- [ ] T1.4 다중 위성 (4분 이상)

### 에러 처리 (권장)

- [ ] T4.1 ERROR 진입
- [ ] T4.2 ERROR 복구
- [ ] T4.3 스케줄 없음 복구
- [ ] T4.4 연속 타임아웃
- [ ] T4.5 통신 끊김

---

## 참조

- [PLAN.md](./PLAN.md) - 원본 T1-T9 시나리오
- [STATE_MACHINE.md](./STATE_MACHINE.md) - 상태 다이어그램
- [IMPLEMENTATION_PROGRESS.md](./IMPLEMENTATION_PROGRESS.md) - 구현 상세
