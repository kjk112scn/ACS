# 2026-01-20 작업 로그

## 완료된 작업

### 통합 워크플로우 v2.0 적용
- **유형**: Refactor
- **영향**: Skills (.claude/skills/)
- **요약**: 모든 스킬에 PassSchedule 검증 워크플로우 적용

### Why
- PassSchedule 리팩토링에서 검증된 6단계 워크플로우 표준화
- 자동 분석 + 전문가 검토 + Phase 분류 자동화

### 구현 내용

| 파일 | 변경 |
|------|------|
| UNIFIED_WORKFLOW.md | ✨ 신규 - 통합 워크플로우 마스터 |
| refactor/SKILL.md | v1.0 → v2.0 |
| bugfix/SKILL.md | v1.0 → v2.0 |
| plan/SKILL.md | v1.0 → v2.0 |
| feature/SKILL.md | v1.0 → v2.0 |
| docs/work/active/README.md | Dashboard 추가 |

---

### PassSchedule Phase C-D 완료
- **유형**: Refactor
- **영향**: Backend (PassScheduleService.kt)
- **요약**: 스레드 안전성, 코드 품질 개선 (CLAUDE.md 준수)

### Why
- `isShuttingDown` 동시성 이슈 예방
- Dead code 삭제로 유지보수성 향상
- CLAUDE.md 코딩 규칙 준수 (구체적 예외 타입)
- V1 잔재 필드명 정리

### 구현 내용

| Phase | 항목 | 내용 |
|:-----:|------|------|
| C1 | isShuttingDown | Boolean → AtomicBoolean |
| D1 | handleTrackingPreparation | @Deprecated 함수 삭제 |
| D2 | 10초 상태 로깅 | INFO → DEBUG |
| D3 | catch(Exception) | → catch(RuntimeException) 13개 |
| D4 | ["No"] 필드 | → ["MstId"] 6개 |

---

### PassSchedule Phase A-B 구현 완료
- **유형**: Bugfix / Refactor
- **영향**: Backend (PassScheduleService.kt)
- **요약**: Critical(3개) + High(6개) 버그 수정, 테스트 시나리오 30개 작성

### Why
- 다중 위성 추적 시 플래그 초기화 실패 문제 해결
- 상태 전환 안전성 확보 (타임아웃, ERROR 처리)
- FE 테이블 하이라이트 매칭 정확도 향상

### 구현 내용

| Phase | 항목 | 내용 |
|:-----:|------|------|
| A1 | isAtStowPosition() | Stow 위치 확인 (3축, 1.0도 허용) |
| A2 | sendStateToFrontend() | detailId + nextScheduleContext 전달 |
| A3 | evaluateNextSchedule() | 큐 원본 업데이트 |
| B1 | executeExitAction() | 상태 퇴장 시 정리 로직 |
| B2 | IDLE case | executeEnterAction에 추가 |
| B3 | reevaluateScheduleQueue() | 큐 원본 업데이트 |
| B4 | validTransitions | 상태 전환 유효성 검사 |
| B5 | checkStateTimeout() | 타임아웃 (4분/2분/4분) |

### 산출물
- [TEST_SCENARIOS.md](../work/active/Architecture_Refactoring/passschedule/TEST_SCENARIOS.md) - 30개 테스트 시나리오
- [IMPLEMENTATION_PROGRESS.md](../work/active/Architecture_Refactoring/passschedule/IMPLEMENTATION_PROGRESS.md) - 구현 진행 기록

### 상세
- [passschedule/README.md](../work/active/Architecture_Refactoring/passschedule/README.md)

---

### 작업 추적 시스템 구축
- **유형**: Docs
- **영향**: docs/work/
- **요약**: 세션 간 상태 추적 및 프로젝트 건강 점검 시스템

### Why
- 새 세션 시작 시 `/status` 또는 "CURRENT_STATUS.md 읽고 이어서"로 빠른 복원
- 빌드/품질 상태 이력 관리

### 산출물
| 파일 | 설명 |
|------|------|
| CURRENT_STATUS.md | 진행 중/완료 작업, 다음 후보 |
| health-checks/ | 빌드/품질 점검 결과 |
| done/SKILL.md v2.1.0 | Step 3: CURRENT_STATUS.md 자동 업데이트 |

---

### LoggingService 분석
- **유형**: Analysis
- **요약**: SLF4J vs LoggingService 사용 현황 분석

| 항목 | 수치 |
|------|-----:|
| SLF4J 직접 사용 | 1,737회 |
| LoggingService 특수 기능 | 6회 |
| logBusinessAction | 5회 (LoggingController만) |
| logSystemStart | 1회 |

**결론**: 특수 기능 거의 미사용 → 삭제 또는 활용 확대 결정 필요

---

### DB 테스트 (Phase 1-2) 완료
- **유형**: Test
- **영향**: Backend + Database
- **요약**: TimescaleDB 연결 테스트 성공

### Why
- with-db 프로필로 실제 DB 연동 검증
- 권한 이슈 해결 (GRANT 명령 via DBeaver)

### 결과
| 항목 | 상태 |
|------|:----:|
| DB 연결 | ✅ |
| Settings 로드 | ✅ (0개) |
| HardwareErrorLog | ✅ (0개) |
| TLE Cache | ✅ |
| 서버 시작 | ✅ (7초) |

---

### i18n 하드코딩 정리 (3개 페이지)
- **유형**: Refactor
- **영향**: Frontend
- **요약**: 3개 페이지 하드코딩 → T.xxx 교체

### Why
- 언어 전환 시 영어로 표시되도록

### 완료 파일
| 파일 | 교체 수 |
|------|:------:|
| LoginPage.vue | 1개 |
| StandbyPage.vue | 6개 |
| SunTrackPage.vue | 7개 |

### 남은 작업
- ~1,770개 하드코딩 → 미룸 (나중에 일괄 작업)

---

### UI/UX 리팩토링 검토
- **유형**: Analysis
- **요약**: 우선순위 재정립

### 결정 사항
| 작업 | 상태 | 비고 |
|------|:----:|------|
| Drawer 네비게이션 | 미룸 | 데이터 분석 화면 때 |
| 헤더 HW 상태 추가 | 대기 | 전문가 검토 후 |
| 모드 페이지 통일 | 대기 | 전문가 검토 후 |
| i18n 하드코딩 | 미룸 | 일괄 작업 예정 |

### 발견한 기존 로직
- `/api/icd/communication-status` - 하드웨어 통신 상태 API 존재

---

### DB 스키마 재설계 + ICD 저장 로직
- **유형**: Feature
- **영향**: Backend (DB Migration, Service)
- **요약**: Flyway 마이그레이션 완전 재구성 + ICD 상태 DB 저장

### Why
- 기존 마이그레이션 8개 중 2개만 존재 → 새 PC 설치 시 테이블 생성 실패
- icd_status 저장 메서드 존재하지만 미연결 → DB 저장 안 됨

### 구현 내용

| 파일 | 변경 |
|------|------|
| V001__Create_all_tables.sql | ✨ 8개 테이블 + Hypertable 설정 |
| V002__Insert_default_settings.sql | 63개 설정값 |
| IcdStatusStorageService.kt | ✨ UDP → DB 배치 저장 |

### 상세
- [DB_Schema_Redesign](../work/active/DB_Schema_Redesign/README.md)

---

### Timezone 처리 표준화 (ADR-006)
- **유형**: Feature
- **영향**: Backend (5개) + Frontend (7개)
- **요약**: 사용자 timezone 선택 기능 + 하드코딩 제거

### Why
- Asia/Seoul 하드코딩 → 다국적 사용자 지원 불가
- 사용자가 원하는 timezone으로 시간 표시 필요
- 폐쇄망에서도 동작해야 함 (브라우저 Intl API 사용)

### 구현 내용

| 영역 | 파일 | 변경 |
|------|------|------|
| BE | SunTrackService.kt | utcToKst → formatUtcTime |
| BE | GlobalExceptionHandler.kt | LocalDateTime → OffsetDateTime(UTC) |
| BE | LoggingController.kt | systemDefault() → ZoneOffset.UTC |
| BE | GlobalData.kt | @deprecated 주석 추가 |
| FE | timezoneStore.ts | ✨ Pinia store (신규) |
| FE | useTimezone.ts | ✨ 헬퍼 composable (신규) |
| FE | times.ts | getCurrentTimezone(), formatToUserTimezone() |
| FE | MainLayout.vue | 동적 timezone offset 표시 |
| FE | GeneralSettings.vue | Timezone 설정 UI |
| FE | HardwareErrorLogPanel.vue | formatToUserTimezone() |
| FE | AllStatusContent.vue | formatToUserTimezone() |

### 산출물
- [ADR-006](../decisions/ADR-006-timezone-handling-architecture.md)
- [Timezone_Handling_Standardization](../work/active/Timezone_Handling_Standardization/)

### 상태
- ✅ 구현 완료 (FE/BE 빌드 성공)
- ⏳ 수동 테스트 대기

---

## 다음 작업

- [ ] DB 초기화 후 Flyway 테스트 (PostgreSQL)
- [ ] 헤더 HW 상태 추가 - 전문가 검토 후 진행
- [ ] 모드 페이지 통일 (mode-shell) - 전문가 검토 후 진행

---

이전: [2026-01-19](2026-01-19.md)
